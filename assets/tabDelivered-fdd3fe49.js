import{i as m,w as I}from"./i18n-0af8b262.js";import{a as F,b as P}from"./style-b9bc59b4.js";import{D as x,a as L,c as T,P as V,b as q}from"./system-93ae242b.js";import{a as c}from"./index-cd6d6b34.js";import{s as E,q as R,r as z,t as A}from"./deliveryManagement-7eebd823.js";import{_ as N}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{_ as O}from"./package-confirm.vue_vue_type_script_setup_true_lang-44235a07.js";import{G as b}from"./commodityManagement-a1debff9.js";import{_ as U}from"./to-be-freightfee.vue_vue_type_script_setup_true_lang-20330330.js";import{g as B,s as G}from"./common-938b41ea.js";import{_ as H}from"./search-delivered-detail.vue_vue_type_script_setup_true_lang-20446111.js";import{e as j}from"./exportTable-b0d17537.js";import{B as K}from"./btnGroup-26ff2079.js";import{h as w}from"./httpCodeJudge-e416f8ca.js";import{d as W,b as g,r as $,o as Q,c as D,w as Z,a as _,x as J,m as Y,u as p,q as t,s as d,y as X,at as y,ap as u,as as ee,O as te}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./formRule-3feb276f.js";import"./freightSetting-4f9f7a61.js";import"./formatSystem-1203ad16.js";import"./index-ae8f073f.js";const le={class:"operateArea"},ie={style:{width:"100%",display:"flex","justify-content":"center"}},se=W({__name:"tabDelivered",setup(oe,{expose:M}){const h=g(),v=g(),a=$({showDeliveredDetailID:0,showDeliveredDetail:!1,showSetFreight:!1,dialogDefaultQty:0,packageRow:g(),searchForm:{dispatch_no:"",customer_name:"",spu_name:""},timer:g(null),activeTab:null,tableData:g([]),tablePage:g({total:0,pageIndex:1,pageSize:x,searchObjects:[]}),confirmList:g([]),btnList:[],authorityList:B()}),s=$({closeDeliveredDetail:()=>{a.showDeliveredDetail=!1},viewRow:e=>{a.showDeliveredDetailID=e.id,a.showDeliveredDetail=!0},setFreight:()=>{h.value.getCheckboxRecords().length>0?a.showSetFreight=!0:c.$message({type:"error",content:`${m.global.t("base.userManagement.checkboxIsNull")}`})},freightfeeClose:()=>{a.showSetFreight=!1},freightfeeSubmit:async e=>{const i=[],o=h.value;for(const f of o.getCheckboxRecords())i.push({id:f.id,dispatch_no:f.dispatch_no,dispatch_status:f.dispatch_status,freightfee_id:e.freightfee_id,carrier:e.carrier,waybill_no:e.waybill_no});const{data:l}=await E(i);if(!l.isSuccess){c.$message({type:"error",content:l.errorMessage});return}c.$message({type:"success",content:l.data}),s.freightfeeClose(),s.refresh()},dialogSubmit:async e=>{const i=e.map(l=>({id:l.id,dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,damage_qty:l.qty})),{data:o}=await R(i);if(!o.isSuccess){if(w(o.errorMessage)){s.refresh(),v.value.closeDialog();return}c.$message({type:"error",content:o.errorMessage});return}c.$message({type:"success",content:o.data}),v.value.closeDialog(),s.refresh()},handleSignIn:async()=>{let i=h.value.getCheckboxRecords();i=i.filter(l=>!l.is_todo);const o=[];if(i.length>0){for(const l of i)o.push({id:l.id,spu_name:l.spu_name,spu_code:l.spu_code,sku_code:l.sku_code,maxQty:l.picked_qty,qty:0,dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status});v.value.openDialog(o)}else c.$message({type:"error",content:`${m.global.t("wms.deliveryManagement.opeartionCheckboxIsNull")}`})},refresh:()=>{s.getDelivery()},getDelivery:async()=>{const{data:e}=await z(a.tablePage);if(!e.isSuccess){c.$message({type:"error",content:e.errorMessage});return}a.tableData=e.data.rows,a.tablePage.total=e.data.totals},handlePageChange:g(({currentPage:e,pageSize:i})=>{a.tablePage.pageIndex=e,a.tablePage.pageSize=i,s.getDelivery()}),exportTable:()=>{const e=h.value;j({table:e,filename:m.global.t("wms.deliveryManagement.outOfWarehouse"),columnFilterMethod({column:i}){return!["checkbox"].includes(i==null?void 0:i.type)&&!["operate"].includes(i==null?void 0:i.field)}})},sureSearch:()=>{a.tablePage.searchObjects=G(a.searchForm),s.getDelivery()},handleDeliver:async()=>{let i=h.value.getCheckboxRecords();if(i=i.filter(o=>o.is_todo),i.length>0){const o=i.map(l=>({id:l.id,dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,picked_qty:l.picked_qty}));c.$dialog({content:`${m.global.t("wms.deliveryManagement.irreversible")}, ${m.global.t("wms.deliveryManagement.confirmDelivery")}?`,handleConfirm:async()=>{const{data:l}=await A(o);if(!l.isSuccess){if(w(l.errorMessage)){s.refresh();return}c.$message({type:"error",content:l.errorMessage});return}c.$message({type:"success",content:l.data}),s.refresh()}})}else c.$message({type:"error",content:`${m.global.t("wms.deliveryManagement.opeartionCheckboxIsNull")}`})}});Q(()=>{a.btnList=[{name:m.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:s.refresh},{name:m.global.t("system.page.export"),icon:"mdi-export-variant",code:"delivered-export",click:s.exportTable},{name:m.global.t("wms.deliveryManagement.delivery"),icon:"mdi-cube-send",code:"delivered-delivery",click:s.handleDeliver},{name:m.global.t("wms.deliveryManagement.setFreight"),icon:"mdi-car-cog",code:"delivered-setCarrier",click:s.setFreight},{name:m.global.t("wms.deliveryManagement.signIn"),icon:"mdi-email-check",code:"delivered-signIn",click:s.handleSignIn}]});const k=D(()=>F({})),S=D(()=>P({}));return Z(()=>a.searchForm,()=>{a.timer&&clearTimeout(a.timer),a.timer=setTimeout(()=>{a.timer=null,s.sureSearch()},L)},{deep:!0}),M({getDelivery:s.getDelivery}),(e,i)=>{const o=_("v-col"),l=_("v-text-field"),f=_("v-row"),r=_("vxe-column"),C=_("vxe-table");return J(),Y(te,null,[p("div",le,[t(f,{"no-gutters":""},{default:d(()=>[t(o,{cols:"3",class:"col"},{default:d(()=>[t(K,{"authority-list":a.authorityList,"btn-list":a.btnList},null,8,["authority-list","btn-list"])]),_:1}),t(o,{cols:"9"},{default:d(()=>[t(f,{"no-gutters":"",onKeyup:I(s.sureSearch,["enter"])},{default:d(()=>[t(o,{cols:"4"},{default:d(()=>[t(l,{modelValue:a.searchForm.dispatch_no,"onUpdate:modelValue":i[0]||(i[0]=n=>a.searchForm.dispatch_no=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.dispatch_no"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(o,{cols:"4"},{default:d(()=>[t(l,{modelValue:a.searchForm.customer_name,"onUpdate:modelValue":i[1]||(i[1]=n=>a.searchForm.customer_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(o,{cols:"4"},{default:d(()=>[t(l,{modelValue:a.searchForm.spu_name,"onUpdate:modelValue":i[2]||(i[2]=n=>a.searchForm.spu_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.spu_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),p("div",{class:"mt-5",style:ee({height:u(k)})},[t(C,{ref_key:"xTable",ref:h,"column-config":{minWidth:"100px"},data:a.tableData,height:u(S),align:"center"},{empty:d(()=>[X(y(u(m).global.t("system.page.noData")),1)]),default:d(()=>[t(r,{type:"seq",width:"60"}),t(r,{type:"checkbox",width:"50"}),t(r,{title:e.$t("wms.deliveryManagement.state")},{default:d(({row:n})=>[p("span",null,y(`${n.is_todo?e.$t("wms.deliveryManagement.deliveryTodo"):e.$t("wms.deliveryManagement.deliveryReady")}`),1)]),_:1},8,["title"]),t(r,{field:"dispatch_no",title:e.$t("wms.deliveryManagement.dispatch_no")},null,8,["title"]),t(r,{field:"spu_code",title:e.$t("wms.deliveryManagement.spu_code")},null,8,["title"]),t(r,{field:"spu_description",width:"200px",title:e.$t("wms.deliveryManagement.spu_description")},null,8,["title"]),t(r,{field:"spu_name",title:e.$t("wms.deliveryManagement.spu_name")},null,8,["title"]),t(r,{field:"sku_code",title:e.$t("wms.deliveryManagement.sku_code")},null,8,["title"]),t(r,{field:"bar_code",title:e.$t("wms.deliveryManagement.bar_code")},null,8,["title"]),t(r,{field:"qty",title:e.$t("wms.deliveryManagement.order_qty")},null,8,["title"]),t(r,{field:"weight",title:e.$t("wms.deliveryManagement.detailWeight")},{default:d(({row:n})=>[p("span",null,y(`${n.weight} ${u(b)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),t(r,{field:"volume",title:e.$t("wms.deliveryManagement.detailVolume")},{default:d(({row:n})=>[p("span",null,y(`${n.volume} ${u(b)("volume",n.volume_unit)}`),1)]),_:1},8,["title"]),t(r,{field:"package_no",title:e.$t("wms.deliveryManagement.package_no")},null,8,["title"]),t(r,{field:"weighing_weight",title:e.$t("wms.deliveryManagement.weighing_weight")},{default:d(({row:n})=>[p("span",null,y(`${n.weighing_weight} ${u(b)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),t(r,{field:"weighing_no",title:e.$t("wms.deliveryManagement.weighing_no")},null,8,["title"]),t(r,{field:"customer_name",title:e.$t("wms.deliveryManagement.customer_name")},null,8,["title"]),t(r,{field:"creator",title:e.$t("wms.deliveryManagement.creator")},null,8,["title"]),t(r,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.deliveryManagement.create_time")},null,8,["title"]),t(r,{field:"operate",title:e.$t("system.page.operate"),width:"140",resizable:!1,"show-overflow":""},{default:d(({row:n})=>[p("div",ie,[t(N,{flat:!0,icon:"mdi-eye-outline","tooltip-text":e.$t("system.page.view"),onClick:re=>s.viewRow(n)},null,8,["tooltip-text","onClick"])])]),_:1},8,["title"])]),_:1},8,["data","height"]),t(T,{"current-page":a.tablePage.pageIndex,"page-size":a.tablePage.pageSize,perfect:"",total:a.tablePage.total,"page-sizes":u(V),layouts:u(q),onPageChange:s.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"]),t(O,{ref_key:"SignInConfirmRef",ref:v,"dialog-title":e.$t("wms.deliveryManagement.signIn"),"is-weight":!1,"is-sign-in":!0,onSubmit:s.dialogSubmit},null,8,["dialog-title","onSubmit"]),t(H,{id:a.showDeliveredDetailID,"show-dialog":a.showDeliveredDetail,onClose:s.closeDeliveredDetail},null,8,["id","show-dialog","onClose"]),t(U,{"show-dialog":a.showSetFreight,onClose:s.freightfeeClose,onSubmit:s.freightfeeSubmit},null,8,["show-dialog","onClose","onSubmit"])],4)],64)}}});const Le=ae(se,[["__scopeId","data-v-823f89fd"]]);export{Le as default};
