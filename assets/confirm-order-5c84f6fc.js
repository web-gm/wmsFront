import{i as r}from"./i18n-0af8b262.js";import{c as j,g as R}from"./deliveryManagement-7eebd823.js";import{a as m}from"./index-cd6d6b34.js";import{a as z}from"./tableRule-6aa0c57f.js";import{d as V,r as x,a as s,x as $,m as q,q as t,s as n,y as v,b as p,c as E,w as F,v as K,at as f,ap as C,u as S,as as Q,ac as W}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";import{h as X}from"./httpCodeJudge-e416f8ca.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";const Z=V({__name:"custom-checkbox",props:{value:{type:Boolean}},emits:["update:value"],setup(b,{emit:y}){const _=b,g=x({clickCheckBox:()=>{y("update:value",!_.value)}});return(h,c)=>{const a=s("v-icon");return _.value?($(),q("div",{key:0,class:"checkbox checkboxConfirm",onClick:c[0]||(c[0]=d=>g.clickCheckBox())},[t(a,{style:{"font-size":"12px"}},{default:n(()=>[v(" mdi-check ")]),_:1})])):($(),q("div",{key:1,class:"checkbox",onClick:c[1]||(c[1]=d=>g.clickCheckBox())}))}}});const A=L(Z,[["__scopeId","data-v-bb715a2d"]]),J={style:{height:"100%",display:"flex","align-items":"center","justify-content":"center"}},G=V({__name:"confirm-order",props:{showDialog:{type:Boolean},confirmOrderNo:null},emits:["close","saveSuccess"],setup(b,{emit:y}){const _=b,g=p(),h=p(),c=E(()=>_.showDialog),a=x({navListOptions:{title:r.global.t("wms.deliveryManagement.orderDetail"),labelKey:"sku_code",indexKey:"sku_code",indexValue:""},treeData:p([]),tableData:p([]),validList:p([]),validRules:p({pick_qty:[{validator:z,validNumerical:"nonNegative",trigger:"change"}]})}),d=x({closeDialog:()=>{y("close")},beforeSubmit:()=>{a.validList=[];const e=[];let u=0;if(a.treeData.filter(l=>l.confirm).length<=0)return m.$message({type:"error",content:r.global.t("wms.deliveryManagement.NoItemSelected")}),!1;for(const l of a.treeData)if(l.confirm){let o=0;for(const k of l.pick_list)o+=Number(k.pick_qty);u+=o,o>l.qty&&(a.validList.push(l.sku_code),e.push(`${l.sku_code} ${r.global.t("wms.deliveryManagement.quantityOverflow")} ${l.qty}`)),o===0&&(a.validList.includes(l.sku_code)||a.validList.push(l.sku_code),e.push(`${l.sku_code} ${r.global.t("wms.deliveryManagement.detailQuantityIsZero")}!`))}return e.length>0?(m.$message({type:"error",content:e.join(`;
`)}),!1):u<=0?(m.$message({type:"error",content:r.global.t("wms.deliveryManagement.quantityIsZero")}),!1):!0},submit:async()=>{if(await h.value.validate(!0)){m.$message({type:"error",content:r.global.t("system.checkText.checkFormFail")});return}if(d.beforeSubmit()){const{data:l}=await j(a.treeData);if(!l.isSuccess){if(X(l.errorMessage,!1)){m.$message({type:"error",content:r.global.t("system.tips.dataExpiration")});return}m.$message({type:"error",content:l.errorMessage});return}m.$message({type:"success",content:r.global.t("wms.deliveryManagement.confirmSuccess")}),y("saveSuccess")}},getInfoByNo:async()=>{const{data:e}=await R(_.confirmOrderNo);!e.isSuccess||(a.treeData=e.data,a.tableData=[],a.treeData.length>0&&d.cellClick({row:a.treeData[0]}))},cellClick:({row:e})=>{a.navListOptions.indexValue=e.sku_code,a.tableData=e.pick_list},navListClick:e=>{a.navListOptions.indexValue=e.sku_code,a.tableData=e.pick_list},cellStyle:({row:e})=>{const u={cursor:"pointer"};return e.sku_code===a.navListOptions.indexValue&&(u.backgroundColor="#e6dafd"),u}});return F(()=>c.value,e=>{e&&d.getInfoByNo()}),(e,u)=>{const l=s("v-toolbar"),o=s("vxe-column"),k=s("vxe-table"),D=s("v-col"),O=s("vxe-input"),B=s("v-row"),N=s("v-card-text"),M=s("v-btn"),I=s("v-card-actions"),T=s("v-card"),U=s("v-dialog");return $(),K(U,{modelValue:C(c),"onUpdate:modelValue":u[0]||(u[0]=i=>W(c)?c.value=i:null),width:"80%",transition:"dialog-top-transition",persistent:!0},{default:n(()=>[t(T,{class:"formCard"},{default:n(()=>[t(l,{color:"white",title:`${e.$t("wms.deliveryManagement.confirmOrder")}`},null,8,["title"]),t(N,null,{default:n(()=>[t(B,null,{default:n(()=>[t(D,{cols:5},{default:n(()=>[t(k,{ref_key:"xTable",ref:g,"keep-source":"","column-config":{minWidth:"100px"},data:a.treeData,height:"600px",align:"center","cell-style":d.cellStyle,onCellClick:d.cellClick},{empty:n(()=>[v(f(C(r).global.t("system.page.noData")),1)]),default:n(()=>[t(o,{type:"seq",width:"40"}),t(o,{width:"40"},{default:n(({row:i})=>[S("div",J,[t(A,{value:i.confirm,"onUpdate:value":w=>i.confirm=w},null,8,["value","onUpdate:value"])])]),_:1}),t(o,{field:"spu_name",title:e.$t("wms.deliveryManagement.spu_name")},null,8,["title"]),t(o,{field:"spu_code",title:e.$t("wms.deliveryManagement.spu_code")},null,8,["title"]),t(o,{field:"sku_code",title:e.$t("wms.deliveryManagement.sku_code")},{default:n(({row:i})=>[S("span",{style:Q(a.validList.includes(i.sku_code)?"color: red":"")},f(i.sku_code),5)]),_:1},8,["title"]),t(o,{field:"qty",title:e.$t("wms.deliveryManagement.qty")},null,8,["title"])]),_:1},8,["data","cell-style","onCellClick"])]),_:1}),t(D,{cols:7},{default:n(()=>[t(k,{ref_key:"detailXTable",ref:h,"keep-source":"","column-config":{minWidth:"100px"},data:a.tableData,height:"600px",align:"center","edit-config":{trigger:"click",mode:"cell"},"edit-rules":a.validRules},{empty:n(()=>[v(f(C(r).global.t("system.page.noData")),1)]),default:n(()=>[t(o,{type:"seq",width:"60"}),t(o,{field:"warehouse_name",title:e.$t("wms.stock.warehouse")},null,8,["title"]),t(o,{field:"location_name",title:e.$t("wms.stock.location_name")},null,8,["title"]),t(o,{field:"goods_owner_name",title:e.$t("base.ownerOfCargo.goods_owner_name")},null,8,["title"]),t(o,{field:"qty_available",title:e.$t("wms.deliveryManagement.qty_available")},null,8,["title"]),t(o,{field:"series_number",title:e.$t("wms.stockLocation.series_number")},null,8,["title"]),t(o,{field:"pick_qty",title:e.$t("wms.deliveryManagement.detailQty"),"edit-render":{}},{edit:n(({row:i})=>[t(O,{modelValue:i.pick_qty,"onUpdate:modelValue":w=>i.pick_qty=w,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title"])]),_:1},8,["data","edit-rules"])]),_:1})]),_:1})]),_:1}),t(I,{class:"justify-end"},{default:n(()=>[t(M,{variant:"text",onClick:d.closeDialog},{default:n(()=>[v(f(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(M,{color:"primary",variant:"text",onClick:d.submit},{default:n(()=>[v(f(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const re=L(G,[["__scopeId","data-v-11498c00"]]);export{re as default};
