import{i as r}from"./i18n-0af8b262.js";import{a as g}from"./index-cd6d6b34.js";import{h as v}from"./request-e1053d5a.js";import{S as V,e as j}from"./style-b9bc59b4.js";import{r as J}from"./common-938b41ea.js";import{P as T,b as E}from"./warehouseWorking-497fd91f.js";import{c as Q}from"./commodity-select-5da8c47a.js";import{l as H}from"./location-select-a2f98b65.js";import{s as R}from"./sku-select-e1d3e93a.js";import{_ as q}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{c as G}from"./custom-qrcode-7ab7b0a5.js";import{e as Y}from"./exportTable-b0d17537.js";import{a as O}from"./tableRule-6aa0c57f.js";import{d as K,b as w,c as $,r as B,w as X,a as m,x as ee,m as te,q as o,s as c,ap as _,u as f,at as k,y as C,ac as oe,O as se}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";const We=u=>v({url:"/stockprocess/list",method:"post",data:u}),Le=u=>v({url:"/stockprocess",method:"get",params:{id:u}}),le=u=>v({url:"/stockprocess",method:"post",data:u}),Ve=u=>v({url:"/stockprocess",method:"delete",params:{id:u}}),je=u=>v({url:"/stockprocess/process-confirm",method:"put",params:{id:u}}),Ee=u=>v({url:"/stockprocess/adjustment-confirm",method:"put",params:{id:u}}),ie={class:"dataTable"},re={class:"toolbar"},ne={class:"toolbarTitle"},ce={style:{color:"#999"}},ue={class:"dataTable"},de={class:"toolbar"},_e={class:"toolbarTitle"},me={style:{color:"#999"}},pe=K({__name:"add-or-update-process",props:{showDialog:{type:Boolean},form:null,processType:{type:Boolean}},emits:["close","saveSuccess"],setup(u,{emit:x}){const S=u,h=w(),b=w(),D=$(()=>S.showDialog),M=$(()=>S.form.id&&S.form.id>0),U=$(()=>a.form.job_type===T?r.global.t("wms.warehouseWorking.warehouseProcessing.process_combine"):r.global.t("wms.warehouseWorking.warehouseProcessing.process_split")),P=$(()=>!!M.value),F=$(()=>JSON.stringify({id:a.form.id.toString(),type:"warehouseProcessing"})),i=B({initForm:()=>{a.form=S.form,a.form.job_type=S.processType},closeDialog:()=>{x("close")},openSelect:e=>{a.curSelectType=e,e==="source"?a.showCommodityDialogSelect=!0:e==="target"&&(a.showSkuDialogSelect=!0)},closeDialogSelect:e=>{e==="source"?a.showCommodityDialogSelect=!1:e==="target"&&(a.showSkuDialogSelect=!1)},sureSelect:e=>{a.curSelectType==="source"?i.insertSourceData(e):a.curSelectType==="target"&&i.insertTargetData(e)},openLocationSelect:e=>{a.curSelectRow=e,a.showLocationDialogSelect=!0},closeLocationDialogSelect:()=>{a.showLocationDialogSelect=!1},sureSelectLocation:e=>{if(e.length>0){const s=b.value,l=s.getTableData().fullData;l.forEach(t=>{a.curSelectRow.sku_id===t.sku_id&&(t.goods_location_id=e[0].id,t.location_name=e[0].location_name)}),s.reloadData(l)}},insertSourceData:e=>{const s=h.value,l=s.getTableData().fullData;if(a.form.job_type===T)for(const t of e)l.some(y=>y.sku_id===t.sku_id)||s.insertAt({id:0,stock_process_id:0,sku_id:t.sku_id,goods_owner_id:t.goods_owner_id,goods_location_id:t.goods_location_id,qty:t.qty_available||0,tenant_id:0,is_source:!0,spu_code:t.spu_code,spu_name:t.spu_name,sku_code:t.sku_code,series_number:t.series_number,unit:t.unit,is_update_stock:!1,qty_available:t.qty_available},-1);else a.form.job_type===E&&(s.remove(),s.insertAt({id:0,stock_process_id:0,sku_id:e[0].sku_id,goods_owner_id:e[0].goods_owner_id,goods_location_id:e[0].goods_location_id,qty:e[0].qty_available||0,tenant_id:0,is_source:!0,spu_code:e[0].spu_code,spu_name:e[0].spu_name,sku_code:e[0].sku_code,series_number:e[0].series_number,unit:e[0].unit,is_update_stock:!1,qty_available:e[0].qty_available},-1))},insertTargetData:e=>{const s=b.value,l=s.getTableData().fullData;if(a.form.job_type===T)s.remove(),s.insertAt({id:0,stock_process_id:0,sku_id:e[0].sku_id,goods_owner_id:0,goods_location_id:0,qty:0,tenant_id:0,is_source:!1,spu_code:e[0].spu_code,spu_name:e[0].spu_name,sku_code:e[0].sku_code,unit:e[0].unit,is_update_stock:!1},-1);else if(a.form.job_type===E)for(const t of e)l.some(y=>y.sku_id===t.sku_id)||s.insertAt({id:0,stock_process_id:0,sku_id:t.sku_id,goods_owner_id:0,goods_location_id:0,qty:0,tenant_id:0,is_source:!1,spu_code:t.spu_code,spu_name:t.spu_name,sku_code:t.sku_code,unit:t.unit,is_update_stock:!1},-1)},exportTable:e=>{const s=e==="source"?h.value:b.value;Y({table:s,filename:r.global.t("router.sideBar.commodityManagement"),columnFilterMethod({column:l}){return!["checkbox"].includes(l==null?void 0:l.type)&&!["operate"].includes(l==null?void 0:l.field)}})},submit:async()=>{const e=await i.validSourceTable(),s=await i.validTargetTable();if(!e||!s)return;const l=i.constructFormBody(),{data:t}=await le(l);if(!t.isSuccess){g.$message({type:"error",content:t.errorMessage});return}g.$message({type:"success",content:`${r.global.t("system.page.submit")}${r.global.t("system.tips.success")}`}),x("saveSuccess")},constructFormBody:()=>{const e=h.value,s=b.value,l=e.getTableData().fullData,t=s.getTableData().fullData;let d={...a.form};return d.detailList=[...l,...t],d=J(d),delete d.source_detail_list,delete d.target_detail_list,d},validSourceTable:async()=>{const e=h.value;return e.getTableData().fullData.length?await e.validate()?(g.$message({type:"error",content:r.global.t("system.checkText.checkFormFail")}),!1):!0:(g.$message({type:"error",content:r.global.t("system.tips.detailLengthIsZero")}),!1)},validTargetTable:async()=>{const e=b.value;return e.getTableData().fullData.length?await e.validate()?(g.$message({type:"error",content:r.global.t("system.checkText.checkFormFail")}),!1):!0:(g.$message({type:"error",content:r.global.t("system.tips.detailLengthIsZero")}),!1)},validQty:({cellValue:e,row:s})=>{const l=e||0,t=s.qty_available||0;if(l>t)return new Error(`${r.global.t("wms.warehouseWorking.warehouseProcessing.qtyMoreThanAvailable")} ${t}`)},deleteRowSource:e=>{g.$dialog({content:r.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&h.value.remove(e)}})},deleteRowTarget:e=>{g.$dialog({content:r.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&b.value.remove(e)}})}}),a=B({tableData:[],curSelectType:"",showCommodityDialogSelect:!1,showSkuDialogSelect:!1,showLocationDialogSelect:!1,form:w({id:0,job_code:"",job_type:T,process_status:!1,processor:"",process_time:"",source_detail_list:[],target_detail_list:[]}),curSelectRow:w({id:0,stock_process_id:0,sku_id:0,goods_owner_id:0,goods_location_id:0,qty:0,is_source:!0,spu_code:"",spu_name:"",sku_code:"",unit:"",is_update_stock:!1}),validRulesSource:w({qty:[{required:!0,message:`${r.global.t("system.checkText.mustInput")}${r.global.t("wms.warehouseWorking.warehouseProcessing.qty")}`},{validator:i.validQty},{validator:O,validNumerical:"greaterThanZero",trigger:"change"}]}),validRulesTarget:w({qty:[{required:!0,message:`${r.global.t("system.checkText.mustInput")}${r.global.t("wms.warehouseWorking.warehouseProcessing.qty")}`},{validator:O,validNumerical:"greaterThanZero",trigger:"change"}],location_name:[{required:!0,message:`${r.global.t("system.checkText.mustInput")}${r.global.t("wms.warehouseWorking.warehouseProcessing.target_location")}`}]})});return X(()=>D.value,e=>{e&&i.initForm()}),(e,s)=>{const l=m("v-toolbar"),t=m("vxe-column"),d=m("vxe-input"),y=m("vxe-table"),W=m("v-col"),I=m("v-row"),A=m("v-card-text"),L=m("v-btn"),N=m("v-card-actions"),z=m("v-card"),Z=m("v-dialog");return ee(),te(se,null,[o(Z,{modelValue:_(D),"onUpdate:modelValue":s[2]||(s[2]=n=>oe(D)?D.value=n:null),width:"80%",transition:"dialog-top-transition",persistent:!0},{default:c(()=>[o(z,null,{default:c(()=>[o(l,{color:"white",title:_(U)},{default:c(()=>[o(G,{value:_(F)},null,8,["value"])]),_:1},8,["title"]),o(A,null,{default:c(()=>[o(I,null,{default:c(()=>[o(W,{cols:"6"},{default:c(()=>[f("div",ie,[f("div",re,[f("div",ne,[f("p",ce,k(e.$t("wms.warehouseWorking.warehouseProcessing.source")),1)]),o(q,{icon:"mdi-plus","tooltip-text":e.$t("system.page.add"),size:"x-small",disabled:_(P),onClick:s[0]||(s[0]=n=>i.openSelect("source"))},null,8,["tooltip-text","disabled"])]),o(y,{ref_key:"xTableSource",ref:h,"column-config":{minWidth:"100px"},data:a.form.source_detail_list,height:_(V).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":a.validRulesSource,align:"center"},{empty:c(()=>[C(k(_(r).global.t("system.page.noData")),1)]),default:c(()=>[o(t,{type:"seq",width:"60"}),o(t,{field:"operate",width:"50",title:e.$t("system.page.operate"),resizable:!1},{default:c(({row:n})=>[o(q,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":_(j),onClick:p=>i.deleteRowSource(n)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),o(t,{field:"spu_code",title:e.$t("wms.warehouseWorking.warehouseProcessing.spu_code")},null,8,["title"]),o(t,{field:"spu_name",title:e.$t("wms.warehouseWorking.warehouseProcessing.spu_name")},null,8,["title"]),o(t,{field:"sku_code",title:e.$t("wms.warehouseWorking.warehouseProcessing.sku_code")},null,8,["title"]),o(t,{field:"series_number",title:e.$t("wms.stockLocation.series_number")},null,8,["title"]),o(t,{field:"qty",title:e.$t("wms.warehouseWorking.warehouseProcessing.qty"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:c(({row:n})=>[o(d,{modelValue:n.qty,"onUpdate:modelValue":p=>n.qty=p,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),o(t,{field:"unit",title:e.$t("wms.warehouseWorking.warehouseProcessing.unit")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])])]),_:1}),o(W,{cols:"6"},{default:c(()=>[f("div",ue,[f("div",de,[f("div",_e,[f("p",me,k(e.$t("wms.warehouseWorking.warehouseProcessing.target")),1)]),o(q,{icon:"mdi-plus","tooltip-text":e.$t("system.page.add"),size:"x-small",disabled:_(P),onClick:s[1]||(s[1]=n=>i.openSelect("target"))},null,8,["tooltip-text","disabled"])]),o(y,{ref_key:"xTableTarget",ref:b,"column-config":{minWidth:"100px"},data:a.form.target_detail_list,height:_(V).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":a.validRulesTarget,align:"center"},{empty:c(()=>[C(k(_(r).global.t("system.page.noData")),1)]),default:c(()=>[o(t,{type:"seq",width:"60"}),o(t,{field:"operate",width:"50",title:e.$t("system.page.operate"),resizable:!1},{default:c(({row:n})=>[o(q,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":_(j),onClick:p=>i.deleteRowTarget(n)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),o(t,{field:"spu_code",title:e.$t("wms.warehouseWorking.warehouseProcessing.spu_code")},null,8,["title"]),o(t,{field:"spu_name",title:e.$t("wms.warehouseWorking.warehouseProcessing.spu_name")},null,8,["title"]),o(t,{field:"sku_code",title:e.$t("wms.warehouseWorking.warehouseProcessing.sku_code")},null,8,["title"]),o(t,{field:"qty",title:e.$t("wms.warehouseWorking.warehouseProcessing.qty"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:c(({row:n})=>[o(d,{modelValue:n.qty,"onUpdate:modelValue":p=>n.qty=p,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),o(t,{field:"unit",width:"60",title:e.$t("wms.warehouseWorking.warehouseProcessing.unit")},null,8,["title"]),o(t,{field:"location_name",title:e.$t("wms.warehouseWorking.warehouseProcessing.target_location"),"edit-render":{}},{edit:c(({row:n})=>[o(d,{modelValue:n.location_name,"onUpdate:modelValue":p=>n.location_name=p,readonly:"",type:"search",onSearchClick:p=>i.openLocationSelect(n)},null,8,["modelValue","onUpdate:modelValue","onSearchClick"])]),_:1},8,["title"])]),_:1},8,["data","height","edit-rules"])])]),_:1})]),_:1})]),_:1}),o(N,{class:"justify-end"},{default:c(()=>[o(L,{variant:"text",onClick:i.closeDialog},{default:c(()=>[C(k(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),o(L,{color:"primary",variant:"text",disabled:_(P),onClick:i.submit},{default:c(()=>[C(k(e.$t("system.page.submit")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Q,{"show-dialog":a.showCommodityDialogSelect,onClose:s[3]||(s[3]=n=>i.closeDialogSelect("source")),onSureSelect:i.sureSelect},null,8,["show-dialog","onSureSelect"]),o(R,{"show-dialog":a.showSkuDialogSelect,onClose:s[4]||(s[4]=n=>i.closeDialogSelect("target")),onSureSelect:i.sureSelect},null,8,["show-dialog","onSureSelect"]),o(H,{"show-dialog":a.showLocationDialogSelect,onClose:i.closeLocationDialogSelect,onSureSelect:i.sureSelectLocation},null,8,["show-dialog","onClose","onSureSelect"])],64)}}});const ge=ae(pe,[["__scopeId","data-v-6f9e2832"]]),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{Le as a,Ee as b,je as c,Ve as d,ge as e,Oe as f,We as g};
