import{i as m,w as O}from"./i18n-0af8b262.js";import{a as G,b as Q,e as q}from"./style-b9bc59b4.js";import{_ as S}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{u as H,g as K,d as j,a as J}from"./add-or-update-commodity-b4195903.js";import{a as f}from"./index-cd6d6b34.js";import{D as Z,a as W,c as Y,P as X,b as ee}from"./system-93ae242b.js";import{G as k}from"./commodityManagement-a1debff9.js";import{g as te,s as ae}from"./common-938b41ea.js";import{e as oe}from"./exportTable-b0d17537.js";import{B as se}from"./btnGroup-26ff2079.js";import ie from"./update-sku-safety-stock-44e7d008.js";import{B as ne}from"./barCodeDialog-3972f0b1.js";import{Q as le}from"./qrCodeDialog-8c21caa4.js";import{h as re}from"./hiprintFast-e8811561.js";import{d as de,b as v,r as C,o as ce,c as D,w as me,a as h,x as c,m as p,u as _,q as s,s as i,as as pe,ap as u,y as M,at as r,ar as ue,aK as ge,v as B,e as b}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./commodityCategorySetting-2425a593.js";import"./supplier-8eff24fc.js";import"./formRule-3feb276f.js";import"./tableRule-6aa0c57f.js";import"./index-ae8f073f.js";import"./warehouseSetting-835f9e1c.js";import"./formatSystem-1203ad16.js";import"./JsBarcode-61cdf20e.js";import"./JsBarcode-3dd77e18.js";import"./vue-qr-da17c00d.js";import"./printSolution-f5a888b7.js";const fe={class:"container"},he={class:"operateArea"},ye={key:0},be={key:1},ve={key:0},ke={key:1},$e={key:0},Se={key:1},Ce={key:0},De={key:0},Me={key:0},we={key:0},xe={key:0},Re={key:0},Le={key:0},Fe={key:0},Pe={key:1},Te=de({__name:"commodityManagement",setup(Be){const g=v(),$=v(),w=v(),x=v(),R=v(),o=C({searchForm:{spu_code:"",spu_name:"",category_name:""},timer:null,tableData:[],tablePage:{total:0,pageIndex:1,pageSize:Z},tableTreeConfig:{transform:!0,rowField:"tree_id",parentField:"parent_id"},showDialog:!1,dialogForm:{id:0,spu_code:"",spu_name:"",category_id:0,category_name:"",spu_description:"",bar_code:"",supplier_id:0,supplier_name:"",brand:"",origin:"",length_unit:1,volume_unit:0,weight_unit:1,detailList:[]},btnList:[],authorityList:te(),selectRowData:[]}),L=C({printForm:{}}),n=C({getCheckBoxDisableState:({row:e})=>e.parent_id,printQrCode:()=>{let e=g.value.getCheckboxRecords();const a=e.filter(l=>!l.parent_id);if(e=e.filter(l=>l.parent_id),e.length>0){for(const l of a)for(const y of e)l.id===y.parent_id&&(y.spu_code=l.spu_code,y.spu_name=l.spu_name,y.type="commodity");w.value.openDialog(e)}else f.$message({type:"error",content:m.global.t("base.userManagement.checkboxIsNull")})},printBarCode:()=>{let e=g.value.getCheckboxRecords();e=e.filter(a=>a.parent_id),e=e.filter(a=>a.bar_code),e.length>0?x.value.openDialog(e):f.$message({type:"error",content:m.global.t("base.userManagement.checkboxIsNull")})},print:()=>{const e=g.value.getCheckboxRecords();e.length>0?(L.printForm={detailList:e},R.value.method.handleOpen()):f.$message({type:"error",content:m.global.t("base.userManagement.checkboxIsNull")})},selectAllEvent({checked:e}){const a=g.value.getCheckboxRecords();e?o.selectRowData=a:o.selectRowData=[]},selectChangeEvent(){o.selectRowData=g.value.getCheckboxRecords()},expandAllRows:()=>{const e=g.value.getTreeExpandRecords(),a=o.tableData.filter(l=>!l.parent_id);e.length===a.length?g.value.setAllTreeExpand(!1):g.value.setAllTreeExpand(!0)},updateSkuSaftyStockByRow:async e=>{const{data:a}=await H(e);if(!a.isSuccess){f.$message({type:"error",content:a.errorMessage});return}f.$message({type:"success",content:`${m.global.t("system.page.submit")}${m.global.t("system.tips.success")}`}),$.value.closeDialog(),n.refresh()},openUpdateSaftyStockDialog:e=>{$.value.openDialog(e)},sureSearch:()=>{o.tablePage.searchObjects=ae(o.searchForm),n.getCompanyList()},getCompanyList:async()=>{const{data:e}=await K(o.tablePage);if(!e.isSuccess){f.$message({type:"error",content:e.errorMessage});return}o.tableData=[];for(const a of e.data.rows){a.tree_id=a.id,o.tableData.push(a);for(const l of a.detailList)l.tree_id=0,l.parent_id=a.id,l.length_unit=a.length_unit,l.volume_unit=a.volume_unit,l.weight_unit=a.weight_unit,o.tableData.push(l)}o.tablePage.total=e.data.totals},add:()=>{o.dialogForm={id:0,spu_code:"",spu_name:"",spu_description:"",brand:"",length_unit:1,volume_unit:0,weight_unit:1,detailList:[]},o.showDialog=!0},closeDialog:()=>{o.showDialog=!1},saveSuccess:()=>{n.refresh(),n.closeDialog()},refresh:()=>{n.getCompanyList()},editRow(e){o.dialogForm=JSON.parse(JSON.stringify(e)),o.showDialog=!0},deleteRow(e){f.$dialog({content:m.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:a}=await j(e.id);if(!a.isSuccess){f.$message({type:"error",content:a.errorMessage});return}f.$message({type:"success",content:`${m.global.t("system.page.delete")}${m.global.t("system.tips.success")}`}),n.refresh()}}})},exportTable:()=>{const e=g.value;oe({table:e,filename:m.global.t("router.sideBar.commodityManagement"),columnFilterMethod({column:a}){return!["checkbox"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},handlePageChange:v(({currentPage:e,pageSize:a})=>{o.tablePage.pageIndex=e,o.tablePage.pageSize=a,n.refresh()})});ce(async()=>{await n.getCompanyList(),o.btnList=[{name:m.global.t("system.page.add"),icon:"mdi-plus",code:"save",click:n.add},{name:m.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:n.refresh},{name:m.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:n.exportTable},{name:m.global.t("base.commodityManagement.printQrCode"),icon:"mdi-qrcode",code:"printQrCode",click:n.printQrCode},{name:m.global.t("base.commodityManagement.printBarCode"),icon:"mdi-barcode",code:"printBarCode",click:n.printBarCode},{name:m.global.t("system.page.print"),icon:"mdi-printer",code:"",click:n.print}]});const E=D(()=>G({hasTab:!1})),A=D(()=>Q({hasTab:!1})),I=D(()=>{const e=g.value.getTreeExpandRecords(),a=o.tableData.filter(l=>!l.parent_id);return e.length===a.length});return me(()=>o.searchForm,()=>{o.timer&&clearTimeout(o.timer),o.timer=setTimeout(()=>{o.timer=null,n.sureSearch()},W)},{deep:!0}),(e,a)=>{const l=h("v-col"),y=h("v-text-field"),F=h("v-row"),d=h("vxe-column"),P=h("v-icon"),V=h("v-tooltip"),z=h("vxe-table"),N=h("v-card-text"),U=h("v-card");return c(),p("div",fe,[_("div",null,[s(U,{class:"mt-5"},{default:i(()=>[s(N,null,{default:i(()=>[_("div",he,[s(F,{"no-gutters":""},{default:i(()=>[s(l,{cols:"12",sm:"4",class:"col"},{default:i(()=>[s(se,{"authority-list":o.authorityList,"btn-list":o.btnList},null,8,["authority-list","btn-list"])]),_:1}),s(l,{cols:"12",sm:"8"},{default:i(()=>[s(F,{"no-gutters":"",onKeyup:O(n.sureSearch,["enter"])},{default:i(()=>[s(l,{cols:"4"},{default:i(()=>[s(y,{modelValue:o.searchForm.spu_code,"onUpdate:modelValue":a[0]||(a[0]=t=>o.searchForm.spu_code=t),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("base.commodityManagement.spu_code"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),s(l,{cols:"4"},{default:i(()=>[s(y,{modelValue:o.searchForm.spu_name,"onUpdate:modelValue":a[1]||(a[1]=t=>o.searchForm.spu_name=t),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("base.commodityManagement.spu_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),s(l,{cols:"4"},{default:i(()=>[s(y,{modelValue:o.searchForm.category_name,"onUpdate:modelValue":a[2]||(a[2]=t=>o.searchForm.category_name=t),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("base.commodityManagement.category_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),_("div",{class:"mt-5",style:pe({height:u(E)})},[s(z,{ref_key:"xTable",ref:g,data:o.tableData,"column-config":{minWidth:"100px"},height:u(A),align:"center","tree-config":o.tableTreeConfig},{empty:i(()=>[M(r(u(m).global.t("system.page.noData")),1)]),default:i(()=>[s(d,{type:"checkbox",width:"50",fixed:"left"}),s(d,{type:"seq",width:"60"}),s(d,{"tree-node":"",width:"60"},{header:i(()=>[_("div",{style:{height:"100%",display:"flex","align-items":"center","justify-content":"flex-start",cursor:"pointer"},onClick:a[3]||(a[3]=t=>n.expandAllRows())},[s(V,{location:"bottom"},{activator:i(({props:t})=>[_("div",ue(ge(t)),[u(I)?(c(),B(P,{key:1,size:"large"},{default:i(()=>[M("mdi-menu-down")]),_:1})):(c(),B(P,{key:0,size:"large"},{default:i(()=>[M("mdi-menu-right")]),_:1}))],16)]),default:i(()=>[_("span",null,r(e.$t("base.roleMenu.expandRow")),1)]),_:1})])]),_:1}),s(d,{field:"spu_code",width:"150px",title:e.$t("base.commodityManagement.spu_code")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",ye,r(t.sku_code),1)):(c(),p("span",be,r(t.spu_code),1))]),_:1},8,["title"]),s(d,{field:"spu_name",title:e.$t("base.commodityManagement.spu_name")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",ve,r(t.sku_name),1)):(c(),p("span",ke,r(t.spu_name),1))]),_:1},8,["title"]),s(d,{field:"category_name",title:e.$t("base.commodityManagement.category_name")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",$e,r(t.unit),1)):(c(),p("span",Se,r(t.category_name),1))]),_:1},8,["title"]),s(d,{field:"spu_description",width:"200",title:e.$t("base.commodityManagement.spu_description")},null,8,["title"]),s(d,{field:"supplier_name",title:e.$t("base.commodityManagement.supplier_name")},null,8,["title"]),s(d,{field:"brand",title:e.$t("base.commodityManagement.brand")},null,8,["title"]),s(d,{field:"bar_code",title:e.$t("base.commodityManagement.bar_code")},null,8,["title"]),s(d,{field:"weight",title:e.$t("base.commodityManagement.weight")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",Ce,r(`${t.weight} ${u(k)("weight",t.weight_unit)}`),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"lenght",title:e.$t("base.commodityManagement.lenght")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",De,r(`${t.lenght} ${u(k)("length",t.length_unit)}`),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"width",title:e.$t("base.commodityManagement.width")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",Me,r(`${t.width} ${u(k)("length",t.length_unit)}`),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"height",title:e.$t("base.commodityManagement.height")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",we,r(`${t.height} ${u(k)("length",t.length_unit)}`),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"volume",title:e.$t("base.commodityManagement.volume")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",xe,r(`${t.volume} ${u(k)("volume",t.volume_unit)}`),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"cost",title:e.$t("base.commodityManagement.cost")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",Re,r(t.cost),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"price",title:e.$t("base.commodityManagement.price")},{default:i(({row:t})=>[t.parent_id>0?(c(),p("span",Le,r(t.price),1)):b("",!0)]),_:1},8,["title"]),s(d,{field:"operate",title:e.$t("system.page.operate"),width:"160px",resizable:!1,"show-overflow":""},{default:i(({row:t})=>[!t.parent_id||t.parent_id<=0?(c(),p("div",Fe,[s(S,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":e.$t("system.page.edit"),disabled:!o.authorityList.includes("save"),onClick:T=>n.editRow(t)},null,8,["tooltip-text","disabled","onClick"]),s(S,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":o.authorityList.includes("delete")?u(q):"",disabled:!o.authorityList.includes("delete"),onClick:T=>n.deleteRow(t)},null,8,["tooltip-text","icon-color","disabled","onClick"])])):(c(),p("div",Pe,[s(S,{flat:!0,icon:"mdi-alarm-light","tooltip-text":e.$t("base.commodityManagement.saftyStock"),disabled:!o.authorityList.includes("saftyStock"),onClick:T=>n.openUpdateSaftyStockDialog(t)},null,8,["tooltip-text","disabled","onClick"])]))]),_:1},8,["title"])]),_:1},8,["data","height","tree-config"]),s(Y,{"current-page":o.tablePage.pageIndex,"page-size":o.tablePage.pageSize,perfect:"",total:o.tablePage.total,"page-sizes":u(X),layouts:u(ee),onPageChange:n.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1})]),s(J,{"show-dialog":o.showDialog,form:o.dialogForm,onClose:n.closeDialog,onSaveSuccess:n.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),s(ie,{ref_key:"updateSkuSaftyStockRef",ref:$,onSure:n.updateSkuSaftyStockByRow},null,8,["onSure"]),s(le,{ref_key:"qrCodeDialogRef",ref:w,menu:"commodityManagement"},{left:i(({slotData:t})=>[_("p",null,r(e.$t("base.commodityManagement.spu_code"))+":"+r(t.spu_code),1),_("p",null,r(e.$t("base.commodityManagement.spu_name"))+":"+r(t.spu_name),1),_("p",null,r(e.$t("base.commodityManagement.sku_code"))+":"+r(t.sku_code),1),_("p",null,r(e.$t("base.commodityManagement.sku_name"))+":"+r(t.sku_name),1)]),_:1},512),s(ne,{ref_key:"barCodeDialogRef",ref:x,menu:"commodityManagement"},null,512),s(re,{ref_key:"hprintDialogRef",ref:R,form:L.printForm,"tab-page":"print_page_main"},null,8,["form"])])}}});const pt=_e(Te,[["__scopeId","data-v-c9bcc2ca"]]);export{pt as default};
