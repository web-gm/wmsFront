import{a as N,b as K}from"./style-b9bc59b4.js";import{u as T,g as V,d as z,a as I,_ as H}from"./add-or-update-role-menu.vue_vue_type_script_setup_true_lang-541d018d.js";import{a as c}from"./index-cd6d6b34.js";import{i}from"./i18n-0af8b262.js";import{N as j}from"./nav-list-52de5921.js";import{e as P}from"./exportTable-b0d17537.js";import{B as J}from"./btnGroup-26ff2079.js";import{_ as U}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{_ as W}from"./edit-menu-action.vue_vue_type_script_setup_true_lang-7412bcac.js";import{g as X}from"./actionList-473e0ea7.js";import{d as Y,b as F,r as $,o as q,c as b,a as d,x as u,m as f,u as r,q as s,s as l,as as G,ap as p,y as v,at as _,ar as Q,aK as Z,v as M,O as ee,b0 as te}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./userRoleSetting-2c2fc537.js";import"./common-938b41ea.js";import"./index-ae8f073f.js";const ae={class:"container"},se={class:"operateArea"},le={key:0,style:{margin:"10px 0",display:"flex","align-items":"center"}},ie={style:{"white-space":"nowrap"}},ne={key:1,style:{color:"#b9b7b7",margin:"10px 0",display:"flex","align-items":"center","justify-content":"center"}},re={style:{width:"100%",display:"flex","justify-content":"center"}},ce=Y({__name:"roleMenu",setup(de){const m=F(),y=F(),e=$({navListOptions:{title:i.global.t("base.roleMenu.role_name"),labelKey:"role_name",indexKey:"userrole_id",indexValue:""},activeRoleMenuForm:{userrole_id:0,role_name:"",detailList:[]},roleList:[],showDialog:!1,dialogForm:{detailList:[]},btnList:[],editMenuDialogCurrentRow:{id:-1,menu_id:-1,menu_name:"",menu_actions_authority:[]}}),o=$({editMenuSaveSuccess:async t=>{const{data:a}=await T({...e.activeRoleMenuForm,detailList:[{...e.editMenuDialogCurrentRow,menu_actions_authority:t}]});if(!a.isSuccess){c.$message({type:"error",content:a.errorMessage});return}y.value.closeDialog(),c.$message({type:"success",content:`${i.global.t("system.page.update")}${i.global.t("system.tips.success")}`}),o.refresh()},handleEditAction:t=>{e.editMenuDialogCurrentRow=t,y.value.openDialog(t.menu_actions_authority)},sureSearch:()=>{},getCompanyList:async()=>{o.clearDialogForm();const{data:t}=await V();if(!t.isSuccess){c.$message({type:"error",content:t.errorMessage});return}e.roleList=t.data,e.roleList.findIndex(a=>a.userrole_id===e.activeRoleMenuForm.userrole_id)>-1&&e.activeRoleMenuForm.userrole_id?o.getRoleMenus(e.activeRoleMenuForm.userrole_id):e.roleList.length>0?o.navListClick(e.roleList[0]):e.activeRoleMenuForm={userrole_id:0,role_name:"",detailList:[]}},add:()=>{o.clearDialogForm(),e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{o.refresh(),o.closeDialog()},refresh:()=>{o.getCompanyList()},editForm(){if(!e.activeRoleMenuForm.userrole_id){c.$message({type:"error",content:i.global.t("base.roleMenu.beforeUpdateOrDel")});return}e.dialogForm=JSON.parse(JSON.stringify(e.activeRoleMenuForm));for(const t of e.dialogForm.detailList)t._X_ROW_KEY&&delete t._X_ROW_KEY;e.showDialog=!0},deleteForm(){if(!e.activeRoleMenuForm.userrole_id){c.$message({type:"error",content:i.global.t("base.roleMenu.beforeUpdateOrDel")});return}const t=e.activeRoleMenuForm;c.$dialog({content:i.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.userrole_id){const{data:a}=await z(t.userrole_id);if(!a.isSuccess){c.$message({type:"error",content:a.errorMessage});return}c.$message({type:"success",content:`${i.global.t("system.page.delete")}${i.global.t("system.tips.success")}`}),o.refresh()}}})},exportTable:()=>{const t=m.value;P({table:t,filename:i.global.t("router.sideBar.roleMenu"),columnFilterMethod({column:a}){return!["checkbox"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},getRoleMenus:async t=>{const{data:a}=await I(t);if(!a.isSuccess){c.$message({type:"error",content:a.errorMessage});return}e.activeRoleMenuForm=a.data},clearDialogForm:()=>{e.dialogForm={detailList:[]}},navListClick:t=>{!t.userrole_id||(e.navListOptions.indexValue=String(t.userrole_id),o.getRoleMenus(t.userrole_id))},expandAllRows:()=>{m.value.getRowExpandRecords().length===e.activeRoleMenuForm.detailList.length?m.value.setAllRowExpand(!1):m.value.setAllRowExpand(!0)}});q(async()=>{await o.getCompanyList(),e.btnList=[{name:i.global.t("system.page.add"),icon:"mdi-plus",code:"",click:o.add},{name:i.global.t("system.page.edit"),icon:"mdi-pencil-outline",code:"",click:o.editForm},{name:i.global.t("system.page.delete"),icon:"mdi-delete-outline",code:"",click:o.deleteForm},{name:i.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh}]});const C=b(()=>m.value.getRowExpandRecords().length===e.activeRoleMenuForm.detailList.length),S=b(()=>N({hasTab:!1})),R=b(()=>K({hasTab:!1,hasPager:!1}));return(t,a)=>{const g=d("v-col"),x=d("v-row"),w=d("v-card"),L=d("v-icon"),D=d("v-tooltip"),O=d("v-chip"),h=d("vxe-column"),A=d("vxe-table"),E=d("v-card-text");return u(),f("div",ae,[r("div",null,[s(w,{class:"mt-5"},{default:l(()=>[s(E,null,{default:l(()=>[r("div",se,[s(x,{"no-gutters":""},{default:l(()=>[s(g,{cols:"12",sm:"4",class:"col"},{default:l(()=>[s(J,{"authority-list":[],"btn-list":e.btnList},null,8,["btn-list"])]),_:1}),s(g,{cols:"12",sm:"8"})]),_:1})]),r("div",{class:"mt-5",style:G({height:p(S)})},[s(x,{"no-gutters":!0},{default:l(()=>[s(g,{cols:3,class:"dataListCol"},{default:l(()=>[s(w,{height:p(R)},{default:l(()=>[s(j,{"list-data":e.roleList,title:e.navListOptions.title,"label-key":e.navListOptions.labelKey,"index-key":e.navListOptions.indexKey,"index-value":e.navListOptions.indexValue,onItemClick:o.navListClick},null,8,["list-data","title","label-key","index-key","index-value","onItemClick"])]),_:1},8,["height"])]),_:1}),s(g,{cols:9},{default:l(()=>[s(A,{ref_key:"xTable",ref:m,data:e.activeRoleMenuForm.detailList,"tree-config":{transform:!0},height:p(R),align:"center"},{empty:l(()=>[v(_(p(i).global.t("system.page.noData")),1)]),default:l(()=>[s(h,{type:"expand",width:"60"},{header:l(()=>[r("div",{style:{height:"100%",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},onClick:a[0]||(a[0]=n=>o.expandAllRows())},[s(D,{location:"bottom"},{activator:l(({props:n})=>[r("div",Q(Z(n)),[p(C)?(u(),M(L,{key:1,size:"large"},{default:l(()=>[v("mdi-chevron-down")]),_:1})):(u(),M(L,{key:0,size:"large"},{default:l(()=>[v("mdi-chevron-right")]),_:1}))],16)]),default:l(()=>[r("span",null,_(t.$t("base.roleMenu.expandRow")),1)]),_:1})])]),content:l(({row:n})=>[n.menu_actions_authority.length>0?(u(),f("div",le,[r("div",ie,_(t.$t("base.roleMenu.operation"))+": ",1),r("div",null,[(u(!0),f(ee,null,te(n.menu_actions_authority,(k,B)=>(u(),M(O,{key:B,color:"primary",size:"small"},{default:l(()=>[v(_(p(X)(k,n.menu_name)),1)]),_:2},1024))),128))])])):(u(),f("div",ne,_(t.$t("base.roleMenu.dataEmpty")),1))]),_:1}),s(h,{field:"menu_name",title:t.$t("base.roleMenu.menu_name")},{default:l(({row:n})=>[r("span",null,_(t.$t(`router.sideBar.${n.menu_name}`)),1)]),_:1},8,["title"]),s(h,{field:"operate",title:t.$t("system.page.operate"),width:"120",resizable:!1,"show-overflow":""},{default:l(({row:n})=>[r("div",re,[s(U,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":t.$t("system.page.edit")+t.$t("base.roleMenu.operation"),onClick:k=>o.handleEditAction(n)},null,8,["tooltip-text","onClick"])])]),_:1},8,["title"])]),_:1},8,["data","height"])]),_:1})]),_:1})],4)]),_:1})]),_:1})]),s(H,{"show-dialog":e.showDialog,form:e.dialogForm,onClose:o.closeDialog,onSaveSuccess:o.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),s(W,{ref_key:"editMenuActionRef",ref:y,row:e.editMenuDialogCurrentRow,onSaveSuccess:o.editMenuSaveSuccess},null,8,["row","onSaveSuccess"])])}}});const Se=oe(ce,[["__scopeId","data-v-e7ae1e00"]]);export{Se as default};
