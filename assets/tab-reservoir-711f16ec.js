import{i as n,w as D}from"./i18n-0af8b262.js";import{a as L,b as k,e as F}from"./style-b9bc59b4.js";import{A as v}from"./Warehouse-56a6b193.js";import{D as T,a as E,c as I,P as W,b as z}from"./system-93ae242b.js";import{a as g}from"./index-cd6d6b34.js";import{l as O,m as V}from"./warehouseSetting-835f9e1c.js";import{_ as w}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import M from"./add-or-update-reservoir-b744beda.js";import{f as B}from"./formatWarehouse-aebb7b18.js";import{f as R}from"./formatSystem-1203ad16.js";import{e as U}from"./exportTable-b0d17537.js";import{B as N}from"./btnGroup-26ff2079.js";import{g as G,s as H}from"./common-938b41ea.js";import{d as j,b as m,r as _,o as K,c as S,w as q,a as u,x as J,m as Z,u as h,q as t,s as l,at as x,ap as d,as as Y,O as Q}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./formRule-3feb276f.js";import"./index-ae8f073f.js";const ee={class:"operateArea"},ae=j({__name:"tab-reservoir",setup(te,{expose:A}){const f=m(),e=_({showDialog:!1,dialogForm:m({id:0,parent_id:0,warehouse_name:"",area_name:"",area_property:v.picking_area,is_valid:!0}),searchForm:{warehouse_name:"",area_name:""},activeTab:null,tableData:m([]),tablePage:_({total:0,pageIndex:1,pageSize:T,searchObjects:m([])}),timer:m(null),btnList:[],authorityList:G()}),o=_({add:()=>{e.dialogForm={id:0,parent_id:0,warehouse_name:"",area_name:"",area_property:v.picking_area,is_valid:!0},e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{o.refresh(),o.closeDialog()},refresh:()=>{o.getWarehouseAreaList()},getWarehouseAreaList:async()=>{const{data:a}=await O(e.tablePage);if(!a.isSuccess){g.$message({type:"error",content:a.errorMessage});return}e.tableData=a.data.rows,e.tablePage.total=a.data.totals},editRow(a){e.dialogForm=JSON.parse(JSON.stringify(a)),e.showDialog=!0},deleteRow(a){g.$dialog({content:n.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(a.id){const{data:s}=await V(a.id);if(!s.isSuccess){g.$message({type:"error",content:s.errorMessage});return}g.$message({type:"success",content:`${n.global.t("system.page.delete")}${n.global.t("system.tips.success")}`}),o.refresh()}}})},handlePageChange:m(({currentPage:a,pageSize:s})=>{e.tablePage.pageIndex=a,e.tablePage.pageSize=s,o.getWarehouseAreaList()}),exportTable:()=>{const a=f.value;U({table:a,filename:n.global.t("base.warehouseSetting.reservoirSetting"),columnFilterMethod({column:s}){return!["checkbox"].includes(s==null?void 0:s.type)&&!["operate"].includes(s==null?void 0:s.field)}})},sureSearch:()=>{e.tablePage.searchObjects=H(e.searchForm),o.getWarehouseAreaList()}});K(()=>{e.btnList=[{name:n.global.t("system.page.add"),icon:"mdi-plus",code:"area-save",click:o.add},{name:n.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:n.global.t("system.page.export"),icon:"mdi-export-variant",code:"area-export",click:o.exportTable}]});const P=S(()=>L({})),$=S(()=>k({}));return q(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,o.sureSearch()},E)},{deep:!0}),A({getWarehouseAreaList:o.getWarehouseAreaList}),(a,s)=>{const c=u("v-col"),b=u("v-text-field"),y=u("v-row"),i=u("vxe-column"),C=u("vxe-table");return J(),Z(Q,null,[h("div",ee,[t(y,{"no-gutters":""},{default:l(()=>[t(c,{cols:"3",class:"col"},{default:l(()=>[t(N,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),t(c,{cols:"9"},{default:l(()=>[t(y,{"no-gutters":"",onKeyup:D(o.sureSearch,["enter"])},{default:l(()=>[t(c,{cols:"4"}),t(c,{cols:"4"},{default:l(()=>[t(b,{modelValue:e.searchForm.warehouse_name,"onUpdate:modelValue":s[0]||(s[0]=r=>e.searchForm.warehouse_name=r),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:a.$t("base.warehouseSetting.warehouse_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(c,{cols:"4"},{default:l(()=>[t(b,{modelValue:e.searchForm.area_name,"onUpdate:modelValue":s[1]||(s[1]=r=>e.searchForm.area_name=r),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:a.$t("base.warehouseSetting.area_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),h("div",{class:"mt-5",style:Y({height:d(P)})},[t(C,{ref_key:"xTableWarehouseArea",ref:f,data:e.tableData,height:d($),align:"center"},{default:l(()=>[t(i,{type:"seq",width:"60"}),t(i,{type:"checkbox",width:"50"}),t(i,{field:"warehouse_name",title:a.$t("base.warehouseSetting.warehouse_name")},null,8,["title"]),t(i,{field:"area_name",title:a.$t("base.warehouseSetting.area_name")},null,8,["title"]),t(i,{field:"area_property",title:a.$t("base.warehouseSetting.area_property")},{default:l(({row:r,column:p})=>[h("span",null,x(d(B)(r[p.property])),1)]),_:1},8,["title"]),t(i,{field:"is_valid",title:a.$t("base.warehouseSetting.is_valid")},{default:l(({row:r,column:p})=>[h("span",null,x(d(R)(r[p.property])),1)]),_:1},8,["title"]),t(i,{field:"operate",title:a.$t("system.page.operate"),width:"160",resizable:!1,"show-overflow":""},{default:l(({row:r})=>[t(w,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":a.$t("system.page.edit"),disabled:!e.authorityList.includes("area-save"),onClick:p=>o.editRow(r)},null,8,["tooltip-text","disabled","onClick"]),t(w,{flat:!0,icon:"mdi-delete-outline","tooltip-text":a.$t("system.page.delete"),"icon-color":e.authorityList.includes("area-delete")?d(F):"",disabled:!e.authorityList.includes("area-delete"),onClick:p=>o.deleteRow(r)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),t(I,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":d(W),layouts:d(z),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4),t(M,{"show-dialog":e.showDialog,form:e.dialogForm,onClose:o.closeDialog,onSaveSuccess:o.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"])],64)}}});const Ae=X(ae,[["__scopeId","data-v-caea113b"]]);export{Ae as default};
