import{i,w as I}from"./i18n-0af8b262.js";import{a as R,b as E,e as V}from"./style-b9bc59b4.js";import{D as N,a as B,c as z,P as A,b as U}from"./system-93ae242b.js";import{a as r}from"./index-cd6d6b34.js";import{b as q,d as G,e as Q,f as j}from"./deliveryManagement-7eebd823.js";import{_ as v}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import H from"./add-or-update-shipment-446ce095.js";import K from"./confirm-order-5c84f6fc.js";import{G as $}from"./commodityManagement-a1debff9.js";import{g as W,s as Z}from"./common-938b41ea.js";import{e as J}from"./exportTable-b0d17537.js";import{_ as Y}from"./search-delivered-main-detail.vue_vue_type_script_setup_true_lang-4c46cac7.js";import{B as X}from"./btnGroup-26ff2079.js";import{Q as ee}from"./qrCodeDialog-8c21caa4.js";import{h as y}from"./httpCodeJudge-e416f8ca.js";import{d as te,b as m,r as D,o as ae,c as k,w as se,a as u,x as oe,m as le,u as p,q as o,s as n,y as x,at as g,ap as d,as as ie,O as ne}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./customer-7e6fccb3.js";import"./custom-filter-select.vue_vue_type_script_setup_true_lang-d6331575.js";import"./sku-select-e1d3e93a.js";import"./stockManagement-a6372198.js";import"./formRule-3feb276f.js";import"./index-ae8f073f.js";import"./tableRule-6aa0c57f.js";import"./vue-qr-da17c00d.js";function _(w){switch(w){case 0:return i.global.t("wms.deliveryManagement.preShipment");case 1:return i.global.t("wms.deliveryManagement.newShipment");case 2:return i.global.t("wms.deliveryManagement.goodsToBePicked");case 3:return i.global.t("wms.deliveryManagement.picked");case 4:return i.global.t("wms.deliveryManagement.packaged");case 5:return i.global.t("wms.deliveryManagement.weighed");case 6:return i.global.t("wms.deliveryManagement.outOfWarehouse");case 7:return i.global.t("wms.deliveryManagement.signedIn")}}const ce={class:"operateArea"},de={style:{width:"100%",display:"flex","justify-content":"center"}},me=te({__name:"tabShipment",setup(w,{expose:P}){const h=m(),M=m(),e=D({showDeliveredMainDetailNo:"",showDeliveredMainDetail:!1,showDialog:!1,dialogForm:{id:0,detailList:[]},searchForm:m({dispatch_no:"",customer_name:""}),timer:m(null),activeTab:null,tableData:m([]),tablePage:m({total:0,pageIndex:1,pageSize:N,searchObjects:[]}),showConfirmOrder:!1,confirmOrderNo:"",combobox:{dispatch_status:[{label:i.global.t("wms.deliveryManagement.preShipment"),value:"0"},{label:i.global.t("wms.deliveryManagement.newShipment"),value:"1"},{label:i.global.t("wms.deliveryManagement.goodsToBePicked"),value:"2"},{label:i.global.t("wms.deliveryManagement.picked"),value:"3"},{label:i.global.t("wms.deliveryManagement.packaged"),value:"4"},{label:i.global.t("wms.deliveryManagement.weighed"),value:"5"},{label:i.global.t("wms.deliveryManagement.outOfWarehouse"),value:"6"},{label:i.global.t("wms.deliveryManagement.signedIn"),value:"7"}]},btnList:[],authorityList:W(),selectRowData:[]}),s=D({printQrCode:()=>{const t=h.value.getCheckboxRecords();if(t.length>0){for(const a of t)a.id=a.dispatch_no,a.type="delivery";M.value.openDialog(t)}else r.$message({type:"error",content:i.global.t("base.userManagement.checkboxIsNull")})},selectAllEvent({checked:t}){const a=h.value.getCheckboxRecords();t?e.selectRowData=a:e.selectRowData=[]},selectChangeEvent(){e.selectRowData=h.value.getCheckboxRecords()},viewRow:t=>{t.dispatch_no&&(e.showDeliveredMainDetailNo=t.dispatch_no,e.showDeliveredMainDetail=!0)},closeDeliveredDetail:()=>{e.showDeliveredMainDetail=!1},confirmPicking:async t=>{r.$dialog({content:`${i.global.t("wms.deliveryManagement.confirmPicking")}?`,handleConfirm:async()=>{if(t.dispatch_no){const{data:a}=await q(t.dispatch_no);if(!a.isSuccess){if(y(a.errorMessage)){s.refresh();return}r.$message({type:"error",content:a.errorMessage});return}r.$message({type:"success",content:a.data}),s.refresh()}}})},backToThePreviousStep(t){r.$dialog({content:`${i.global.t("wms.deliveryManagement.confirmBack")}?`,handleConfirm:async()=>{const{data:a}=await G({dispatch_no:t.dispatch_no,dispatch_status:t.dispatch_status});if(!a.isSuccess){if(y(a.errorMessage)){s.refresh();return}r.$message({type:"error",content:a.errorMessage});return}r.$message({type:"success",content:a.data}),s.refresh()}})},closeConfirmOrder:()=>{e.showConfirmOrder=!1},confirmSuccess:()=>{s.refresh(),s.closeConfirmOrder()},saveSuccess:()=>{s.refresh(),s.closeDialog()},closeDialog:()=>{e.showDialog=!1},clearDialogForm:()=>{e.dialogForm={id:0,detailList:[]}},add:()=>{s.clearDialogForm(),e.showDialog=!0},confirmOrder:t=>{if(t.dispatch_status===void 0||![0,1].includes(t.dispatch_status)){r.$message({type:"error",content:`${i.global.t("wms.deliveryManagement.incorrectStatusMsg")}${_(0)}${i.global.t("wms.deliveryManagement.or")}${_(1)}`});return}t.dispatch_no&&(e.confirmOrderNo=t.dispatch_no,e.showConfirmOrder=!0)},deleteRow:t=>{r.$dialog({content:i.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.dispatch_no){const{data:a}=await Q(t.dispatch_no);if(!a.isSuccess){if(y(a.errorMessage)){s.refresh();return}r.$message({type:"error",content:a.errorMessage});return}r.$message({type:"success",content:`${i.global.t("system.page.delete")}${i.global.t("system.tips.success")}`}),s.refresh()}}})},refresh:()=>{s.getShipment()},getShipment:async()=>{const{data:t}=await j(e.tablePage);if(!t.isSuccess){r.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},handlePageChange:m(({currentPage:t,pageSize:a})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=a,s.getShipment()}),exportTable:()=>{const t=h.value;J({table:t,filename:i.global.t("wms.deliveryManagement.shipment"),columnFilterMethod({column:a}){return!["checkbox"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},sureSearch:()=>{e.tablePage.searchObjects=Z(e.searchForm,["dispatch_status"]),s.getShipment()}});ae(()=>{e.btnList=[{name:i.global.t("system.page.add"),icon:"mdi-plus",code:"invoice-save",click:s.add},{name:i.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:s.refresh},{name:i.global.t("system.page.export"),icon:"mdi-export-variant",code:"invoice-export",click:s.exportTable},{name:i.global.t("base.commodityManagement.printQrCode"),icon:"mdi-qrcode",code:"invoice-printQrCode",click:s.printQrCode}]});const O=k(()=>R({})),T=k(()=>E({}));return se(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,s.sureSearch()},B)},{deep:!0}),P({getShipment:s.getShipment}),(t,a)=>{const f=u("v-col"),C=u("v-text-field"),F=u("v-select"),S=u("v-row"),c=u("vxe-column"),L=u("vxe-table");return oe(),le(ne,null,[p("div",ce,[o(S,{"no-gutters":""},{default:n(()=>[o(f,{cols:"3",class:"col"},{default:n(()=>[o(X,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),o(f,{cols:"9"},{default:n(()=>[o(S,{"no-gutters":"",onKeyup:I(s.sureSearch,["enter"])},{default:n(()=>[o(f,{cols:"4"},{default:n(()=>[o(C,{modelValue:e.searchForm.dispatch_no,"onUpdate:modelValue":a[0]||(a[0]=l=>e.searchForm.dispatch_no=l),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.dispatch_no"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),o(f,{cols:"4"},{default:n(()=>[o(F,{modelValue:e.searchForm.dispatch_status,"onUpdate:modelValue":a[1]||(a[1]=l=>e.searchForm.dispatch_status=l),items:e.combobox.dispatch_status,"item-title":"label","item-value":"value",label:t.$t("wms.deliveryManagement.dispatch_status"),variant:"solo",density:"comfortable",class:"searchInput ml-5 mt-1",clearable:"","hide-details":""},null,8,["modelValue","items","label"])]),_:1}),o(f,{cols:"4"},{default:n(()=>[o(C,{modelValue:e.searchForm.customer_name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.searchForm.customer_name=l),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),p("div",{class:"mt-5",style:ie({height:d(O)})},[o(L,{ref_key:"xTable",ref:h,"column-config":{minWidth:"100px"},data:e.tableData,height:d(T),align:"center"},{empty:n(()=>[x(g(d(i).global.t("system.page.noData")),1)]),default:n(()=>[o(c,{type:"checkbox",width:"50",fixed:"left"}),o(c,{type:"seq",width:"60"}),o(c,{field:"dispatch_no",width:"120",title:t.$t("wms.deliveryManagement.dispatch_no")},null,8,["title"]),o(c,{field:"dispatch_status",title:t.$t("wms.deliveryManagement.dispatch_status")},{default:n(({row:l})=>[p("span",null,g(d(_)(l.dispatch_status)),1)]),_:1},8,["title"]),o(c,{field:"qty",title:t.$t("wms.deliveryManagement.qty")},null,8,["title"]),o(c,{field:"weight",title:t.$t("wms.deliveryManagement.weight")},{default:n(({row:l})=>[p("span",null,g(`${l.weight} ${d($)("weight",2)}`),1)]),_:1},8,["title"]),o(c,{field:"volume",title:t.$t("wms.deliveryManagement.volume")},{default:n(({row:l})=>[p("span",null,g(`${l.volume} ${d($)("volume",1)}`),1)]),_:1},8,["title"]),o(c,{field:"customer_name",title:t.$t("wms.deliveryManagement.customer_name")},null,8,["title"]),o(c,{field:"creator",title:t.$t("wms.deliveryManagement.creator")},null,8,["title"]),o(c,{field:"operate",title:t.$t("system.page.operate"),width:"300px",resizable:!1,"show-overflow":""},{default:n(({row:l})=>[p("div",de,[o(v,{flat:!0,icon:"mdi-eye-outline","tooltip-text":t.$t("system.page.view"),onClick:b=>s.viewRow(l)},null,8,["tooltip-text","onClick"]),o(v,{disabled:!e.authorityList.includes("invoice-confirm")||l.dispatch_status!==0&&l.dispatch_status!==1,flat:!0,icon:"mdi-clipboard-check-outline","tooltip-text":t.$t("wms.deliveryManagement.confirmOrder"),onClick:b=>s.confirmOrder(l)},null,8,["disabled","tooltip-text","onClick"]),o(v,{disabled:!e.authorityList.includes("picked-confirm")||l.dispatch_status!==2,flat:!0,icon:"mdi-cart-arrow-down","tooltip-text":t.$t("wms.deliveryManagement.confirmPicking"),onClick:b=>s.confirmPicking(l)},null,8,["disabled","tooltip-text","onClick"]),o(v,{disabled:l.dispatch_status===2&&!e.authorityList.includes("invoice-revoke")||l.dispatch_status===3&&!e.authorityList.includes("picked-revoke")||l.dispatch_status!==2&&l.dispatch_status!==3,flat:!0,icon:"mdi-arrow-u-left-top","tooltip-text":t.$t("wms.deliveryManagement.backToThePreviousStep"),onClick:b=>s.backToThePreviousStep(l)},null,8,["disabled","tooltip-text","onClick"]),o(v,{disabled:!e.authorityList.includes("invoice-delete")||l.dispatch_status!==0&&l.dispatch_status!==1,flat:!0,icon:"mdi-delete-outline","tooltip-text":t.$t("system.page.delete"),"icon-color":!e.authorityList.includes("invoice-delete")||l.dispatch_status!==0&&l.dispatch_status!==1?"":d(V),onClick:b=>s.deleteRow(l)},null,8,["disabled","tooltip-text","icon-color","onClick"])])]),_:1},8,["title"])]),_:1},8,["data","height"]),o(z,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":d(A),layouts:d(U),onPageChange:s.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"]),o(H,{"show-dialog":e.showDialog,form:e.dialogForm,onClose:s.closeDialog,onSaveSuccess:s.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),o(K,{"confirm-order-no":e.confirmOrderNo,"show-dialog":e.showConfirmOrder,onClose:s.closeConfirmOrder,onSaveSuccess:s.confirmSuccess},null,8,["confirm-order-no","show-dialog","onClose","onSaveSuccess"]),o(Y,{"dispatch-no":e.showDeliveredMainDetailNo,"show-dialog":e.showDeliveredMainDetail,onClose:s.closeDeliveredDetail},null,8,["dispatch-no","show-dialog","onClose"]),o(ee,{ref_key:"qrCodeDialogRef",ref:M,menu:"deliveryManagement-shipment"},{left:n(({slotData:l})=>[p("p",null,g(t.$t("wms.deliveryManagement.dispatch_no"))+":"+g(l.dispatch_no),1),x("   ")]),_:1},512)],4)],64)}}});const Ae=re(me,[["__scopeId","data-v-3ce554fb"]]);export{Ae as default};
