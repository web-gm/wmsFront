import{i as t,v as N}from"./i18n-0af8b262.js";import{r as I,u as M,e as q}from"./exportTable-b0d17537.js";import{e as z}from"./supplier-8eff24fc.js";import{a as $}from"./index-cd6d6b34.js";import{S as L,e as j}from"./style-b9bc59b4.js";import{_ as C}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{d as A,b as h,c as H,r as V,w as J,a as c,x as O,v as G,s as p,q as a,u as w,t as U,ap as D,y as S,at as T,ac as W}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";const Z={class:"mb-4"},K=A({__name:"import-supplier-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(B,{emit:E}){const F=B,k=h(),u=h(),_=H(()=>F.showDialog),m=V({importData:h([]),validRules:h({})}),n=V({initForm:()=>{m.importData=[]},closeDialog:()=>{E("close")},submit:async()=>{if(!n.valid())return;const d=u.value.getTableData().fullData,{data:o}=await z(d);if(!o.isSuccess){$.$message({type:"error",content:o.errorMessage});return}$.$message({type:"success",content:`${t.global.t("system.page.submit")}${t.global.t("system.tips.success")}`}),E("saveSuccess")},valid:()=>u.value.getTableData().fullData.length<=0?($.$message({type:"error",content:`${t.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{k.value.value="",k.value.click()},readExcel:async e=>{const l=e.target.files;if(l.length<=0)return!1;const d=l[0],o=new FileReader;o.onload=b=>{var f;const v=(f=b==null?void 0:b.target)==null?void 0:f.result;if(v){const y=I(v,{type:"binary"}),x=y.SheetNames[0];let g=M.sheet_to_json(y.Sheets[x]),r=JSON.stringify(g);r=r.replace(/（/g,"("),r=r.replace(/）/g,")"),g=JSON.parse(r),m.importData=[],g.forEach((R,s,i)=>{m.importData.push({supplier_name:i[s][t.global.t("base.supplier.supplier_name")]?`${i[s][t.global.t("base.supplier.supplier_name")]}`:"",city:i[s][t.global.t("base.supplier.city")]?`${i[s][t.global.t("base.supplier.city")]}`:"",address:i[s][t.global.t("base.supplier.address")]?`${i[s][t.global.t("base.supplier.address")]}`:"",manager:i[s][t.global.t("base.supplier.manager")]?`${i[s][t.global.t("base.supplier.manager")]}`:"",email:i[s][t.global.t("base.supplier.email")]?`${i[s][t.global.t("base.supplier.email")]}`:"",contact_tel:i[s][t.global.t("base.supplier.contact_tel")]?`${i[s][t.global.t("base.supplier.contact_tel")]}`:""})})}},o.readAsBinaryString(d)},exportTemplate:()=>{const e=u.value;q({table:e,filename:t.global.t("router.sideBar.supplier"),mode:"header",columnFilterMethod({column:l}){return!["checkbox","seq"].includes(l==null?void 0:l.type)&&!["operate"].includes(l==null?void 0:l.field)}})},deleteRow:e=>{$.$dialog({content:t.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&u.value.remove(e)}})}});return J(()=>_.value,e=>{e&&n.initForm()}),(e,l)=>{const d=c("v-toolbar"),o=c("vxe-column"),b=c("vxe-table"),v=c("v-card-text"),f=c("v-btn"),y=c("v-card-actions"),x=c("v-card"),g=c("v-dialog");return O(),G(g,{modelValue:D(_),"onUpdate:modelValue":l[1]||(l[1]=r=>W(_)?_.value=r:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:p(()=>[a(x,null,{default:p(()=>[a(d,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),a(v,null,{default:p(()=>[w("div",Z,[a(C,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:n.chooseFile},null,8,["tooltip-text","onClick"]),a(C,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:n.exportTemplate},null,8,["tooltip-text","onClick"]),U(w("input",{id:"open",ref_key:"uploadExcel",ref:k,type:"file",accept:".xls, .xlsx",onChange:l[0]||(l[0]=(...r)=>n.readExcel&&n.readExcel(...r))},null,544),[[N,!1]])]),a(b,{ref_key:"xTable",ref:u,"column-config":{minWidth:"100px"},data:m.importData,height:D(L).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":m.validRules,"export-config":{},align:"center"},{empty:p(()=>[S(T(D(t).global.t("system.page.noData")),1)]),default:p(()=>[a(o,{type:"seq",width:"60"}),a(o,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:p(({row:r})=>[a(C,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":D(j),onClick:R=>n.deleteRow(r)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),a(o,{field:"supplier_name",title:e.$t("base.supplier.supplier_name")},null,8,["title"]),a(o,{field:"city",title:e.$t("base.supplier.city")},null,8,["title"]),a(o,{field:"address",title:e.$t("base.supplier.address")},null,8,["title"]),a(o,{field:"manager",title:e.$t("base.supplier.manager")},null,8,["title"]),a(o,{field:"email",title:e.$t("base.supplier.email")},null,8,["title"]),a(o,{field:"contact_tel",title:e.$t("base.supplier.contact_tel")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),a(y,{class:"justify-end"},{default:p(()=>[a(f,{variant:"text",onClick:n.closeDialog},{default:p(()=>[S(T(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(f,{color:"primary",variant:"text",onClick:n.submit},{default:p(()=>[S(T(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const pe=Y(K,[["__scopeId","data-v-6677397f"]]);export{pe as default};
