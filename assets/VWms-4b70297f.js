import{b as C,v as j}from"./i18n-0af8b262.js";import{b as xe}from"./vue-router-1283ad2d.js";import{_ as r}from"./lodash-b35d7d50.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{a as N,x,m as $,u as e,q as l,s as k,at as c,aZ as ie,aY as ue,d as de,e as A,t as J,ap as K,y as T,c as oe,O as Fe,b0 as Ee,aq as Be,as as Ge,b as w,o as $e,r as Me,w as Pe,v as se}from"./runtime-core.esm-bundler-1bbee395.js";import{f as Ce}from"./formatWarehouse-aebb7b18.js";import Ne from"./Bar-efd64b6c.js";import ze from"./Pie-a1c741cd.js";import"./Warehouse-56a6b193.js";import"./index-f9a914d4.js";const re=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],M=(()=>{if(typeof document>"u")return!1;const t=re[0],a={};for(const n of re)if((n==null?void 0:n[1])in document){for(const[d,f]of n.entries())a[t[d]]=f;return a}return!1})(),le={change:M.fullscreenchange,error:M.fullscreenerror};let I={request(t=document.documentElement,a){return new Promise((n,h)=>{const d=()=>{I.off("change",d),n()};I.on("change",d);const f=t[M.requestFullscreen](a);f instanceof Promise&&f.then(d).catch(h)})},exit(){return new Promise((t,a)=>{if(!I.isFullscreen){t();return}const n=()=>{I.off("change",n),t()};I.on("change",n);const h=document[M.exitFullscreen]();h instanceof Promise&&h.then(n).catch(a)})},toggle(t,a){return I.isFullscreen?I.exit():I.request(t,a)},onchange(t){I.on("change",t)},onerror(t){I.on("error",t)},on(t,a){const n=le[t];n&&document.addEventListener(n,a,!1)},off(t,a){const n=le[t];n&&document.removeEventListener(n,a,!1)},raw:M};Object.defineProperties(I,{isFullscreen:{get:()=>Boolean(document[M.fullscreenElement])},element:{enumerable:!0,get:()=>document[M.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>Boolean(document[M.fullscreenEnabled])}});M||(I={isEnabled:!1});const _e=I;const We=t=>(ie("data-v-3fc80440"),t=t(),ue(),t),Te={class:"mask"},Ve=We(()=>e("div",{class:"loading-title"},[e("div",null,"ModernWMS")],-1)),Le={class:"loading-progress-bar"},Oe={__name:"LoadingPage",props:{progress:{type:Number,required:!0,default:0}},setup(t){const a=t;return(n,h)=>{const d=N("v-progress-linear");return x(),$("div",Te,[Ve,e("div",Le,[l(d,{"model-value":a.progress,color:"indigo",height:"25",striped:""},{default:k(()=>[e("strong",null,c(a.progress)+"%",1)]),_:1},8,["model-value"])])])}}},Re=Q(Oe,[["__scopeId","data-v-3fc80440"]]),ce=(t,a,n)=>{const h={area:[]};return t.forEach(d=>{const f=a.filter(u=>u.warehouse_area_id==d.id),S=Object.values(r.groupBy(f,"shelf_number")),i=[];S.forEach(u=>{const{layer:g,column:y}=je(u),b={shelf_name:u[0].shelf_number,layer:g,column:y,shelfItems:Ae(u,n)};i.push(b)});const p={...d,shelves:i};h.area.push(p)}),h},je=t=>{const a=r.maxBy(t,"layer_number"),n=parseInt(a.tag_number);let h=parseInt(a.layer_number),d=Math.ceil(n/h);return h<3&&d<3&&(h=3,d=3),{layer:h,column:d}},Ae=(t,a)=>r.flatMap(t,n=>{const h=r.filter(a,{goods_location_id:n.id});return{...n,product:[...h]}}),Z=(t,a,n)=>{const h=r.groupBy(t,a);return r.map(h,(d,f)=>({value:r.sumBy(d,n),name:f}))},D=t=>(ie("data-v-a8bf68bf"),t=t(),ue(),t),Je={class:"warehouse-info VWms-card"},Qe={key:0},He={class:"header"},Ue={class:"main-title"},Ye={class:"sub-title"},Ze={class:"text-grid"},Ke=D(()=>e("p",null,"负责人:",-1)),Xe=D(()=>e("p",null,"联系电话:",-1)),ea=D(()=>e("p",null,"Email:",-1)),aa={class:"data-grid"},ta={class:"column-center data-container"},na=D(()=>e("p",{class:"data-label"},"库区数",-1)),oa={class:"data-number"},sa={class:"column-center data-container"},ra=D(()=>e("p",{class:"data-label"},"库存量",-1)),la={class:"data-number"},_a={class:"header"},ca={class:"main-title"},ia={class:"sub-title"},ua={class:"data-grid"},da={class:"column-center data-container"},ma=D(()=>e("p",{class:"data-label"},"总货架数",-1)),ha={class:"data-number"},pa={class:"column-center data-container"},fa=D(()=>e("p",{class:"data-label"},"总库位数",-1)),va={class:"data-number"},ya={class:"column-center data-container"},ga=D(()=>e("p",{class:"data-label"},"剩余库位",-1)),ba={class:"data-number"},wa={class:"column-center data-container"},ka=D(()=>e("p",{class:"data-label"},"总货物数",-1)),Da={class:"data-number"},qa={class:"flex-center-between"},Ia={class:"header"},Sa={class:"main-title"},xa=D(()=>e("span",{class:"em"},"货架规格: ",-1)),Fa={class:"data-grid"},Ea={class:"column-center data-container"},Ba=D(()=>e("p",{class:"data-label"},"闲置库位",-1)),Ga={class:"data-number"},$a={class:"column-center data-container"},Ma=D(()=>e("p",{class:"data-label"},"总货物数",-1)),Pa={class:"data-number"},Ca={class:"header"},Na={class:"main-title"},za={class:"text-grid"},Wa=D(()=>e("p",null,"层号:",-1)),Ta=D(()=>e("p",null,"货架编码:",-1)),Va={key:0},La={key:1,class:"product-info-container"},Oa=de({__name:"Detail",props:["presentData"],setup(t){const a=t;return(n,h)=>{const d=N("v-divider"),f=N("vxe-column"),S=N("vxe-table");return x(),$("div",Je,[l(C,{name:"slide-fade"},{default:k(()=>{var i,p,u,g,y,b,B,V;return[((i=a.presentData)==null?void 0:i.type)==="warehouse"?(x(),$("div",Qe,[e("div",He,[e("p",Ue,c((p=a.presentData)==null?void 0:p.warehouse_name),1),e("p",Ye,c((u=a.presentData)==null?void 0:u.address),1)]),e("div",Ze,[Ke,e("p",null,c((g=a.presentData)==null?void 0:g.manager),1),Xe,e("p",null,c((y=a.presentData)==null?void 0:y.contact_tel),1),ea,e("p",null,c((b=a.presentData)==null?void 0:b.email),1)]),l(d),e("div",aa,[e("div",ta,[na,e("p",oa,c((B=a.presentData)==null?void 0:B.factory_number),1)]),e("div",sa,[ra,e("p",la,c((V=a.presentData)==null?void 0:V.warehouse_product_number),1)])])])):A("",!0)]}),_:1}),l(C,{name:"slide-fade"},{default:k(()=>{var i,p,u,g,y,b,B;return[J(e("div",null,[e("div",_a,[e("p",ca,c((i=a.presentData)==null?void 0:i.area_name),1),e("p",ia,c(K(Ce)((p=a.presentData)==null?void 0:p.area_property)),1)]),l(d),e("div",ua,[e("div",da,[ma,e("p",ha,c((u=a.presentData)==null?void 0:u.shelf_number),1)]),e("div",pa,[fa,e("p",va,c((g=a.presentData)==null?void 0:g.shelf_item_number),1)]),e("div",ya,[ga,e("p",ba,c((y=a.presentData)==null?void 0:y.surplus_number),1)]),e("div",wa,[ka,e("p",Da,c((b=a.presentData)==null?void 0:b.factory_product_number),1)])])],512),[[j,((B=a.presentData)==null?void 0:B.type)==="factory"]])]}),_:1}),l(C,{name:"slide-fade"},{default:k(()=>{var i,p,u,g,y,b;return[J(e("div",null,[e("div",qa,[e("div",Ia,[e("p",Sa,c((i=a.presentData)==null?void 0:i.shelf_name),1)]),e("p",null,[xa,T(c((p=a.presentData)==null?void 0:p.layer)+" * "+c((u=a.presentData)==null?void 0:u.column),1)])]),l(d),e("div",Fa,[e("div",Ea,[Ba,e("p",Ga,c((g=a.presentData)==null?void 0:g.surplus_number),1)]),e("div",$a,[Ma,e("p",Pa,c((y=a.presentData)==null?void 0:y.shelf_product_number),1)])])],512),[[j,((b=a.presentData)==null?void 0:b.type)==="shelf"]])]}),_:1}),l(C,{name:"slide-fade"},{default:k(()=>{var i,p,u,g,y,b,B;return[J(e("div",null,[e("div",Ca,[e("p",Na,c((i=a.presentData)==null?void 0:i.tag_number)+"号库位",1)]),e("div",za,[Wa,e("p",null,c((p=a.presentData)==null?void 0:p.layer_number),1),Ta,e("p",null,c((u=a.presentData)==null?void 0:u.location_name),1)]),l(d),e("div",null,[((y=(g=a.presentData)==null?void 0:g.product)==null?void 0:y.length)===0?(x(),$("div",Va,"空库位")):(x(),$("div",La,[l(S,{align:"center",data:(b=a.presentData)==null?void 0:b.product,border:"",height:"160","row-config":{isHover:!0}},{default:k(()=>[l(f,{type:"seq",width:"60"}),l(f,{field:"spu_name",title:"货物名称"}),l(f,{field:"sku_name",title:"规格名称"}),l(f,{field:"qty",title:"数量"})]),_:1},8,["data"])]))])],512),[[j,((B=a.presentData)==null?void 0:B.type)==="shelfItem"]])]}),_:1})])}}});const Ra=Q(Oa,[["__scopeId","data-v-a8bf68bf"]]);const ja={class:"shelf-container"},Aa={class:"info"},Ja=["data-index"],Qa={__name:"ShelfGrid",props:{shelfGridData:{type:Object},selectIndex:{type:Number}},emits:["selectShelfItem"],setup(t,{emit:a}){const n=t,h=oe(()=>({gridTemplateColumns:`repeat(${n.shelfGridData.column}, 1fr)`,gridTemplateRows:`repeat(${n.shelfGridData.layer}, 1fr)`})),d=oe(()=>{const S=Array.from({length:n.shelfGridData.layer*n.shelfGridData.column},(p,u)=>u+1).reverse(),i=[];for(let p=0;p<S.length;p+=n.shelfGridData.column)i.push(S.slice(p,p+n.shelfGridData.column).reverse());return i.flat()}),f=S=>{const i=parseInt(S.target.dataset.index);a("selectShelfItem",i)};return(S,i)=>{var p,u,g;return x(),$("div",ja,[e("div",null,c((p=n.shelfGridData)==null?void 0:p.shelf_name),1),e("div",Aa,"货架规格："+c((u=n.shelfGridData)==null?void 0:u.layer)+" * "+c((g=n.shelfGridData)==null?void 0:g.column),1),e("div",{style:Ge(K(h)),class:"shelf-grid",onClick:f},[(x(!0),$(Fe,null,Ee(K(d),y=>{var b;return x(),$("div",{key:y,class:Be([{have:(b=n.shelfGridData)==null?void 0:b.products.includes(y),selected:y===t.selectIndex},"product-grid"]),"data-index":y},null,10,Ja)}),128))],4)])}}},Ha=Q(Qa,[["__scopeId","data-v-1268ffd3"]]),Ua=[{id:573,warehouse_id:1688,warehouse_name:"",area_name:"猛牛一号仓存货区",parent_id:0,create_time:"2023-10-07 09:05:15",last_update_time:"2023-10-07 09:05:15",is_valid:!0,tenant_id:2757,area_property:6},{id:574,warehouse_id:1688,warehouse_name:"",area_name:"猛牛一号仓拣货区",parent_id:0,create_time:"2023-10-07 09:05:29",last_update_time:"2023-10-07 09:05:29",is_valid:!0,tenant_id:2757,area_property:1},{id:575,warehouse_id:1688,warehouse_name:"",area_name:"猛牛一号仓备货区",parent_id:0,create_time:"2023-10-07 09:05:44",last_update_time:"2023-10-07 09:05:44",is_valid:!0,tenant_id:2757,area_property:2},{id:576,warehouse_id:1688,warehouse_name:"",area_name:"猛牛一号仓收货区",parent_id:0,create_time:"2023-10-07 09:05:59",last_update_time:"2023-10-07 09:05:59",is_valid:!0,tenant_id:2757,area_property:3}],Ya=[{id:441,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-5-45",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"5",tag_number:"45",create_time:"2023-10-07 09:08:29",last_update_time:"2023-10-07 14:22:15",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:441,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-2-11",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"2",tag_number:"11",create_time:"2023-10-07 09:08:29",last_update_time:"2023-10-07 14:22:15",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:442,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-2-18",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"2",tag_number:"18",create_time:"2023-10-07 09:09:02",last_update_time:"2023-10-07 10:29:25",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:443,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-2-17",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"2",tag_number:"17",create_time:"2023-10-07 09:10:00",last_update_time:"2023-10-07 10:29:01",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:444,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-5-41",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"5",tag_number:"41",create_time:"2023-10-07 09:10:00",last_update_time:"2023-10-07 10:29:01",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:444,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-2-4-2",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"3",shelf_number:"2",layer_number:"4",tag_number:"11",create_time:"2023-10-07 09:10:31",last_update_time:"2023-10-07 14:23:00",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:445,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-3-2-6",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"2",shelf_number:"3",layer_number:"2",tag_number:"6",create_time:"2023-10-07 09:10:54",last_update_time:"2023-10-07 09:11:35",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:446,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-4-3-6",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"1",shelf_number:"4",layer_number:"3",tag_number:"14",create_time:"2023-10-07 09:11:19",last_update_time:"2023-10-07 14:24:29",is_valid:!0,tenant_id:2757,warehouse_area_id:573},{id:447,warehouse_id:1689,warehouse_name:"猛牛二号仓库",warehouse_area_name:"猛牛二号仓存货区",warehouse_area_property:6,location_name:"mn-2-1-5-5",location_length:5,location_width:5,location_heigth:5,location_volume:5,location_load:5,roadway_number:"5",shelf_number:"1",layer_number:"5",tag_number:"15",create_time:"2023-10-07 09:12:26",last_update_time:"2023-10-07 14:24:36",is_valid:!0,tenant_id:2757,warehouse_area_id:577},{id:448,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓拣货区",warehouse_area_property:1,location_name:"mn-1-1-3-10",location_length:0,location_width:0,location_heigth:0,location_volume:0,location_load:0,roadway_number:"5",shelf_number:"1",layer_number:"3",tag_number:"10",create_time:"2023-10-11 14:50:48",last_update_time:"2023-10-11 14:50:59",is_valid:!0,tenant_id:2757,warehouse_area_id:574},{id:449,warehouse_id:1688,warehouse_name:"猛牛一号仓库",warehouse_area_name:"猛牛一号仓存货区",warehouse_area_property:6,location_name:"mn-1-1-3-14",location_length:0,location_width:0,location_heigth:0,location_volume:0,location_load:0,roadway_number:"5",shelf_number:"1",layer_number:"3",tag_number:"14",create_time:"2023-10-11 14:53:24",last_update_time:"2023-10-11 14:53:24",is_valid:!0,tenant_id:2757,warehouse_area_id:573}],Za=[{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-3-10",spu_code:"candy",spu_name:"猛牛奶糖",sku_id:767,sku_code:"candy2",sku_name:"打包奶糖",qty:200,qty_available:200,qty_locked:0,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:448},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-5-6",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:50,qty_available:0,qty_locked:50,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:441},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-2-8",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:100,qty_available:0,qty_locked:100,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:442},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-2-7",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:150,qty_available:0,qty_locked:150,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:443},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-2-4-2",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:200,qty_available:0,qty_locked:200,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:444},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-3-2-6",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:50,qty_available:10,qty_locked:40,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:445},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-4-3-6",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:766,sku_code:"mnmilk1",sku_name:"猛牛小瓶牛奶",qty:50,qty_available:50,qty_locked:0,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:446},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-3-14",spu_code:"mnmilk",spu_name:"猛牛牛奶",sku_id:765,sku_code:"mnmilk2",sku_name:"猛牛大瓶牛奶",qty:300,qty_available:300,qty_locked:0,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:449},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-2-8",spu_code:"ssa",spu_name:"酸奶",sku_id:770,sku_code:"ssa1",sku_name:"小盒酸奶",qty:100,qty_available:100,qty_locked:0,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:442},{warehouse_name:"猛牛一号仓库",location_name:"mn-1-1-2-8",spu_code:"ssa",spu_name:"酸奶",sku_id:769,sku_code:"ssa2",sku_name:"大盒酸奶",qty:600,qty_available:600,qty_locked:0,qty_frozen:0,goods_owner_name:"空",series_number:"",goods_location_id:442}],Ka={id:1688,warehouse_name:"猛牛一号仓库",city:"福州",address:"福州市仓山区",email:"xingminlin@gmail.com",manager:"空",contact_tel:"15359879255",creator:"saals",create_time:"2023-10-07 09:03:20",last_update_time:"2023-10-12 10:35:16",is_valid:!0,tenant_id:2757},Xa={id:"vwms",class:"VWms-container"},et={class:"VWms-header"},at={class:"tooltip"},tt={class:"VWMSIframe"},nt={key:0,class:"right-container"},ot=de({__name:"VWms",setup(t){const a=w(),n=xe(),h=w(!0),d=parseInt(n.query.warehouseId);$e(async()=>{window.addEventListener("message",B)});const f=w(!1),S=()=>{f.value=!f.value},i=w(!0),p=()=>{i.value=!i.value},u=w(!1),g=()=>{if(_e.isEnabled){const s=document.getElementById("vwms");_e.toggle(s),u.value=!u.value}},y=()=>{a.value.contentWindow.parent.postMessage({guid:"",event:"returnToUpper"},"*")},b=s=>{F.push({itemName:"shelfItem",itemId:s}),a.value.contentWindow.parent.postMessage({guid:`shelfItem-${s}`,event:"selectShelfItem"},"*")},B=({data:s})=>{const{event:o,guid:m}=s,v=["loadSuccess","select","selectBreak","loadingProgress"],_={loadSuccess:V,select:me,selectBreak:he,loadingProgress:pe};v.includes(o)&&_[o](m)},V=async()=>{await qe(),Ie(),setTimeout(()=>{h.value=!1,f.value=!0},2500)},F=Me([]),z=w(),me=s=>{const o=s.split("-")[0],m=parseInt(s.split("-")[1]);["factory","shelf","shelfItem"].includes(o)&&F.push({itemName:o,itemId:m})},he=()=>{F.length>1&&(F.length>4?F.splice(2,F.length-2):F.pop())},X=w(),pe=s=>{X.value=Math.ceil(s*100)},fe=w(Ka),H=w(Ua),ee=w(Ya),L=w(Za),U=w([]),Y=w(),ae=w(),te=w(),O=w(),R=w(),ve=()=>(ye(),{...fe.value,factory_number:H.value.length,warehouse_product_number:r.sumBy(L.value,"qty"),type:"warehouse"}),ye=()=>{const s=Z(L.value,"spu_name","qty").slice(0,6),o="库存商品量";O.value={barTitle:o,barGroupsData:s};const m=r.map(U.value,E=>{const P=r.sumBy(E.shelves,G=>r.sumBy(G.shelfItems,W=>r.sumBy(W.product,"qty")));return{name:E.area_name,value:P}}),v=r.map(m,"name"),_=r.map(m,"value"),q="库区容量";R.value={pieTitle:q,xData:v,yData:_}},ge=s=>{const o=r.filter(U.value,{id:s})[0];Y.value=o;const m=o.shelves,v=r.sumBy(m,q=>q.layer*q.column),_=r.flatMap(m,q=>r.flatMap(q.shelfItems,E=>E.product));return be(_,m),{area_name:o.area_name,area_property:o.area_property,shelf_number:m.length,shelf_item_number:v,surplus_number:v-_.length,factory_product_number:r.sumBy(_,"qty"),type:"factory"}},be=(s,o)=>{const m=Z(s,"spu_name","qty").slice(0,6),v="库区库存商品量";O.value={barTitle:v,barGroupsData:m};const _=r.map(o,G=>{const W=r.sumBy(G.shelfItems,Se=>r.sumBy(Se.product,"qty"));return{name:G.shelf_name,value:W}}),q=r.map(_,"name"),E=r.map(_,"value"),P="货架容量";R.value={pieTitle:P,xData:q,yData:E}},ne=w(),we=s=>{var v;const o=(v=Y.value)==null?void 0:v.shelves.filter(_=>_.shelf_name===`${s}`)[0],m=r.flatMap(o.shelfItems,_=>_.product);return ae.value=o.shelf_name,ke(m,o),ne.value={shelf_name:`${o.shelf_name}号货架`,layer:o.layer,column:o.column,products:o.shelfItems.map(_=>_.product.length>0?parseInt(_.tag_number):0)},{shelf_name:`${o.shelf_name}号货架`,layer:o.layer,column:o.column,surplus_number:o.layer*o.column-r.sumBy(o.shelfItems,_=>_.product.length),shelf_product_number:r.sumBy(m,"qty"),type:"shelf"}},ke=(s,o)=>{const m=Z(s,"sku_name","qty"),v="货架商品规格量";O.value={barTitle:v,barGroupsData:m};const _=r.map(o.shelfItems,G=>{const W=r.sumBy(G.product,"qty");return{name:G.location_name,value:W}}),q=r.map(_,"name"),E=r.map(_,"value"),P="库位容量";R.value={pieTitle:P,xData:q,yData:E}},De=s=>{var v;const o=r.filter((v=Y.value)==null?void 0:v.shelves,{shelf_name:ae.value})[0],m=r.filter(o.shelfItems,{tag_number:`${s}`})[0];return te.value=s,m?{...m,type:"shelfItem"}:{tag_number:s,location_name:"无",layer_number:Math.ceil(s/o.column),product:[],type:"shelfItem"}};Pe(F,()=>{const s=F[F.length-1],o={playground:ve,factory:ge,shelf:we,shelfItem:De};console.log(s),z.value=o[s.itemName](s.itemId)});const qe=async()=>{F.push({itemName:"playground",itemId:d});const s=ce(H.value,ee.value,L.value);U.value=s.area},Ie=()=>{const s=ce(H.value,ee.value,L.value);try{a.value.contentWindow.parent.postMessage({guid:JSON.stringify(s),event:"sendData"},"*")}catch(o){console.log(o)}};return(s,o)=>{var q,E;const m=N("v-tooltip"),v=N("v-icon"),_=N("v-btn");return x(),$("div",Xa,[l(C,{name:"fade"},{default:k(()=>[J(l(Re,{progress:X.value},null,8,["progress"]),[[j,h.value]])]),_:1}),e("div",et,[e("div",at,[l(_,{icon:"",variant:"text",onClick:S},{default:k(()=>[l(m,{activator:"parent",location:"bottom"},{default:k(()=>[T(c(f.value?"收起":"展开")+"右栏",1)]),_:1}),l(v,{icon:`mdi-arrow-expand-${f.value?"right":"left"}`},null,8,["icon"])]),_:1}),l(_,{icon:"",variant:"text",onClick:g},{default:k(()=>[l(m,{activator:"parent",location:"bottom"},{default:k(()=>[T("全屏")]),_:1}),l(v,{icon:`mdi-arrow-${u.value?"collapse":"expand"}`},null,8,["icon"])]),_:1}),l(_,{icon:"",variant:"text",onClick:y},{default:k(()=>[l(m,{activator:"parent",location:"bottom"},{default:k(()=>[T("回退")]),_:1}),l(v,{icon:"mdi-reply"})]),_:1}),((q=z.value)==null?void 0:q.type)==="shelf"||((E=z.value)==null?void 0:E.type)==="shelfItem"?(x(),se(_,{key:0,onClick:p},{default:k(()=>[T(c(i.value?"关闭":"打开")+"货架二维视图 ",1)]),_:1})):A("",!0)])]),e("div",tt,[e("iframe",{ref_key:"VWmsIframe",ref:a,height:"100%",src:"/unity/index.html",width:"100%"},null,512)]),e("div",null,[l(C,{name:"slide-fade-grid"},{default:k(()=>{var P,G;return[((P=z.value)==null?void 0:P.type)==="shelf"&&i.value||((G=z.value)==null?void 0:G.type)==="shelfItem"&&i.value?(x(),se(Ha,{key:0,"select-index":te.value,"shelf-grid-data":ne.value,onSelectShelfItem:b},null,8,["select-index","shelf-grid-data"])):A("",!0)]}),_:1})]),l(C,{name:"slide-fade-right"},{default:k(()=>[f.value?(x(),$("div",nt,[l(Ra,{"present-data":z.value},null,8,["present-data"]),l(Ne,{"bar-data":O.value},null,8,["bar-data"]),l(ze,{"pie-data":R.value},null,8,["pie-data"])])):A("",!0)]),_:1})])}}});const pt=Q(ot,[["__scopeId","data-v-148e9438"]]);export{pt as default};
