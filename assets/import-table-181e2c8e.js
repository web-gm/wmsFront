import{i as s,v as I}from"./i18n-0af8b262.js";import{r as M,u as q,e as z}from"./exportTable-b0d17537.js";import{i as L}from"./warehouseSetting-835f9e1c.js";import{a as w}from"./index-cd6d6b34.js";import{S as j,e as A}from"./style-b9bc59b4.js";import{_ as D}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as m}from"./formatSystem-1203ad16.js";import{d as H,b as S,c as J,r as T,w as O,a as r,x as G,v as U,s as n,q as t,u as E,t as W,ap as k,y as V,at as B,ac as Y}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";const K={class:"mb-4"},P=H({__name:"import-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(F,{emit:C}){const R=F,$=S(),u=S(),h=J(()=>R.showDialog),d=T({importData:S([]),validRules:S({})}),i=T({initForm:()=>{d.importData=[]},closeDialog:()=>{C("close")},submit:async()=>{if(!i.valid())return;const g=u.value.getTableData().fullData,{data:o}=await L(g);if(!o.isSuccess){w.$message({type:"error",content:o.errorMessage});return}w.$message({type:"success",content:`${s.global.t("system.page.submit")}${s.global.t("system.tips.success")}`}),C("saveSuccess")},valid:()=>u.value.getTableData().fullData.length<=0?(w.$message({type:"error",content:`${s.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{$.value.value="",$.value.click()},readExcel:async e=>{const a=e.target.files;if(a.length<=0)return!1;const g=a[0],o=new FileReader;o.onload=f=>{var _;const v=(_=f==null?void 0:f.target)==null?void 0:_.result;if(v){const y=M(v,{type:"binary"}),x=y.SheetNames[0];let b=q.sheet_to_json(y.Sheets[x]),l=JSON.stringify(b);l=l.replace(/（/g,"("),l=l.replace(/）/g,")"),b=JSON.parse(l),d.importData=[],b.forEach((N,c,p)=>{d.importData.push({warehouse_name:m(p[c][s.global.t("base.warehouseSetting.warehouse_name")]),city:m(p[c][s.global.t("base.warehouseSetting.city")]),address:m(p[c][s.global.t("base.warehouseSetting.address")]),contact_tel:m(p[c][s.global.t("base.warehouseSetting.contact_tel")]),email:m(p[c][s.global.t("base.warehouseSetting.email")]),manager:m(p[c][s.global.t("base.warehouseSetting.manager")])})})}},o.readAsBinaryString(g)},exportTemplate:()=>{const e=u.value;z({table:e,filename:s.global.t("router.sideBar.warehouseSetting"),mode:"header",columnFilterMethod({column:a}){return!["checkbox","seq"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},deleteRow:e=>{w.$dialog({content:s.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&u.value.remove(e)}})}});return O(()=>h.value,e=>{e&&i.initForm()}),(e,a)=>{const g=r("v-toolbar"),o=r("vxe-column"),f=r("vxe-table"),v=r("v-card-text"),_=r("v-btn"),y=r("v-card-actions"),x=r("v-card"),b=r("v-dialog");return G(),U(b,{modelValue:k(h),"onUpdate:modelValue":a[1]||(a[1]=l=>Y(h)?h.value=l:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:n(()=>[t(x,null,{default:n(()=>[t(g,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),t(v,null,{default:n(()=>[E("div",K,[t(D,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:i.chooseFile},null,8,["tooltip-text","onClick"]),t(D,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:i.exportTemplate},null,8,["tooltip-text","onClick"]),W(E("input",{id:"open",ref_key:"uploadExcel",ref:$,type:"file",accept:".xls, .xlsx",onChange:a[0]||(a[0]=(...l)=>i.readExcel&&i.readExcel(...l))},null,544),[[I,!1]])]),t(f,{ref_key:"xTable",ref:u,"column-config":{minWidth:"100px"},data:d.importData,height:k(j).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":d.validRules,"export-config":{},align:"center"},{default:n(()=>[t(o,{type:"seq",width:"60"}),t(o,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:n(({row:l})=>[t(D,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":k(A),onClick:N=>i.deleteRow(l)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),t(o,{field:"warehouse_name",title:e.$t("base.warehouseSetting.warehouse_name")},null,8,["title"]),t(o,{field:"city",title:e.$t("base.warehouseSetting.city")},null,8,["title"]),t(o,{field:"address",title:e.$t("base.warehouseSetting.address")},null,8,["title"]),t(o,{field:"contact_tel",title:e.$t("base.warehouseSetting.contact_tel")},null,8,["title"]),t(o,{field:"email",title:e.$t("base.warehouseSetting.email")},null,8,["title"]),t(o,{field:"manager",title:e.$t("base.warehouseSetting.manager")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),t(y,{class:"justify-end"},{default:n(()=>[t(_,{variant:"text",onClick:i.closeDialog},{default:n(()=>[V(B(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(_,{color:"primary",variant:"text",onClick:i.submit},{default:n(()=>[V(B(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const ue=Z(P,[["__scopeId","data-v-45806387"]]);export{ue as default};
