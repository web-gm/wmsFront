import{i as n,w as C}from"./i18n-0af8b262.js";import{a as D,b as x}from"./style-b9bc59b4.js";import{D as L,a as P,c as T,P as U,b as M}from"./system-93ae242b.js";import{a as l}from"./index-cd6d6b34.js";import{g as R,s as F}from"./common-938b41ea.js";import{j as O,k as E,m as z,n as B,g as V}from"./stockAsn-18b92b84.js";import q from"./sku-info-138df2f3.js";import{B as N}from"./btnGroup-26ff2079.js";import{_ as j}from"./confirm-unload.vue_vue_type_script_setup_true_lang-2b8cbf5e.js";import{h as y}from"./httpCodeJudge-e416f8ca.js";import{d as G,b as m,r as b,o as H,c as w,w as J,a as f,x as K,m as Z,u as k,q as s,s as c,y as W,at as v,ap as p,aq as Y,as as Q,O as X}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./index-ae8f073f.js";import"./vue-router-1283ad2d.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import"./formatSystem-1203ad16.js";import"./userManagement-c79709d8.js";const te={class:"operateArea"},se=["onClick"],oe=G({__name:"tabToDoUnload",setup(ae,{expose:S}){const g=m(),h=m(),t=b({showDialog:!1,showDialogShowInfo:!1,searchForm:{supplier_name:"",sku_name:""},activeTab:null,tableData:m([]),dialogForm:m({id:0,asn_no:"",asn_batch:"",estimated_arrival_time:"",detailList:[]}),tablePage:b({total:0,sqlTitle:"asn_status:1",pageIndex:1,pageSize:L,searchObjects:m([])}),timer:m(null),btnList:[],authorityList:R()}),a=b({handleRevoke:()=>{const e=g.value.getCheckboxRecords();if(e.length>0){const o=e.map(r=>r.id);l.$dialog({content:n.global.t("system.tips.beforeOperation"),handleConfirm:async()=>{const{data:r}=await O(o);if(!r.isSuccess){if(y(r.errorMessage)){a.refresh();return}l.$message({type:"error",content:r.errorMessage});return}l.$message({type:"success",content:`${n.global.t("system.page.revoke")}${n.global.t("system.tips.success")}`}),a.refresh()}})}else l.$message({type:"error",content:n.global.t("wms.stockAsnInfo.selectOne")})},handleConfirm:()=>{g.value.getCheckboxRecords().length>0?h.value.openDialog():l.$message({type:"error",content:n.global.t("wms.stockAsnInfo.selectOne")})},sureBackUnloadConfirm:async e=>{const r=g.value.getCheckboxRecords().map(_=>({id:_.id,...e})),{data:d}=await E(r);if(!d.isSuccess){if(y(d.errorMessage)){a.refresh(),h.value.closeDialog();return}l.$message({type:"error",content:d.errorMessage});return}l.$message({type:"success",content:`${n.global.t("system.page.confirm")}${n.global.t("system.tips.success")}`}),h.value.closeDialog(),a.refresh()},closeDialogShowInfo:()=>{t.showDialogShowInfo=!1},showSkuInfo(e){t.dialogForm=JSON.parse(JSON.stringify(e)),t.showDialogShowInfo=!0},editRow(e){l.$dialog({content:n.global.t("system.tips.beforeAsnUnload"),handleConfirm:async()=>{if(e.id){const{data:o}=await z(e.id);if(!o.isSuccess){l.$message({type:"error",content:o.errorMessage});return}l.$message({type:"success",content:`${n.global.t("system.page.confirm")}${n.global.t("system.tips.success")}`}),a.refresh()}}})},deleteRow(e){l.$dialog({content:n.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:o}=await B(e.id);if(!o.isSuccess){l.$message({type:"error",content:o.errorMessage});return}l.$message({type:"success",content:`${n.global.t("system.page.delete")}${n.global.t("system.tips.success")}`}),a.refresh()}}})},refresh:()=>{a.getStockAsnList()},getStockAsnList:async()=>{const{data:e}=await V(t.tablePage);if(!e.isSuccess){l.$message({type:"error",content:e.errorMessage});return}t.tableData=e.data.rows,t.tablePage.total=e.data.totals},handlePageChange:m(({currentPage:e,pageSize:o})=>{t.tablePage.pageIndex=e,t.tablePage.pageSize=o,a.getStockAsnList()}),exportTable:()=>{const e=g.value;e.exportData({table:e,filename:n.global.t("wms.stockAsn.tabToDoUnload"),columnFilterMethod({column:o}){return!["checkbox"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},sureSearch:()=>{t.tablePage.searchObjects=F(t.searchForm),a.getStockAsnList()}});H(()=>{t.btnList=[{name:n.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:a.refresh},{name:n.global.t("system.page.export"),icon:"mdi-export-variant",code:"unloaded-export",click:a.exportTable},{name:n.global.t("wms.stockAsnInfo.confirmUnload"),icon:"mdi-check",code:"unloaded-confirm",click:a.handleConfirm},{name:n.global.t("wms.stockAsnInfo.revoke"),icon:"mdi-arrow-left-top",code:"unloaded-delete",click:a.handleRevoke}]});const $=w(()=>D({})),A=w(()=>x({}));return S({getStockAsnList:a.getStockAsnList}),J(()=>t.searchForm,()=>{t.timer&&clearTimeout(t.timer),t.timer=setTimeout(()=>{t.timer=null,a.sureSearch()},P)},{deep:!0}),(e,o)=>{const r=f("v-col"),d=f("v-text-field"),_=f("v-row"),i=f("vxe-column"),I=f("vxe-table");return K(),Z(X,null,[k("div",te,[s(_,{"no-gutters":""},{default:c(()=>[s(r,{cols:"3",class:"col"},{default:c(()=>[s(N,{"authority-list":t.authorityList,"btn-list":t.btnList},null,8,["authority-list","btn-list"])]),_:1}),s(r,{cols:"9"},{default:c(()=>[s(_,{"no-gutters":"",onKeyup:C(a.sureSearch,["enter"])},{default:c(()=>[s(r,{cols:"4"}),s(r,{cols:"4"},{default:c(()=>[s(d,{modelValue:t.searchForm.supplier_name,"onUpdate:modelValue":o[0]||(o[0]=u=>t.searchForm.supplier_name=u),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.supplier_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),s(r,{cols:"4"},{default:c(()=>[s(d,{modelValue:t.searchForm.sku_name,"onUpdate:modelValue":o[1]||(o[1]=u=>t.searchForm.sku_name=u),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.sku_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),k("div",{class:"mt-5",style:Q({height:p($)})},[s(I,{ref_key:"xTableStockLocation",ref:g,"column-config":{minWidth:"100px"},data:t.tableData,height:p(A),align:"center"},{empty:c(()=>[W(v(p(n).global.t("system.page.noData")),1)]),default:c(()=>[s(i,{type:"seq",width:"60"}),s(i,{type:"checkbox",width:"50"}),s(i,{field:"asn_no",title:e.$t("wms.stockAsnInfo.asn_no")},null,8,["title"]),s(i,{field:"spu_code",title:e.$t("wms.stockAsnInfo.spu_code")},null,8,["title"]),s(i,{field:"spu_name",title:e.$t("wms.stockAsnInfo.spu_name")},null,8,["title"]),s(i,{field:"sku_code",title:e.$t("wms.stockAsnInfo.sku_code")},{default:c(({row:u})=>[k("div",{class:Y("text-decoration-none"),onClick:ne=>a.showSkuInfo(u)},v(u.sku_code),9,se)]),_:1},8,["title"]),s(i,{field:"sku_name",title:e.$t("wms.stockAsnInfo.sku_name")},null,8,["title"]),s(i,{field:"goods_owner_name",title:e.$t("wms.stockAsnInfo.goods_owner_name")},null,8,["title"]),s(i,{field:"supplier_name",title:e.$t("wms.stockAsnInfo.supplier_name")},null,8,["title"]),s(i,{field:"asn_qty",title:e.$t("wms.stockAsnInfo.asn_qty")},null,8,["title"]),s(i,{field:"weight",title:e.$t("wms.stockAsnInfo.weight")},null,8,["title"]),s(i,{field:"volume",title:e.$t("wms.stockAsnInfo.volume")},null,8,["title"])]),_:1},8,["data","height"]),s(T,{"current-page":t.tablePage.pageIndex,"page-size":t.tablePage.pageSize,perfect:"",total:t.tablePage.total,"page-sizes":p(U),layouts:p(M),onPageChange:a.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4),s(q,{"show-dialog":t.showDialogShowInfo,form:t.dialogForm,onClose:a.closeDialogShowInfo},null,8,["show-dialog","form","onClose"]),s(j,{ref_key:"ConfirmUnloadModalRef",ref:h,onSure:a.sureBackUnloadConfirm},null,8,["onSure"])],64)}}});const Ie=ee(oe,[["__scopeId","data-v-80ce80dd"]]);export{Ie as default};
