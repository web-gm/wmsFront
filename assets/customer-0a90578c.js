import{i as r,w as k}from"./i18n-0af8b262.js";import{a as P,b as F,e as T}from"./style-b9bc59b4.js";import{D as L,a as M,c as E,P as O,b as z}from"./system-93ae242b.js";import{_}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import H from"./add-or-update-customer-c9d7df58.js";import{a as d}from"./index-cd6d6b34.js";import{g as A,s as B}from"./common-938b41ea.js";import{d as N,g as R}from"./customer-7e6fccb3.js";import V from"./import-customer-table-29106843.js";import{e as U}from"./exportTable-b0d17537.js";import{B as G}from"./btnGroup-26ff2079.js";import{h as j}from"./hiprintFast-e8811561.js";import{d as K,b as p,r as y,o as q,c as v,w as J,a as n,x as Z,m as W,u as g,q as a,s as i,as as Y,ap as c,y as Q,at as X,O as ee}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./printSolution-f5a888b7.js";import"./index-ae8f073f.js";const ae={class:"container"},oe={class:"operateArea"},se=K({__name:"customer",setup(le){const f=p(),h=p(),e=y({searchForm:{customer_name:""},tableData:[],showDialog:!1,showDialogImport:!1,dialogForm:{id:0,customer_name:"",city:"",address:"",manager:"",email:"",contact_tel:"",is_valid:!0},tablePage:{total:0,pageIndex:1,pageSize:L,searchObjects:p([])},printForm:{},timer:p(null),btnList:[],authorityList:A()}),o=y({openDialogImport:()=>{e.showDialogImport=!0},closeDialogImport:()=>{e.showDialogImport=!1},saveSuccessImport:()=>{o.refresh(),o.closeDialog()},sureSearch:()=>{e.tablePage.searchObjects=B(e.searchForm),o.getData()},add:()=>{e.dialogForm={id:0,customer_name:"",city:"",address:"",manager:"",email:"",contact_tel:"",is_valid:!0},e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{o.refresh(),o.closeDialog()},refresh:()=>{o.getData()},editRow(t){e.dialogForm=JSON.parse(JSON.stringify(t)),e.showDialog=!0},deleteRow(t){d.$dialog({content:r.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.id){const{data:s}=await N(t.id);if(!s.isSuccess){d.$message({type:"error",content:s.errorMessage});return}d.$message({type:"success",content:`${r.global.t("system.page.delete")}${r.global.t("system.tips.success")}`}),o.refresh()}}})},handlePageChange:p(({currentPage:t,pageSize:s})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=s,o.getData()}),exportTable:()=>{const t=f.value;U({table:t,filename:r.global.t("router.sideBar.customer"),columnFilterMethod({column:s}){return!["checkbox"].includes(s==null?void 0:s.type)&&!["operate"].includes(s==null?void 0:s.field)}})},getData:async()=>{const{data:t}=await R(e.tablePage);if(!t.isSuccess){d.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},print:()=>{const t=f.value.getCheckboxRecords();t.length>0?(e.printForm={detailList:t},h.value.method.handleOpen()):d.$message({type:"error",content:r.global.t("base.userManagement.checkboxIsNull")})}});q(()=>{e.btnList=[{name:r.global.t("system.page.add"),icon:"mdi-plus",code:"save",click:o.add},{name:r.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:r.global.t("system.page.import"),icon:"mdi-database-import-outline",code:"import",click:o.openDialogImport},{name:r.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:o.exportTable},{name:r.global.t("system.page.print"),icon:"mdi-printer",code:"",click:o.print}],o.getData()});const D=v(()=>P({hasTab:!1})),w=v(()=>F({hasTab:!1}));return J(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,o.sureSearch()},M)},{deep:!0}),(t,s)=>{const m=n("v-col"),S=n("v-text-field"),b=n("v-row"),l=n("vxe-column"),x=n("vxe-table"),C=n("v-card-text"),$=n("v-card");return Z(),W(ee,null,[g("div",ae,[g("div",null,[a($,{class:"mt-5"},{default:i(()=>[a(C,null,{default:i(()=>[g("div",oe,[a(b,{"no-gutters":""},{default:i(()=>[a(m,{cols:"12",sm:"4",class:"col"},{default:i(()=>[a(G,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(m,{cols:"12",sm:"8"},{default:i(()=>[a(b,{"no-gutters":"",onKeyup:k(o.sureSearch,["enter"])},{default:i(()=>[a(m,{cols:"12",sm:"4"}),a(m,{cols:"12",sm:"4"}),a(m,{cols:"12",sm:"4"},{default:i(()=>[a(S,{modelValue:e.searchForm.customer_name,"onUpdate:modelValue":s[0]||(s[0]=u=>e.searchForm.customer_name=u),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("base.customer.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),g("div",{class:"mt-5",style:Y({height:c(D)})},[a(x,{ref_key:"xTable",ref:f,data:e.tableData,"column-config":{minWidth:"100px"},height:c(w),align:"center"},{empty:i(()=>[Q(X(c(r).global.t("system.page.noData")),1)]),default:i(()=>[a(l,{type:"seq",width:"60"}),a(l,{type:"checkbox",width:"50"}),a(l,{field:"customer_name",title:t.$t("base.customer.customer_name")},null,8,["title"]),a(l,{field:"city",title:t.$t("base.customer.city")},null,8,["title"]),a(l,{field:"address",title:t.$t("base.customer.address")},null,8,["title"]),a(l,{field:"manager",title:t.$t("base.customer.manager")},null,8,["title"]),a(l,{field:"email",title:t.$t("base.customer.email")},null,8,["title"]),a(l,{field:"contact_tel",title:t.$t("base.customer.contact_tel")},null,8,["title"]),a(l,{field:"creator",title:t.$t("base.customer.creator")},null,8,["title"]),a(l,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:t.$t("base.customer.create_time")},null,8,["title"]),a(l,{field:"last_update_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:t.$t("base.customer.last_update_time")},null,8,["title"]),a(l,{field:"operate",title:t.$t("system.page.operate"),width:"160",resizable:!1,"show-overflow":""},{default:i(({row:u})=>[a(_,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":t.$t("system.page.edit"),disabled:!e.authorityList.includes("save"),onClick:I=>o.editRow(u)},null,8,["tooltip-text","disabled","onClick"]),a(_,{flat:!0,icon:"mdi-delete-outline","tooltip-text":t.$t("system.page.delete"),"icon-color":e.authorityList.includes("delete")?c(T):"",disabled:!e.authorityList.includes("delete"),onClick:I=>o.deleteRow(u)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),a(E,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":c(O),layouts:c(z),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1})])]),a(H,{"show-dialog":e.showDialog,form:e.dialogForm,onClose:o.closeDialog,onSaveSuccess:o.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),a(V,{"show-dialog":e.showDialogImport,onClose:o.closeDialogImport,onSaveSuccess:o.saveSuccessImport},null,8,["show-dialog","onClose","onSaveSuccess"]),a(j,{ref_key:"hprintDialogRef",ref:h,form:e.printForm,"tab-page":"print_page_main"},null,8,["form"])],64)}}});const $e=te(se,[["__scopeId","data-v-dafbf713"]]);export{$e as default};
