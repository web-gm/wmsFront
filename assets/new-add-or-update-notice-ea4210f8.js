import{i}from"./i18n-0af8b262.js";import{e as B}from"./style-b9bc59b4.js";import{a as c}from"./index-cd6d6b34.js";import{d as R,e as F}from"./stockAsn-18b92b84.js";import{_ as M}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{s as Z}from"./sku-select-e1d3e93a.js";import{I as h,S as $}from"./formRule-3feb276f.js";import{g as j}from"./supplier-8eff24fc.js";import{b as z}from"./ownerOfCargo-a67b46ea.js";import{c as E,_ as C}from"./custom-filter-select.vue_vue_type_script_setup_true_lang-d6331575.js";import{b as G}from"./formatSystem-1203ad16.js";import{r as H}from"./common-938b41ea.js";import{d as J,b as g,c as K,r as I,w as P,a as u,x as w,v as x,s,q as l,m as Q,b0 as W,O as X,y,at as D,ap as L,ac as Y,u as ee}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./stockManagement-a6372198.js";import"./system-93ae242b.js";import"./index-ae8f073f.js";const te={class:"detailBtnContainer"},le=J({__name:"new-add-or-update-notice",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(A,{emit:k}){const S=A,V=g(),_=K(()=>S.showDialog),o=I({curSelectType:"",showSkuDialogSelect:!1,dialogTitle:"",form:g({id:0,asn_no:"",asn_batch:"",estimated_arrival_time:"",detailList:[]}),removeDetailList:g([]),combobox:g({supplier_name:[],goods_owner_name:[]}),rules:{goods_owner_name:[],estimated_arrival_time:[],supplier_name:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("wms.stockAsnInfo.supplier_name")}!`],spu_code:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("wms.deliveryManagement.sku_code")}!`],asn_qty:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("wms.stockAsnInfo.asn_qty")}!`,e=>h(e,"greaterThanZero")===""||h(e,"greaterThanZero")],asn_batch:[e=>$(e,0,64)===""||$(e,0,64)]}}),d=I({supplierNameChange:e=>{e.supplier_name?e.supplier_id=o.combobox.supplier_name.filter(t=>t.label===e.supplier_name)[0].value:e.supplier_id=0},goodsOwnerNameChange:e=>{e?o.form.goods_owner_id=o.combobox.goods_owner_name.filter(t=>t.label===e)[0].value:(o.form.goods_owner_id=0,o.form.goods_owner_name="")},openSelect:e=>{o.curSelectType=e,e==="target"&&(o.showSkuDialogSelect=!0)},sureSelect:e=>{if(o.curSelectType==="target"){let t=null;for(const a of o.form.detailList.reverse())if(a.supplier_id&&a.supplier_id>0){t=a;break}for(const a of e){const n={spu_id:a.spu_id,spu_code:a.spu_code,spu_name:a.spu_name,sku_id:a.sku_id,sku_code:a.sku_code,sku_name:a.sku_name,origin:a.origin,asn_qty:0};t&&(n.supplier_id=t.supplier_id,n.supplier_name=t.supplier_name),o.form.detailList.push(n)}}},closeDialogSelect:e=>{e==="target"&&(o.showSkuDialogSelect=!1)},getCombobox:async()=>{o.combobox.supplier_name=[],o.combobox.goods_owner_name=[];const{data:e}=await j();if(!e.isSuccess)return;for(const a of e.data)a.is_valid&&o.combobox.supplier_name.push({label:a.supplier_name,value:a.id});const{data:t}=await z();if(!!t.isSuccess)for(const a of t.data)a.is_valid&&o.combobox.goods_owner_name.push({label:a.goods_owner_name,value:a.id})},closeDialog:()=>{k("close")},beforeSubmit:()=>{let e=!0;return o.form.detailList.length===0?(c.$message({type:"error",content:i.global.t("system.tips.detailLengthIsZero")}),e=!1):E(o.form.detailList,["sku_id","supplier_id"])&&(c.$message({type:"error",content:i.global.t("system.tips.detailHasItemRepeat")}),e=!1),e},submit:async()=>{if(!d.beforeSubmit())return;const{valid:t}=await V.value.validate();if(t){const a=H(o.form),{data:n}=a.id&&a.id>0?await R({...a,detailList:[...a.detailList,...o.removeDetailList]}):await F(a);if(!n.isSuccess){c.$message({type:"error",content:n.errorMessage});return}c.$message({type:"success",content:`${i.global.t("system.page.submit")}${i.global.t("system.tips.success")}`}),k("saveSuccess")}else c.$message({type:"error",content:i.global.t("system.checkText.checkFormFail")})},removeItem:(e,t)=>{c.$dialog({content:i.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{t.id&&t.id>0&&(t.id=-t.id,o.removeDetailList.push(t)),o.form.detailList.splice(e,1)}})}});return P(()=>_.value,e=>{e&&(d.getCombobox(),o.form=S.form,o.form.estimated_arrival_time&&(o.form.estimated_arrival_time=G(o.form.estimated_arrival_time,"yyyy-MM-dd")))}),(e,t)=>{const a=u("v-toolbar"),n=u("v-col"),p=u("v-text-field"),b=u("v-row"),v=u("v-btn"),U=u("v-form"),N=u("v-card-text"),T=u("v-card-actions"),q=u("v-card"),O=u("v-dialog");return w(),x(O,{modelValue:L(_),"onUpdate:modelValue":t[5]||(t[5]=r=>Y(_)?_.value=r:null),width:"80%",transition:"dialog-top-transition",persistent:!0},{default:s(()=>[l(q,{class:"formCard"},{default:s(()=>[l(a,{color:"white",title:`${e.$t("wms.stockAsn.tabNotice")}`},null,8,["title"]),l(N,null,{default:s(()=>[l(U,{ref_key:"formRef",ref:V},{default:s(()=>[l(b,null,{default:s(()=>[l(n,{cols:4},{default:s(()=>[l(C,{modelValue:o.form,"onUpdate:modelValue":t[0]||(t[0]=r=>o.form=r),items:o.combobox.goods_owner_name,"item-title":"label",rules:o.rules.goods_owner_name,label:e.$t("wms.stockAsnInfo.goods_owner_name"),mapping:[{in:"goods_owner_id",out:"value"},{in:"goods_owner_name",out:"label"}]},null,8,["modelValue","items","rules","label"])]),_:1}),l(n,{cols:4},{default:s(()=>[l(p,{modelValue:o.form.asn_batch,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.asn_batch=r),label:e.$t("wms.stockAsnInfo.asn_batch"),rules:o.rules.asn_batch,variant:"outlined"},null,8,["modelValue","label","rules"])]),_:1}),l(n,{cols:4},{default:s(()=>[l(p,{modelValue:o.form.estimated_arrival_time,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.estimated_arrival_time=r),type:"date",variant:"outlined",label:e.$t("wms.stockAsnInfo.estimated_arrival_time")},null,8,["modelValue","label"])]),_:1})]),_:1}),(w(!0),Q(X,null,W(o.form.detailList,(r,f)=>(w(),x(b,{key:f,style:{"margin-top":"5px"}},{default:s(()=>[l(n,{cols:11},{default:s(()=>[l(b,null,{default:s(()=>[l(n,{cols:3},{default:s(()=>[l(p,{modelValue:r.spu_name,"onUpdate:modelValue":m=>r.spu_name=m,label:e.$t("wms.stockAsnInfo.spu_name"),variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),l(n,{cols:2},{default:s(()=>[l(p,{modelValue:r.spu_code,"onUpdate:modelValue":m=>r.spu_code=m,label:e.$t("wms.stockAsnInfo.spu_code"),rules:o.rules.spu_code,variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),l(n,{cols:2},{default:s(()=>[l(p,{modelValue:r.sku_code,"onUpdate:modelValue":m=>r.sku_code=m,label:e.$t("wms.stockAsnInfo.sku_code"),variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),l(n,{cols:3},{default:s(()=>[l(C,{modelValue:o.form.detailList[f],"onUpdate:modelValue":m=>o.form.detailList[f]=m,items:o.combobox.supplier_name,"item-title":"label",rules:o.rules.supplier_name,label:e.$t("wms.stockAsnInfo.supplier_name"),mapping:[{in:"supplier_name",out:"label"},{in:"supplier_id",out:"value"}]},null,8,["modelValue","onUpdate:modelValue","items","rules","label"])]),_:2},1024),l(n,{cols:2},{default:s(()=>[l(p,{modelValue:r.asn_qty,"onUpdate:modelValue":m=>r.asn_qty=m,rules:o.rules.asn_qty,label:e.$t("wms.stockAsnInfo.asn_qty"),variant:"outlined",clearable:""},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024)]),_:2},1024)]),_:2},1024),l(n,{cols:1},{default:s(()=>[ee("div",te,[l(M,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":L(B),onClick:m=>d.removeItem(f,r)},null,8,["tooltip-text","icon-color","onClick"])])]),_:2},1024)]),_:2},1024))),128)),l(v,{style:{"font-size":"20px","margin-bottom":"15px","margin-top":"10px",float:"right"},color:"primary",width:40,onClick:t[3]||(t[3]=r=>d.openSelect("target"))},{default:s(()=>[y(" + ")]),_:1})]),_:1},512)]),_:1}),l(T,{class:"justify-end"},{default:s(()=>[l(v,{variant:"text",onClick:d.closeDialog},{default:s(()=>[y(D(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),l(v,{color:"primary",variant:"text",onClick:d.submit},{default:s(()=>[y(D(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),l(Z,{"show-dialog":o.showSkuDialogSelect,onClose:t[4]||(t[4]=r=>d.closeDialogSelect("target")),onSureSelect:d.sureSelect},null,8,["show-dialog","onSureSelect"])]),_:1},8,["modelValue"])}}});const $e=oe(le,[["__scopeId","data-v-3da067f2"]]);export{$e as default};
