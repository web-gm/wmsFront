import{i as c}from"./i18n-0af8b262.js";import{a as m}from"./index-cd6d6b34.js";import{S as N}from"./style-b9bc59b4.js";import{b as T}from"./stockAsn-18b92b84.js";import{a as E}from"./tableRule-6aa0c57f.js";import{_ as V}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{l as L}from"./location-select-a2f98b65.js";import{d as M,b as G,r as f,a as n,x as R,m as B,q as t,s as l,ap as v,y as _,at as p,O as F}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./warehouseSetting-835f9e1c.js";import"./system-93ae242b.js";import"./formatSystem-1203ad16.js";import"./index-ae8f073f.js";import"./formatWarehouse-aebb7b18.js";import"./Warehouse-56a6b193.js";import"./common-938b41ea.js";const H=M({__name:"confirm-grouding",emits:["sure"],setup(O,{expose:y,emit:w}){const d=G(),h=({cellValue:e,row:o})=>{if(!Number.isNaN(e)&&!Number.isNaN(o.sorted_qty)&&e>o.sorted_qty)return new Error(c.global.t("wms.stockAsnInfo.exceedTip"))},b=({cellValue:e,row:o})=>{if(o.putaway_qty&&!e)return new Error(c.global.t("wms.stockAsnInfo.notLocation"))},a=f({showDialog:!1,showSkuDialogSelect:!1,tableData:[],validRules:{putaway_qty:[{required:!0,message:`${c.global.t("system.checkText.mustInput")}${c.global.t("wms.stockAsnInfo.putaway_qty")}`},{validator:E,validNumerical:"nonNegative",trigger:"change"},{validator:h,trigger:"change"}],series_number:[],location_name:[{validator:b,trigger:"change"}]}}),i=f({activeMethod:({column:e})=>e.field!=="location_name",handleSelectLocation:()=>{d.value.getCheckboxRecords().length>0?a.showSkuDialogSelect=!0:m.$message({type:"error",content:c.global.t("wms.stockAsnInfo.selectOne")})},closeDialogSelect:()=>{a.showSkuDialogSelect=!1},sureSelect:e=>{if(e.length>0){const o=d.value.getCheckboxRecords();for(const s of o)s.goods_location_id=e[0].id,s.location_name=e[0].location_name}},initDialogData:async e=>{const{data:o}=await T(e);if(!o.isSuccess){m.$message({type:"error",content:o.errorMessage}),a.showDialog=!1;return}a.tableData=o.data.map(s=>({...s,putaway_qty:s.sorted_qty}))},openDialog:async e=>{i.initDialogData(e),a.showDialog=!0},closeDialog:()=>{a.showDialog=!1},submit:async()=>{await d.value.validate(!0)?m.$message({type:"error",content:c.global.t("system.checkText.checkFormFail")}):w("sure",a.tableData)}});return y({openDialog:i.openDialog,closeDialog:i.closeDialog}),(e,o)=>{const s=n("v-toolbar"),k=n("v-col"),D=n("v-row"),r=n("vxe-column"),S=n("vxe-input"),x=n("vxe-table"),$=n("v-card-text"),g=n("v-btn"),q=n("v-card-actions"),C=n("v-card"),I=n("v-dialog");return R(),B(F,null,[t(I,{modelValue:a.showDialog,"onUpdate:modelValue":o[1]||(o[1]=u=>a.showDialog=u),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:l(()=>[t(C,null,{default:l(()=>[t(s,{color:"white",title:`${e.$t("wms.stockAsnInfo.editGrounding")}`},null,8,["title"]),t($,null,{default:l(()=>[t(D,{"no-gutters":""},{default:l(()=>[t(k,{cols:"12",class:"col"},{default:l(()=>[t(V,{icon:"mdi-warehouse","tooltip-text":e.$t("wms.stockAsnInfo.selectLocation"),onClick:o[0]||(o[0]=u=>i.handleSelectLocation())},null,8,["tooltip-text"])]),_:1})]),_:1}),t(x,{ref_key:"xTable",ref:d,"keep-source":"","column-config":{minWidth:"100px"},data:a.tableData,height:v(N).SELECT_TABLE,align:"center","edit-rules":a.validRules,"edit-config":{trigger:"click",mode:"cell",activeMethod:i.activeMethod},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isEnter:!0,isTab:!0,isEdit:!0,isChecked:!0}},{empty:l(()=>[_(p(v(c).global.t("system.page.noData")),1)]),default:l(()=>[t(r,{type:"seq",width:"60"}),t(r,{type:"checkbox",width:"50"}),t(r,{field:"goods_owner_name",title:e.$t("wms.stockAsnInfo.goods_owner_name")},null,8,["title"]),t(r,{field:"series_number",title:e.$t("wms.stockAsnInfo.series_number")},null,8,["title"]),t(r,{field:"location_name",title:e.$t("base.warehouseSetting.location_name"),"edit-render":{autofocus:".vxe-input--inner"}},null,8,["title","edit-render"]),t(r,{field:"sorted_qty",title:e.$t("wms.stockAsnInfo.can_putaway_qty")},null,8,["title"]),t(r,{field:"putaway_qty",title:e.$t("wms.stockAsnInfo.putaway_qty"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:l(({row:u})=>[t(S,{modelValue:u.putaway_qty,"onUpdate:modelValue":A=>u.putaway_qty=A,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"])]),_:1},8,["data","height","edit-rules","edit-config"])]),_:1}),t(q,{class:"justify-end"},{default:l(()=>[t(g,{variant:"text",onClick:i.closeDialog},{default:l(()=>[_(p(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(g,{color:"primary",variant:"text",onClick:i.submit},{default:l(()=>[_(p(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{"show-dialog":a.showSkuDialogSelect,onClose:o[2]||(o[2]=u=>i.closeDialogSelect()),onSureSelect:i.sureSelect},null,8,["show-dialog","onSureSelect"])],64)}}});const ue=U(H,[["__scopeId","data-v-c907a4db"]]);export{ue as default};
