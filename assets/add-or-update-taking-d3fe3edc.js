import{a as g}from"./index-cd6d6b34.js";import{a as M}from"./warehouseTaking-2c283aca.js";import{r as W}from"./common-938b41ea.js";import{T as N}from"./warehouseWorking-497fd91f.js";import{i as n}from"./i18n-0af8b262.js";import{c as j}from"./commodity-select-5da8c47a.js";import{_ as y}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{l as O}from"./location-select-a2f98b65.js";import{s as z}from"./sku-select-e1d3e93a.js";import{c as J}from"./custom-qrcode-7ab7b0a5.js";import{d as A,b as h,c as u,r as v,w as E,a as i,x as G,m as H,q as t,s as m,ap as d,u as k,aR as K,y as C,at as $,ac as P,O as Q}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";import"./stockManagement-a6372198.js";import"./system-93ae242b.js";import"./style-b9bc59b4.js";import"./warehouseSetting-835f9e1c.js";import"./formatSystem-1203ad16.js";import"./formatWarehouse-aebb7b18.js";import"./Warehouse-56a6b193.js";const Y={class:"header"},Z={class:"headerBtn"},R={class:"headerTips"},oo=A({__name:"add-or-update-taking",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(D,{emit:b}){const c=D,w=h(),V=u(()=>c.form.id&&c.form.id>0),T=u(()=>!!V.value),S=u(()=>o.curStockID>0),x=u(()=>JSON.stringify({id:o.form.id.toString(),type:"warehouseTaking"})),_=u(()=>c.showDialog),o=v({showCommodityDialogSelect:!1,showLocationDialogSelect:!1,showSkuDialogSelect:!1,curStockID:0,form:h({id:0,job_code:"",job_status:N,sku_id:0,goods_owner_id:0,goods_location_id:0,book_qty:0,counted_qty:0,difference_qty:0,spu_code:"",spu_name:"",sku_code:"",series_number:"",warehouse_name:"",location_name:"",handler:"",handle_time:"",adjust_status:!1,creator:"",create_time:""}),rules:{job_type:[],book_qty:[],warehouse_name:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("wms.warehouseWorking.warehouseTaking.warehouse")}!`],location_name:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("wms.warehouseWorking.warehouseTaking.location_name")}!`],spu_code:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("base.commodityManagement.spu_code")}!`],spu_name:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("base.commodityManagement.spu_name")}!`],sku_code:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("base.commodityManagement.sku_code")}!`],sku_name:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("base.commodityManagement.sku_name")}!`]}}),s=v({closeDialog:()=>{b("close")},initForm:()=>{o.form=c.form},openCommoditySelect:()=>{o.showCommodityDialogSelect=!0},closeCommodityDialogSelect:()=>{o.showCommodityDialogSelect=!1},sureSelectCommodity:e=>{try{o.curStockID=e[0].id,o.form.sku_id=e[0].sku_id,o.form.goods_owner_id=e[0].goods_owner_id,o.form.goods_location_id=e[0].goods_location_id,o.form.warehouse_name=e[0].warehouse_name,o.form.location_name=e[0].location_name,o.form.spu_code=e[0].spu_code,o.form.spu_name=e[0].spu_name,o.form.sku_code=e[0].sku_code,o.form.series_number=e[0].series_number,o.form.book_qty=e[0].qty_available}catch{}},clearCommodity:()=>{o.curStockID=0,o.form.sku_id=0,o.form.goods_location_id=0,o.form.warehouse_name="",o.form.location_name="",o.form.spu_code="",o.form.spu_name="",o.form.sku_code="",o.form.book_qty=0},openSkuSelect:()=>{o.showSkuDialogSelect=!0},closeDialogSelectSku:()=>{o.showSkuDialogSelect=!1},sureSelectSku:e=>{e.length>0&&(o.form.sku_id=e[0].sku_id,o.form.goods_owner_id=e[0].goods_owner_id,o.form.goods_location_id=e[0].goods_location_id,o.form.book_qty=0,o.form.spu_code=e[0].spu_code,o.form.spu_name=e[0].spu_name,o.form.sku_code=e[0].sku_code)},openLocationSelect:()=>{o.showLocationDialogSelect=!0},closeDialogSelectLocation:()=>{o.showLocationDialogSelect=!1},sureSelectLocation:e=>{e.length>0&&(o.form.goods_location_id=e[0].id,o.form.warehouse_name=e[0].warehouse_name,o.form.location_name=e[0].location_name)},clearLocation:()=>{o.form.goods_location_id=0,o.form.warehouse_name="",o.form.location_name=""},submit:async()=>{const{valid:e}=await w.value.validate(),a=s.constructFormBody();if(e){const{data:p}=await M(a);if(!p.isSuccess){g.$message({type:"error",content:p.errorMessage});return}g.$message({type:"success",content:`${n.global.t("system.page.submit")}${n.global.t("system.tips.success")}`}),b("saveSuccess")}else g.$message({type:"error",content:n.global.t("system.checkText.checkFormFail")})},constructFormBody:()=>{let e={...o.form};return e=W(e),e}});return E(()=>_.value,e=>{e&&s.initForm()}),(e,a)=>{const p=i("v-toolbar"),f=i("v-btn"),q=i("v-tooltip"),r=i("v-text-field"),I=i("v-form"),L=i("v-card-text"),F=i("v-card-actions"),U=i("v-card"),B=i("v-dialog");return G(),H(Q,null,[t(B,{modelValue:d(_),"onUpdate:modelValue":a[9]||(a[9]=l=>P(_)?_.value=l:null),width:"30%",transition:"dialog-top-transition",persistent:!0},{default:m(()=>[t(U,null,{default:m(()=>[t(p,{color:"white",title:`${e.$t("router.sideBar.warehouseTaking")}`},{default:m(()=>[t(J,{value:d(x)},null,8,["value"])]),_:1},8,["title"]),t(L,null,{default:m(()=>[k("div",Y,[k("div",Z,[t(y,{size:"x-small",icon:"mdi-home-plus-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseTaking.addFromStock"),onClick:a[0]||(a[0]=l=>s.openCommoditySelect())},null,8,["tooltip-text"]),t(y,{size:"x-small",icon:"mdi-store-plus-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseTaking.addFromCommodity"),disabled:d(S),onClick:a[1]||(a[1]=l=>s.openSkuSelect())},null,8,["tooltip-text","disabled"])]),k("div",R,[t(q,{text:e.$t("wms.warehouseWorking.warehouseTaking.addTips")},{activator:m(({props:l})=>[t(f,K(l,{size:"x-small",variant:"text",icon:"mdi-help-circle",color:"blue-lighten-2"}),null,16)]),_:1},8,["text"])])]),t(I,{ref_key:"formRef",ref:w},{default:m(()=>[t(r,{modelValue:o.form.spu_code,"onUpdate:modelValue":a[2]||(a[2]=l=>o.form.spu_code=l),label:e.$t("base.commodityManagement.spu_code"),rules:o.rules.spu_code,variant:"outlined",readonly:"",clearable:"","onClick:clear":s.clearCommodity},null,8,["modelValue","label","rules","onClick:clear"]),t(r,{modelValue:o.form.spu_name,"onUpdate:modelValue":a[3]||(a[3]=l=>o.form.spu_name=l),label:e.$t("base.commodityManagement.spu_name"),rules:o.rules.spu_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),t(r,{modelValue:o.form.sku_code,"onUpdate:modelValue":a[4]||(a[4]=l=>o.form.sku_code=l),label:e.$t("base.commodityManagement.sku_code"),rules:o.rules.sku_code,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),t(r,{modelValue:o.form.series_number,"onUpdate:modelValue":a[5]||(a[5]=l=>o.form.series_number=l),label:e.$t("wms.stockLocation.series_number"),variant:"outlined",disabled:""},null,8,["modelValue","label"]),t(r,{modelValue:o.form.warehouse_name,"onUpdate:modelValue":a[6]||(a[6]=l=>o.form.warehouse_name=l),label:e.$t("wms.warehouseWorking.warehouseTaking.warehouse"),rules:o.rules.warehouse_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),t(r,{modelValue:o.form.location_name,"onUpdate:modelValue":a[7]||(a[7]=l=>o.form.location_name=l),label:e.$t("wms.warehouseWorking.warehouseTaking.location_name"),rules:o.rules.location_name,variant:"outlined",disabled:d(S),onClick:s.openLocationSelect,"onClick:clear":s.clearLocation},null,8,["modelValue","label","rules","disabled","onClick","onClick:clear"]),t(r,{modelValue:o.form.book_qty,"onUpdate:modelValue":a[8]||(a[8]=l=>o.form.book_qty=l),label:e.$t("wms.warehouseWorking.warehouseTaking.book_qty"),rules:o.rules.book_qty,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1}),t(F,{class:"justify-end"},{default:m(()=>[t(f,{variant:"text",onClick:s.closeDialog},{default:m(()=>[C($(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(f,{color:"primary",variant:"text",disabled:d(T),onClick:s.submit},{default:m(()=>[C($(e.$t("system.page.submit")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(j,{"show-dialog":o.showCommodityDialogSelect,onClose:s.closeCommodityDialogSelect,onSureSelect:s.sureSelectCommodity},null,8,["show-dialog","onClose","onSureSelect"]),t(z,{"show-dialog":o.showSkuDialogSelect,onClose:s.closeDialogSelectSku,onSureSelect:s.sureSelectSku},null,8,["show-dialog","onClose","onSureSelect"]),t(O,{"show-dialog":o.showLocationDialogSelect,onClose:s.closeDialogSelectLocation,onSureSelect:s.sureSelectLocation},null,8,["show-dialog","onClose","onSureSelect"])],64)}}});const Do=X(oo,[["__scopeId","data-v-f391f526"]]);export{Do as default};
