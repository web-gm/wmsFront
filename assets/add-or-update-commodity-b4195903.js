import{i}from"./i18n-0af8b262.js";import{a as f}from"./index-cd6d6b34.js";import{h as $}from"./request-e1053d5a.js";import{g as P}from"./commodityCategorySetting-2425a593.js";import{g as G}from"./supplier-8eff24fc.js";import{c as W,S as Y,e as Z}from"./style-b9bc59b4.js";import{_ as S}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{r as J,a as K}from"./common-938b41ea.js";import{S as _}from"./formRule-3feb276f.js";import{i as v}from"./tableRule-6aa0c57f.js";import{e as Q}from"./exportTable-b0d17537.js";import{h as X}from"./hiprintFast-e8811561.js";import{d as ee,b as h,c as R,r as B,w as te,a as u,x as ae,v as le,s as n,q as a,u as N,as as oe,ap as V,y as U,at as T,ac as ie}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";const Ue=p=>$({url:"/spu/list",method:"post",data:p}),se=p=>$({url:"/spu",method:"post",data:p}),me=p=>$({url:"/spu",method:"put",data:p}),Te=p=>$({url:"/spu",method:"delete",params:{id:p}}),Ce=p=>$({url:"/spu/sku-safety-stock",method:"put",data:p}),re={class:"dataTable"},de={class:"toolbar"},ue=ee({__name:"add-or-update-commodity",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(p,{emit:L}){const x=p,D=h(),y=h(),I=h(),k=R(()=>x.showDialog),O=R(()=>x.form.id&&x.form.id>0?"update":"add"),l=B({form:h({id:0,spu_code:"",spu_name:"",category_id:0,category_name:"",spu_description:"",supplier_id:0,supplier_name:"",brand:"",origin:"",length_unit:1,volume_unit:0,weight_unit:1,detailList:[]}),tableData:[],rules:{spu_code:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.spu_code")}!`,e=>_(e,0,32)===""||_(e,0,32)],spu_name:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.spu_name")}!`,e=>_(e,0,200)===""||_(e,0,200)],spu_description:[e=>_(e,0,1e3)===""||_(e,0,1e3)],brand:[e=>_(e,0,128)===""||_(e,0,128)],category_name:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.category_name")}!`],length_unit:[e=>[0,1,2,3].includes(e)||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.length_unit")}!`],volume_unit:[e=>[0,1,2].includes(e)||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.volume_unit")}!`],weight_unit:[e=>[0,1,2].includes(e)||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.weight_unit")}!`],supplier_name:[e=>!!e||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.supplier_name")}!`]},validRules:h({bar_code:[{type:"string",min:0,max:64,message:`${i.global.t("system.checkText.lengthValid")}${0}-${64}`,trigger:"change"}],sku_code:[{required:!0,message:`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.sku_code")}`},{type:"string",min:0,max:32,message:`${i.global.t("system.checkText.lengthValid")}${0}-${32}`,trigger:"change"}],sku_name:[{required:!0,message:`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.sku_name")}`},{type:"string",min:0,max:200,message:`${i.global.t("system.checkText.lengthValid")}${0}-${200}`,trigger:"change"}],unit:[{required:!0,message:`${i.global.t("system.checkText.mustInput")}${i.global.t("base.commodityManagement.unit")}`},{type:"string",min:0,max:5,message:`${i.global.t("system.checkText.lengthValid")}${0}-${5}`,trigger:"change"}],weight:[{validator:v,validNumerical:"nonNegative",length:8,decimalLength:3,trigger:"change"}],lenght:[{validator:v,validNumerical:"nonNegative",length:8,decimalLength:3,trigger:"change"}],width:[{validator:v,validNumerical:"nonNegative",length:8,decimalLength:3,trigger:"change"}],height:[{validator:v,validNumerical:"nonNegative",length:8,decimalLength:3,trigger:"change"}],volume:[],cost:[{validator:v,validNumerical:"nonNegative",length:10,decimalLength:2,trigger:"change"}],price:[{validator:v,validNumerical:"nonNegative",length:10,decimalLength:2,trigger:"change"}]}),combobox:h({length_unit:[{label:"mm",value:0},{label:"cm",value:1},{label:"dm",value:2},{label:"m",value:3}],volume_unit:[{label:"cm³",value:0},{label:"dm³",value:1},{label:"m³",value:2}],weight_unit:[{label:"mg",value:0},{label:"g",value:1},{label:"kg",value:2}],category_name:[],supplier_name:[]})}),g=B({categoryNameChange:e=>{e?l.form.category_id=l.combobox.category_name.filter(o=>o.label===e)[0].value:l.form.category_id=0},supplierNameChange:e=>{e?l.form.supplier_id=l.combobox.supplier_name.filter(o=>o.label===e)[0].value:l.form.supplier_id=0},getCombobox:async()=>{l.combobox.category_name=[],l.combobox.supplier_name=[];const{data:e}=await P();if(!e.isSuccess){f.$message({type:"error",content:e.errorMessage});return}l.combobox.category_name=e.data.filter(c=>c.is_valid).map(c=>({value:c.id,label:c.category_name}));const{data:o}=await G();if(!o.isSuccess){f.$message({type:"error",content:o.errorMessage});return}l.combobox.supplier_name=o.data.filter(c=>c.is_valid).map(c=>({value:c.id,label:c.supplier_name}))},closeDialog:()=>{L("close")},insertOneRow:()=>{y.value.insertAt(-1)},exportTable:()=>{const e=y.value;Q({table:e,filename:i.global.t("router.sideBar.commodityManagement"),columnFilterMethod({column:o}){return!["checkbox"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},submit:async()=>{const e=y.value,o=await e.validate(!0),{valid:c}=await D.value.validate();if(c&&!o){if(e.getTableData().fullData.length===0){f.$message({type:"error",content:i.global.t("system.tips.detailLengthIsZero")});return}let r={...l.form};const b=e.getInsertRecords();if(r.detailList=[],O.value==="add")r.detailList=[...b];else{const w=e.getUpdateRecords(),d=e.getRemoveRecords();r.detailList=[...b,...w];for(const m of d)m.id=m.id>0?0-m.id:m.id,r.detailList.push(m)}r=J(r),r.detailList=K(r.detailList);const{data:M}=O.value==="add"?await se(r):await me(r);if(!M.isSuccess){f.$message({type:"error",content:M.errorMessage});return}f.$message({type:"success",content:`${i.global.t("system.page.submit")}${i.global.t("system.tips.success")}`}),L("saveSuccess")}else f.$message({type:"error",content:i.global.t("system.checkText.checkFormFail")})},print(){I.value.method.handleOpen()},editRow:e=>{y.value.setEditRow(e)},deleteRow:e=>{const o=y.value;f.$dialog({content:i.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{o.remove(e)}})}}),E=R(()=>W({hasPager:!1,hasToolBar:!0}));return te(()=>k.value,e=>{e&&(g.getCombobox(),l.form=x.form)}),(e,o)=>{const c=u("v-toolbar"),r=u("v-text-field"),b=u("v-select"),M=u("v-form"),w=u("v-col"),d=u("vxe-column"),m=u("vxe-input"),A=u("vxe-table"),q=u("v-row"),z=u("v-card-text"),C=u("v-btn"),F=u("v-card-actions"),j=u("v-card"),H=u("v-dialog");return ae(),le(H,{modelValue:V(k),"onUpdate:modelValue":o[9]||(o[9]=t=>ie(k)?k.value=t:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:n(()=>[a(j,null,{default:n(()=>[a(c,{color:"white",title:`${e.$t("router.sideBar.commodityManagement")}`},null,8,["title"]),a(z,null,{default:n(()=>[a(q,null,{default:n(()=>[a(w,{cols:"3"},{default:n(()=>[N("div",{class:"mainForm",style:oe({height:V(E)})},[a(M,{ref_key:"formRef",ref:D},{default:n(()=>[a(r,{modelValue:l.form.spu_code,"onUpdate:modelValue":o[0]||(o[0]=t=>l.form.spu_code=t),rules:l.rules.spu_code,label:e.$t("base.commodityManagement.spu_code"),variant:"outlined",density:"compact",clearable:"",class:"mb-4"},null,8,["modelValue","rules","label"]),a(r,{modelValue:l.form.spu_name,"onUpdate:modelValue":o[1]||(o[1]=t=>l.form.spu_name=t),rules:l.rules.spu_name,label:e.$t("base.commodityManagement.spu_name"),variant:"outlined",density:"compact",clearable:"",class:"mb-4"},null,8,["modelValue","rules","label"]),a(b,{modelValue:l.form.category_name,"onUpdate:modelValue":[o[2]||(o[2]=t=>l.form.category_name=t),g.categoryNameChange],items:l.combobox.category_name,"item-title":"label","item-value":"label",rules:l.rules.category_name,label:e.$t("base.commodityManagement.category_name"),variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","items","rules","label","onUpdate:modelValue"]),a(r,{modelValue:l.form.spu_description,"onUpdate:modelValue":o[3]||(o[3]=t=>l.form.spu_description=t),rules:l.rules.spu_description,label:e.$t("base.commodityManagement.spu_description"),variant:"outlined",density:"compact",clearable:"",class:"mb-4"},null,8,["modelValue","rules","label"]),a(b,{modelValue:l.form.supplier_name,"onUpdate:modelValue":[o[4]||(o[4]=t=>l.form.supplier_name=t),g.supplierNameChange],items:l.combobox.supplier_name,rules:l.rules.supplier_name,"item-title":"label","item-value":"label",label:e.$t("base.commodityManagement.supplier_name"),variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","items","rules","label","onUpdate:modelValue"]),a(r,{modelValue:l.form.brand,"onUpdate:modelValue":o[5]||(o[5]=t=>l.form.brand=t),rules:l.rules.brand,label:e.$t("base.commodityManagement.brand"),variant:"outlined",density:"compact",clearable:"",class:"mb-4"},null,8,["modelValue","rules","label"]),a(b,{modelValue:l.form.length_unit,"onUpdate:modelValue":o[6]||(o[6]=t=>l.form.length_unit=t),items:l.combobox.length_unit,"item-title":"label","item-value":"value",rules:l.rules.length_unit,label:e.$t("base.commodityManagement.length_unit"),variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","items","rules","label"]),a(b,{modelValue:l.form.volume_unit,"onUpdate:modelValue":o[7]||(o[7]=t=>l.form.volume_unit=t),items:l.combobox.volume_unit,"item-title":"label","item-value":"value",rules:l.rules.volume_unit,label:e.$t("base.commodityManagement.volume_unit"),variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","items","rules","label"]),a(b,{modelValue:l.form.weight_unit,"onUpdate:modelValue":o[8]||(o[8]=t=>l.form.weight_unit=t),items:l.combobox.weight_unit,"item-title":"label","item-value":"value",rules:l.rules.weight_unit,label:e.$t("base.commodityManagement.weight_unit"),variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","items","rules","label"])]),_:1},512)],4)]),_:1}),a(w,{cols:"9"},{default:n(()=>[N("div",re,[N("div",de,[a(S,{icon:"mdi-plus","tooltip-text":e.$t("system.page.insertOneRow"),size:"x-small",onClick:g.insertOneRow},null,8,["tooltip-text","onClick"]),a(S,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.export"),size:"x-small",onClick:g.exportTable},null,8,["tooltip-text","onClick"])]),a(A,{ref_key:"xTable",ref:y,"keep-source":"","column-config":{minWidth:"100px"},data:l.form.detailList,height:V(Y).SELECT_TABLE,align:"center","edit-rules":l.validRules,"edit-config":{trigger:"click",mode:"cell"},"mouse-config":{selected:!0},"keyboard-config":{isArrow:!0,isDel:!0,isEnter:!0,isTab:!0,isEdit:!0,isChecked:!0}},{empty:n(()=>[U(T(V(i).global.t("system.page.noData")),1)]),default:n(()=>[a(d,{type:"seq",width:"60"}),a(d,{field:"sku_code",title:e.$t("base.commodityManagement.sku_code"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.sku_code,"onUpdate:modelValue":s=>t.sku_code=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"sku_name",title:e.$t("base.commodityManagement.sku_name"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.sku_name,"onUpdate:modelValue":s=>t.sku_name=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"unit",title:e.$t("base.commodityManagement.unit"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.unit,"onUpdate:modelValue":s=>t.unit=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"bar_code",title:e.$t("base.commodityManagement.bar_code"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.bar_code,"onUpdate:modelValue":s=>t.bar_code=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"weight",title:e.$t("base.commodityManagement.weight"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.weight,"onUpdate:modelValue":s=>t.weight=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"lenght",title:e.$t("base.commodityManagement.lenght"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.lenght,"onUpdate:modelValue":s=>t.lenght=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"width",title:e.$t("base.commodityManagement.width"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.width,"onUpdate:modelValue":s=>t.width=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"height",title:e.$t("base.commodityManagement.height"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.height,"onUpdate:modelValue":s=>t.height=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"volume",title:e.$t("base.commodityManagement.volume")},null,8,["title"]),a(d,{field:"cost",title:e.$t("base.commodityManagement.cost"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.cost,"onUpdate:modelValue":s=>t.cost=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"price",title:e.$t("base.commodityManagement.price"),"edit-render":{autofocus:".vxe-input--inner"}},{edit:n(({row:t})=>[a(m,{modelValue:t.price,"onUpdate:modelValue":s=>t.price=s,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","edit-render"]),a(d,{field:"operate",title:e.$t("system.page.operate"),width:"100",resizable:!1,"show-overflow":""},{default:n(({row:t})=>[a(S,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":V(Z),onClick:s=>g.deleteRow(t)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height","edit-rules"])])]),_:1})]),_:1})]),_:1}),a(F,{class:"justify-end"},{default:n(()=>[a(C,{variant:"text",onClick:g.closeDialog},{default:n(()=>[U(T(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(C,{color:"primary",variant:"text",onClick:g.submit},{default:n(()=>[U(T(e.$t("system.page.submit")),1)]),_:1},8,["onClick"]),a(C,{color:"primary",variant:"text",onClick:g.print},{default:n(()=>[U(T(e.$t("system.page.print")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),a(X,{ref_key:"hprintDialogRef",ref:I,form:l.form,"tab-page":"print_page_detail"},null,8,["form"])]),_:1},8,["modelValue"])}}});const ce=ne(ue,[["__scopeId","data-v-fd4f02aa"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{ce as a,Se as b,Te as d,Ue as g,Ce as u};
