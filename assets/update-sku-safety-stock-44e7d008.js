import{c as O,S as j,e as A}from"./style-b9bc59b4.js";import{_ as P}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as T}from"./index-cd6d6b34.js";import{i as k}from"./i18n-0af8b262.js";import{g as G}from"./warehouseSetting-835f9e1c.js";import{D as H,a as Q,c as W,P as Y,b as Z}from"./system-93ae242b.js";import{f as J}from"./formatSystem-1203ad16.js";import{s as K}from"./common-938b41ea.js";import{d as M,b as g,r as S,c as X,w as ee,a as n,x as V,v as R,s,q as t,u as h,as as te,ap as p,y as b,at as f,n as ae,m as E,O as U,b0 as oe}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{I as z}from"./formRule-3feb276f.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";const le={class:"dataTable"},se=M({__name:"warehouse-select",emits:["sureSelect"],setup(N,{expose:C,emit:x}){const v=g(),o=S({showDialog:!1,tableData:[],tablePage:S({total:0,pageIndex:1,pageSize:H,searchObjects:g([])}),searchForm:{warehouse_name:"",city:"",manager:""},timer:g(null)}),a=S({handlePageChange:g(({currentPage:e,pageSize:l})=>{o.tablePage.pageIndex=e,o.tablePage.pageSize=l,a.getList()}),sureSearch:()=>{o.tablePage.searchObjects=K(o.searchForm),a.getList()},getList:async()=>{const{data:e}=await G(o.tablePage);if(!e.isSuccess){T.$message({type:"error",content:e.errorMessage});return}o.tableData=e.data.rows,o.tablePage.total=e.data.totals},resetForm:()=>{for(const e in o.searchForm){const l=e;o.searchForm[l]=""}o.tablePage.searchObjects=[]},submit:()=>{const e=v.value.getCheckboxRecords();x("sureSelect",e),a.closeDialog()},openDialog:()=>{a.getList(),o.showDialog=!0},closeDialog:()=>{o.showDialog=!1}});C({openDialog:a.openDialog,closeDialog:a.closeDialog});const u=X(()=>O({}));return ee(()=>o.searchForm,()=>{o.timer&&clearTimeout(o.timer),o.timer=setTimeout(()=>{o.timer=null,a.sureSearch()},Q)},{deep:!0}),(e,l)=>{const m=n("v-toolbar"),d=n("v-text-field"),_=n("v-form"),y=n("v-col"),r=n("vxe-column"),w=n("vxe-table"),I=n("v-row"),F=n("v-card-text"),D=n("v-btn"),L=n("v-card-actions"),c=n("v-card"),$=n("v-dialog");return V(),R($,{modelValue:o.showDialog,"onUpdate:modelValue":l[3]||(l[3]=i=>o.showDialog=i),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:s(()=>[t(c,null,{default:s(()=>[t(m,{color:"white",title:`${e.$t("base.warehouseSetting.warehourseSelectModal")}`},null,8,["title"]),t(F,null,{default:s(()=>[t(I,null,{default:s(()=>[t(y,{cols:"3"},{default:s(()=>[h("div",{class:"searchForm",style:te({height:p(u)})},[t(P,{icon:"mdi-refresh",size:"x-small","tooltip-text":e.$t("system.page.reset"),onClick:a.resetForm},null,8,["tooltip-text","onClick"]),t(P,{icon:"mdi-magnify",size:"x-small","tooltip-text":e.$t("system.page.confirm"),onClick:a.sureSearch},null,8,["tooltip-text","onClick"]),t(_,{ref:"formRef",class:"mt-4"},{default:s(()=>[t(d,{modelValue:o.searchForm.warehouse_name,"onUpdate:modelValue":l[0]||(l[0]=i=>o.searchForm.warehouse_name=i),label:e.$t("base.warehouseSetting.warehouse_name"),variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-4"},null,8,["modelValue","label"]),t(d,{modelValue:o.searchForm.city,"onUpdate:modelValue":l[1]||(l[1]=i=>o.searchForm.city=i),label:e.$t("base.warehouseSetting.city"),variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-4"},null,8,["modelValue","label"]),t(d,{modelValue:o.searchForm.manager,"onUpdate:modelValue":l[2]||(l[2]=i=>o.searchForm.manager=i),label:e.$t("base.warehouseSetting.manager"),variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-4"},null,8,["modelValue","label"])]),_:1},512)],4)]),_:1}),t(y,{cols:"9"},{default:s(()=>[h("div",le,[t(w,{ref_key:"xTable",ref:v,"column-config":{minWidth:"100px"},data:o.tableData,height:p(j).SELECT_TABLE,align:"center"},{empty:s(()=>[b(f(p(k).global.t("system.page.noData")),1)]),default:s(()=>[t(r,{type:"seq",width:"60"}),t(r,{type:"checkbox",width:"50"}),t(r,{field:"warehouse_name",title:e.$t("base.warehouseSetting.warehouse_name")},null,8,["title"]),t(r,{field:"city",title:e.$t("base.warehouseSetting.city")},null,8,["title"]),t(r,{field:"address",title:e.$t("base.warehouseSetting.address")},null,8,["title"]),t(r,{field:"contact_tel",title:e.$t("base.warehouseSetting.contact_tel")},null,8,["title"]),t(r,{field:"email",title:e.$t("base.warehouseSetting.email")},null,8,["title"]),t(r,{field:"manager",title:e.$t("base.warehouseSetting.manager")},null,8,["title"]),t(r,{field:"creator",title:e.$t("base.warehouseSetting.creator")},null,8,["title"]),t(r,{field:"create_time",width:"170px",title:e.$t("base.warehouseSetting.create_time")},null,8,["title"]),t(r,{field:"is_valid",title:e.$t("base.warehouseSetting.is_valid")},{default:s(({row:i,column:q})=>[h("span",null,f(p(J)(i[q.property])),1)]),_:1},8,["title"])]),_:1},8,["data","height"]),t(W,{"current-page":o.tablePage.pageIndex,"page-size":o.tablePage.pageSize,perfect:"",total:o.tablePage.total,"page-sizes":p(Y),layouts:p(Z),onPageChange:a.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])])]),_:1})]),_:1})]),_:1}),t(L,{class:"justify-end"},{default:s(()=>[t(D,{variant:"text",onClick:a.closeDialog},{default:s(()=>[b(f(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(D,{color:"primary",variant:"text",onClick:a.submit},{default:s(()=>[b(f(e.$t("system.page.confirm")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const ne=B(se,[["__scopeId","data-v-832d7775"]]),ie={class:"detailBtnContainer"},re=M({__name:"update-sku-safety-stock",emits:["sure"],setup(N,{expose:C,emit:x}){const v=g(),o=g(),a=S({showDialog:!1,detailList:[],rules:{warehouse_name:[],safety_stock_qty:[e=>!!e||`${k.global.t("system.checkText.mustInput")}${k.global.t("wms.deliveryManagement.detailQty")}!`,e=>z(e,"nonNegative")===""||z(e,"nonNegative")]},skuInfo:{},cacheDeleteDetail:[]}),u=S({openDialog:e=>{a.cacheDeleteDetail=[],a.showDialog=!0,ae(()=>{a.skuInfo=e,a.detailList=e.detailList})},closeDialog:()=>{a.showDialog=!1},addNewRow:()=>{v.value.openDialog()},deleteRow:(e,l)=>{T.$dialog({content:k.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{if(l.id&&l.id>0){const m={...l};m.id=0-l.id,a.cacheDeleteDetail.push(m)}a.detailList.splice(e,1)}})},warehouseSureSelect:e=>{for(const l of e)a.detailList.filter(d=>d.warehouse_id===l.id).length===0&&a.detailList.push({id:0,sku_id:a.skuInfo.id,warehouse_id:l.id,warehouse_name:l.warehouse_name,safety_stock_qty:0})},sureBack:async()=>{const{valid:e}=await o.value.validate();e?x("sure",{sku_id:a.skuInfo.id,detailList:[...a.detailList,...a.cacheDeleteDetail]}):T.$message({type:"error",content:k.global.t("system.checkText.checkFormFail")})}});return C({openDialog:u.openDialog,closeDialog:u.closeDialog}),(e,l)=>{const m=n("v-toolbar"),d=n("v-text-field"),_=n("v-col"),y=n("v-row"),r=n("v-form"),w=n("v-btn"),I=n("v-card-text"),F=n("v-card-actions"),D=n("v-card"),L=n("v-dialog");return V(),E(U,null,[t(L,{modelValue:a.showDialog,"onUpdate:modelValue":l[2]||(l[2]=c=>a.showDialog=c),width:"50%",transition:"dialog-top-transition",persistent:!0},{default:s(()=>[t(D,null,{default:s(()=>[t(m,{color:"white",title:`${e.$t("router.sideBar.commodityManagement")}`},null,8,["title"]),t(I,null,{default:s(()=>[h("div",null,[t(y,null,{default:s(()=>[t(_,{cols:"6"},{default:s(()=>[t(d,{modelValue:a.skuInfo.sku_code,"onUpdate:modelValue":l[0]||(l[0]=c=>a.skuInfo.sku_code=c),label:e.$t("base.commodityManagement.sku_code"),variant:"outlined",density:"compact",readonly:""},null,8,["modelValue","label"])]),_:1}),t(_,{cols:"6"},{default:s(()=>[t(d,{modelValue:a.skuInfo.sku_name,"onUpdate:modelValue":l[1]||(l[1]=c=>a.skuInfo.sku_name=c),label:e.$t("base.commodityManagement.sku_name"),variant:"outlined",density:"compact",readonly:""},null,8,["modelValue","label"])]),_:1})]),_:1})]),h("div",null,[t(r,{ref_key:"formRef",ref:o},{default:s(()=>[(V(!0),E(U,null,oe(a.detailList,(c,$)=>(V(),R(y,{key:$,style:{"margin-top":"5px"}},{default:s(()=>[t(_,{cols:7},{default:s(()=>[t(d,{modelValue:c.warehouse_name,"onUpdate:modelValue":i=>c.warehouse_name=i,label:e.$t("wms.deliveryManagement.warehouse_name"),rules:a.rules.warehouse_name,variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),t(_,{cols:3},{default:s(()=>[t(d,{modelValue:c.safety_stock_qty,"onUpdate:modelValue":i=>c.safety_stock_qty=i,rules:a.rules.safety_stock_qty,label:e.$t("wms.deliveryManagement.detailQty"),variant:"outlined",clearable:""},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),t(_,{cols:2},{default:s(()=>[h("div",ie,[t(P,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":p(A),onClick:i=>u.deleteRow($,c)},null,8,["tooltip-text","icon-color","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},512),t(w,{style:{"font-size":"20px","margin-bottom":"15px","margin-top":"10px",float:"right"},color:"primary",width:40,onClick:u.addNewRow},{default:s(()=>[b(" + ")]),_:1},8,["onClick"])])]),_:1}),t(F,{class:"justify-end"},{default:s(()=>[t(w,{variant:"text",onClick:u.closeDialog},{default:s(()=>[b(f(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(w,{color:"primary",variant:"text",onClick:u.sureBack},{default:s(()=>[b(f(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,{ref_key:"warehouseSelectRef",ref:v,onSureSelect:u.warehouseSureSelect},null,8,["onSureSelect"])],64)}}});const $e=B(re,[["__scopeId","data-v-b2f5615e"]]);export{$e as default};
