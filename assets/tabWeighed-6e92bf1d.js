import{i as g,w as T}from"./i18n-0af8b262.js";import{a as W,b as x}from"./style-b9bc59b4.js";import{D as I,a as q,c as F,P as V,b as L}from"./system-93ae242b.js";import{a as c}from"./index-cd6d6b34.js";import{l as B,o as E,p as z}from"./deliveryManagement-7eebd823.js";import{_ as v}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{G as w}from"./commodityManagement-a1debff9.js";import{g as A,s as O}from"./common-938b41ea.js";import{_ as U}from"./search-delivered-detail.vue_vue_type_script_setup_true_lang-20446111.js";import{e as G}from"./exportTable-b0d17537.js";import{B as H}from"./btnGroup-26ff2079.js";import{_ as R}from"./package-confirm.vue_vue_type_script_setup_true_lang-44235a07.js";import{h as N}from"./httpCodeJudge-e416f8ca.js";import{d as j,b as u,r as $,o as K,c as k,w as Z,a as p,x as J,m as Q,u as h,q as t,s as r,y as Y,at as _,ap as m,as as X,O as ee}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";import"./formRule-3feb276f.js";const ae={class:"operateArea"},ie={style:{width:"100%",display:"flex","justify-content":"center"}},le=j({__name:"tabWeighed",setup(se,{expose:M}){const y=u(),f=u(),a=$({showDeliveredDetailID:0,showDeliveredDetail:!1,showDialog:!1,dialogForm:{id:0},searchForm:{dispatch_no:"",customer_name:"",spu_name:""},timer:u(null),activeTab:null,tableData:u([]),tablePage:u({total:0,pageIndex:1,pageSize:I,searchObjects:[]}),btnList:[],authorityList:A()}),o=$({closeDeliveredDetail:()=>{a.showDeliveredDetail=!1},viewRow:e=>{a.showDeliveredDetailID=e.id,a.showDeliveredDetail=!0},backToThePreviousStep(e){c.$dialog({content:`${g.global.t("wms.deliveryManagement.confirmBack")}?`,handleConfirm:async()=>{const{data:i}=await B(e.id);if(!i.isSuccess){c.$message({type:"error",content:i.errorMessage});return}c.$message({type:"success",content:i.data}),o.refresh()}})},refresh:()=>{o.getWeighed()},getWeighed:async()=>{const{data:e}=await E(a.tablePage);if(!e.isSuccess){c.$message({type:"error",content:e.errorMessage});return}a.tableData=e.data.rows,a.tablePage.total=e.data.totals},handlePageChange:u(({currentPage:e,pageSize:i})=>{a.tablePage.pageIndex=e,a.tablePage.pageSize=i,o.getWeighed()}),exportTable:()=>{const e=y.value;G({table:e,filename:g.global.t("wms.deliveryManagement.weighed"),columnFilterMethod({column:i}){return!["checkbox"].includes(i==null?void 0:i.type)&&!["operate"].includes(i==null?void 0:i.field)}})},sureSearch:()=>{a.tablePage.searchObjects=O(a.searchForm),o.getWeighed()},handleWeigh:async()=>{const i=y.value.getCheckboxRecords(),d=[];if(i.length>0){for(const l of i)d.push({id:l.id,spu_name:l.spu_name,spu_code:l.spu_code,sku_code:l.sku_code,maxQty:l.unweighing_qty,qty:l.unweighing_qty,weight:l.weight,weight_unit:w("weight",l.weight_unit),dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,picked_qty:l.picked_qty});f.value.openDialog(d)}else c.$message({type:"error",content:`${g.global.t("base.userManagement.checkboxIsNull")}`})},dialogSubmit:async e=>{const i=e.map(l=>({id:l.id,dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,weighing_qty:l.qty,weighing_weight:l.weight,picked_qty:l.picked_qty})),{data:d}=await z(i);if(!d.isSuccess){if(N(d.errorMessage)){o.refresh(),f.value.closeDialog();return}c.$message({type:"error",content:d.errorMessage});return}c.$message({type:"success",content:d.data}),f.value.closeDialog(),o.refresh()},getCheckBoxDisableState:({row:e})=>e.is_todo});K(()=>{a.btnList=[{name:g.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:g.global.t("system.page.export"),icon:"mdi-export-variant",code:"weighed-export",click:o.exportTable},{name:g.global.t("wms.deliveryManagement.weigh"),icon:"mdi-weight",code:"weighed-weigh",click:o.handleWeigh}]});const D=k(()=>W({})),C=k(()=>x({}));return Z(()=>a.searchForm,()=>{a.timer&&clearTimeout(a.timer),a.timer=setTimeout(()=>{a.timer=null,o.sureSearch()},q)},{deep:!0}),M({getWeighed:o.getWeighed}),(e,i)=>{const d=p("v-col"),l=p("v-text-field"),b=p("v-row"),s=p("vxe-column"),S=p("vxe-table");return J(),Q(ee,null,[h("div",ae,[t(b,{"no-gutters":""},{default:r(()=>[t(d,{cols:"3",class:"col"},{default:r(()=>[t(H,{"authority-list":a.authorityList,"btn-list":a.btnList},null,8,["authority-list","btn-list"])]),_:1}),t(d,{cols:"9"},{default:r(()=>[t(b,{"no-gutters":"",onKeyup:T(o.sureSearch,["enter"])},{default:r(()=>[t(d,{cols:"4"},{default:r(()=>[t(l,{modelValue:a.searchForm.dispatch_no,"onUpdate:modelValue":i[0]||(i[0]=n=>a.searchForm.dispatch_no=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.dispatch_no"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(d,{cols:"4"},{default:r(()=>[t(l,{modelValue:a.searchForm.customer_name,"onUpdate:modelValue":i[1]||(i[1]=n=>a.searchForm.customer_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(d,{cols:"4"},{default:r(()=>[t(l,{modelValue:a.searchForm.spu_name,"onUpdate:modelValue":i[2]||(i[2]=n=>a.searchForm.spu_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.deliveryManagement.spu_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),h("div",{class:"mt-5",style:X({height:m(D)})},[t(S,{ref_key:"xTable",ref:y,"column-config":{minWidth:"100px"},"checkbox-config":{checkMethod:o.getCheckBoxDisableState,visibleMethod:o.getCheckBoxDisableState},data:a.tableData,height:m(C),align:"center"},{empty:r(()=>[Y(_(m(g).global.t("system.page.noData")),1)]),default:r(()=>[t(s,{type:"seq",width:"60"}),t(s,{type:"checkbox",width:"50"}),t(s,{title:e.$t("wms.deliveryManagement.state")},{default:r(({row:n})=>[h("span",null,_(`${n.is_todo?e.$t("wms.deliveryManagement.weighTodo"):e.$t("wms.deliveryManagement.weighReady")}`),1)]),_:1},8,["title"]),t(s,{field:"weighing_no",title:e.$t("wms.deliveryManagement.weighing_no")},null,8,["title"]),t(s,{field:"dispatch_no",title:e.$t("wms.deliveryManagement.dispatch_no")},null,8,["title"]),t(s,{field:"spu_code",title:e.$t("wms.deliveryManagement.spu_code")},null,8,["title"]),t(s,{field:"spu_description",width:"200px",title:e.$t("wms.deliveryManagement.spu_description")},null,8,["title"]),t(s,{field:"spu_name",title:e.$t("wms.deliveryManagement.spu_name")},null,8,["title"]),t(s,{field:"sku_code",title:e.$t("wms.deliveryManagement.sku_code")},null,8,["title"]),t(s,{field:"bar_code",title:e.$t("wms.deliveryManagement.bar_code")},null,8,["title"]),t(s,{field:"qty",title:e.$t("wms.deliveryManagement.order_qty")},null,8,["title"]),t(s,{field:"weight",title:e.$t("wms.deliveryManagement.detailWeight")},{default:r(({row:n})=>[h("span",null,_(`${n.weight} ${m(w)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),t(s,{field:"volume",title:e.$t("wms.deliveryManagement.detailVolume")},{default:r(({row:n})=>[h("span",null,_(`${n.volume} ${m(w)("volume",n.volume_unit)}`),1)]),_:1},8,["title"]),t(s,{field:"package_person",title:e.$t("wms.deliveryManagement.package_person")},null,8,["title"]),t(s,{field:"package_no",title:e.$t("wms.deliveryManagement.package_no")},null,8,["title"]),t(s,{field:"weighing_person",title:e.$t("wms.deliveryManagement.weighing_person")},null,8,["title"]),t(s,{field:"weighing_weight",title:e.$t("wms.deliveryManagement.weighing_weight")},{default:r(({row:n})=>[h("span",null,_(`${n.weighing_weight} ${m(w)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),t(s,{field:"customer_name",title:e.$t("wms.deliveryManagement.customer_name")},null,8,["title"]),t(s,{field:"creator",title:e.$t("wms.deliveryManagement.creator")},null,8,["title"]),t(s,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.deliveryManagement.create_time")},null,8,["title"]),t(s,{field:"operate",title:e.$t("system.page.operate"),width:"140",resizable:!1,"show-overflow":""},{default:r(({row:n})=>[h("div",ie,[t(v,{flat:!0,icon:"mdi-eye-outline","tooltip-text":e.$t("system.page.view"),onClick:P=>o.viewRow(n)},null,8,["tooltip-text","onClick"]),t(v,{flat:!0,icon:"mdi-arrow-u-left-top","tooltip-text":e.$t("wms.deliveryManagement.backToThePreviousStep"),disabled:!a.authorityList.includes("weighed-revoke"),onClick:P=>o.backToThePreviousStep(n)},null,8,["tooltip-text","disabled","onClick"])])]),_:1},8,["title"])]),_:1},8,["checkbox-config","data","height"]),t(F,{"current-page":a.tablePage.pageIndex,"page-size":a.tablePage.pageSize,perfect:"",total:a.tablePage.total,"page-sizes":m(V),layouts:m(L),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"]),t(U,{id:a.showDeliveredDetailID,"show-dialog":a.showDeliveredDetail,onClose:o.closeDeliveredDetail},null,8,["id","show-dialog","onClose"]),t(R,{ref_key:"WeightConfirmRef",ref:f,"dialog-title":e.$t("wms.deliveryManagement.weigh"),"is-weight":!0,onSubmit:o.dialogSubmit},null,8,["dialog-title","onSubmit"])],4)],64)}}});const Se=te(le,[["__scopeId","data-v-3daed737"]]);export{Se as default};
