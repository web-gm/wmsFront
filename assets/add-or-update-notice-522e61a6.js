import{i}from"./i18n-0af8b262.js";import{a as _}from"./index-cd6d6b34.js";import{c as I,u as N}from"./stockAsn-18b92b84.js";import{g as O}from"./supplier-8eff24fc.js";import{b as q}from"./ownerOfCargo-a67b46ea.js";import{s as T}from"./sku-select-e1d3e93a.js";import{r as h}from"./common-938b41ea.js";import{d as B,b as c,c as k,r as w,w as F,a as r,x as j,m as E,q as a,s as m,y,at as S,ap as L,ac as M,O as z}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./stockManagement-a6372198.js";import"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import"./system-93ae242b.js";import"./style-b9bc59b4.js";import"./index-ae8f073f.js";const H=B({__name:"add-or-update-notice",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(V,{emit:f}){const d=V,b=c(),p=k(()=>d.showDialog),C=k(()=>d.form.id&&d.form.id>0?"update":"add"),e=w({form:c({id:0,asn_no:"",asn_status:0,spu_id:0,spu_code:"",spu_name:"",sku_id:0,sku_code:"",sku_name:"",origin:"",asn_qty:0,weight:0,volume:0,supplier_id:0,supplier_name:"",goods_owner_id:0,goods_owner_name:"",is_valid:!0,detailList:[]}),rules:{supplier_name:[o=>!!o||`${i.global.t("system.checkText.mustInput")}${i.global.t("wms.stockAsnInfo.supplier_name")}!`],goods_owner_name:[],asn_qty:[],spu_code:[],spu_name:[],sku_code:[],sku_name:[]},showSkuDialogSelect:!1,curSelectType:"",combobox:c({supplier_name:[],goods_owner_name:[]})}),n=w({supplierNameChange:o=>{o?e.form.supplier_id=e.combobox.supplier_name.filter(l=>l.label===o)[0].value:e.form.supplier_id=0},goodsOwnerNameChange:o=>{o?e.form.goods_owner_id=e.combobox.goods_owner_name.filter(l=>l.label===o)[0].value:e.form.goods_owner_id=0},getCombobox:async()=>{e.combobox.supplier_name=[],e.combobox.goods_owner_name=[];const{data:o}=await O();if(!o.isSuccess)return;for(const t of o.data)t.is_valid&&e.combobox.supplier_name.push({label:t.supplier_name,value:t.id});const{data:l}=await q();if(!!l.isSuccess)for(const t of l.data)t.is_valid&&e.combobox.goods_owner_name.push({label:t.goods_owner_name,value:t.id})},closeDialog:()=>{f("close")},submit:async()=>{const{valid:o}=await b.value.validate();if(o){const l=h(e.form),{data:t}=C.value==="add"?await I(l):await N(l);if(!t.isSuccess){_.$message({type:"error",content:t.errorMessage});return}_.$message({type:"success",content:`${i.global.t("system.page.submit")}${i.global.t("system.tips.success")}`}),f("saveSuccess")}else _.$message({type:"error",content:i.global.t("system.checkText.checkFormFail")})},clearCommodity:()=>{e.form.spu_id=0,e.form.spu_code="",e.form.spu_name="",e.form.spu_id=0,e.form.sku_code="",e.form.sku_name=""},openSelect:o=>{e.curSelectType=o,o==="target"&&(e.showSkuDialogSelect=!0)},closeDialogSelect:o=>{o==="target"&&(e.showSkuDialogSelect=!1)},sureSelect:o=>{e.curSelectType==="target"&&(e.form.spu_id=o[0].spu_id,e.form.spu_code=o[0].spu_code,e.form.spu_name=o[0].spu_name,e.form.sku_id=o[0].sku_id,e.form.sku_code=o[0].sku_code,e.form.sku_name=o[0].sku_name)}});return F(()=>p.value,o=>{o&&(n.getCombobox(),e.form=d.form)}),(o,l)=>{const t=r("v-toolbar"),g=r("v-select"),u=r("v-text-field"),$=r("v-form"),x=r("v-card-text"),v=r("v-btn"),A=r("v-card-actions"),U=r("v-card"),D=r("v-dialog");return j(),E(z,null,[a(D,{modelValue:L(p),"onUpdate:modelValue":l[8]||(l[8]=s=>M(p)?p.value=s:null),width:"30%",transition:"dialog-top-transition",persistent:!0},{default:m(()=>[a(U,null,{default:m(()=>[a(t,{color:"white",title:`${o.$t("wms.stockAsn.tabNotice")}`},null,8,["title"]),a(x,null,{default:m(()=>[a($,{ref_key:"formRef",ref:b},{default:m(()=>[a(g,{modelValue:e.form.supplier_name,"onUpdate:modelValue":[l[0]||(l[0]=s=>e.form.supplier_name=s),n.supplierNameChange],items:e.combobox.supplier_name,"item-title":"label","item-value":"label",rules:e.rules.supplier_name,label:o.$t("wms.stockAsnInfo.supplier_name"),variant:"outlined",clearable:""},null,8,["modelValue","items","rules","label","onUpdate:modelValue"]),a(g,{modelValue:e.form.goods_owner_name,"onUpdate:modelValue":[l[1]||(l[1]=s=>e.form.goods_owner_name=s),n.goodsOwnerNameChange],items:e.combobox.goods_owner_name,"item-title":"label","item-value":"label",rules:e.rules.goods_owner_name,label:o.$t("wms.stockAsnInfo.goods_owner_name"),variant:"outlined",clearable:""},null,8,["modelValue","items","rules","label","onUpdate:modelValue"]),a(u,{modelValue:e.form.spu_code,"onUpdate:modelValue":l[2]||(l[2]=s=>e.form.spu_code=s),label:o.$t("wms.stockAsnInfo.spu_code"),rules:e.rules.spu_code,variant:"outlined",readonly:"",clearable:"",onClick:l[3]||(l[3]=s=>n.openSelect("target")),"onClick:clear":n.clearCommodity},null,8,["modelValue","label","rules","onClick:clear"]),a(u,{modelValue:e.form.spu_name,"onUpdate:modelValue":l[4]||(l[4]=s=>e.form.spu_name=s),label:o.$t("wms.stockAsnInfo.spu_name"),rules:e.rules.spu_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),a(u,{modelValue:e.form.sku_code,"onUpdate:modelValue":l[5]||(l[5]=s=>e.form.sku_code=s),label:o.$t("wms.stockAsnInfo.sku_code"),rules:e.rules.sku_code,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),a(u,{modelValue:e.form.sku_name,"onUpdate:modelValue":l[6]||(l[6]=s=>e.form.sku_name=s),label:o.$t("wms.stockAsnInfo.sku_name"),rules:e.rules.sku_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),a(u,{modelValue:e.form.asn_qty,"onUpdate:modelValue":l[7]||(l[7]=s=>e.form.asn_qty=s),label:o.$t("wms.stockAsnInfo.asn_qty"),rules:e.rules.asn_qty,variant:"outlined"},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1}),a(A,{class:"justify-end"},{default:m(()=>[a(v,{variant:"text",onClick:n.closeDialog},{default:m(()=>[y(S(o.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(v,{color:"primary",variant:"text",onClick:n.submit},{default:m(()=>[y(S(o.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(T,{"show-dialog":e.showSkuDialogSelect,onClose:l[9]||(l[9]=s=>n.closeDialogSelect("target")),onSureSelect:n.sureSelect},null,8,["show-dialog","onSureSelect"])],64)}}});const ue=G(H,[["__scopeId","data-v-65bd303f"]]);export{ue as default};
