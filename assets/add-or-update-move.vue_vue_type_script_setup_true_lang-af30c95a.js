import{i as l}from"./i18n-0af8b262.js";import{a as w}from"./index-cd6d6b34.js";import{h as c}from"./request-e1053d5a.js";import{M as N}from"./WarehouseMove-eb0037f6.js";import{r as Q}from"./common-938b41ea.js";import{c as A}from"./commodity-select-5da8c47a.js";import{l as F}from"./location-select-a2f98b65.js";import{c as B}from"./custom-qrcode-7ab7b0a5.js";import{I as S}from"./formRule-3feb276f.js";import{d as O,b as $,c as b,r as C,w as j,a as u,x as J,m as Z,q as t,s,ap as v,y as V,at as M,ac as E,O as P}from"./runtime-core.esm-bundler-1bbee395.js";const lo=m=>c({url:"/stockmove/list",method:"post",data:m}),so=m=>c({url:"/stockmove",method:"get",params:{id:m}}),z=m=>c({url:"/stockmove",method:"post",data:m}),ro=m=>c({url:"/stockmove",method:"delete",params:{id:m}}),no=m=>c({url:"/stockmove",method:"put",params:{id:m}}),mo=O({__name:"add-or-update-move",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(m,{emit:h}){const g=m,y=$(),D=b(()=>g.form.id&&g.form.id>0),T=b(()=>!!D.value),L=b(()=>JSON.stringify({id:o.form.id.toString(),type:"warehouseMove"})),f=b(()=>g.showDialog),o=C({showCommodityDialogSelect:!1,showLocationDialogSelect:!1,curAvailableQty:0,form:$({id:0,job_code:"",move_status:N.UNADJUST,sku_id:0,orig_goods_location_id:0,dest_googs_location_id:0,qty:0,goods_owner_id:0,handler:"",handle_time:"",orig_goods_warehouse:"",orig_goods_location_name:"",dest_googs_warehouse:"",dest_googs_location_name:"",spu_code:"",spu_name:"",sku_code:"",sku_name:"",series_number:"",creator:"",create_time:""}),rules:{qty:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("wms.warehouseWorking.warehouseMove.qty")}!`,e=>S(e,"greaterThanZero")===""||S(e,"greaterThanZero"),e=>n.validQty(e)],orig_goods_warehouse:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("wms.warehouseWorking.warehouseMove.orig_goods_warehouse")}!`],orig_goods_location_name:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("wms.warehouseWorking.warehouseMove.orig_goods_location_name")}!`],dest_googs_warehouse:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("wms.warehouseWorking.warehouseMove.dest_googs_warehouse")}!`],dest_googs_location_name:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("wms.warehouseWorking.warehouseMove.dest_googs_location_name")}!`],spu_code:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("base.commodityManagement.spu_code")}!`],spu_name:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("base.commodityManagement.spu_name")}!`],sku_code:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("base.commodityManagement.sku_code")}!`],sku_name:[e=>!!e||`${l.global.t("system.checkText.mustInput")}${l.global.t("base.commodityManagement.sku_name")}!`]}}),n=C({validQty:e=>{let a=Number(e);return Number.isNaN(a)&&(a=0),a>o.curAvailableQty?`${l.global.t("wms.warehouseWorking.warehouseProcessing.qtyMoreThanAvailable")}${o.curAvailableQty}`:!0},closeDialog:()=>{h("close")},initForm:()=>{o.form=g.form},openCommoditySelect:()=>{setTimeout(()=>{o.showCommodityDialogSelect=!0},100)},closeCommodityDialogSelect:()=>{o.showCommodityDialogSelect=!1},openLocationSelect:()=>{setTimeout(()=>{o.showLocationDialogSelect=!0},100)},closeLocationDialogSelect:()=>{o.showLocationDialogSelect=!1},sureSelectCommodity:e=>{try{o.form.sku_id=e[0].sku_id,o.form.orig_goods_location_id=e[0].goods_location_id,o.form.orig_goods_warehouse=e[0].warehouse_name,o.form.orig_goods_location_name=e[0].location_name,o.form.goods_owner_id=e[0].goods_owner_id,o.form.spu_code=e[0].spu_code,o.form.spu_name=e[0].spu_name,o.form.sku_code=e[0].sku_code,o.form.sku_name=e[0].sku_name,o.form.series_number=e[0].series_number,o.curAvailableQty=e[0].qty_available}catch(a){console.error(a)}},sureSelectLocation:e=>{try{o.form.dest_googs_location_id=e[0].id,o.form.dest_googs_warehouse=e[0].warehouse_name,o.form.dest_googs_location_name=e[0].location_name}catch(a){console.error(a)}},clearCommodity:()=>{o.form.sku_id=0,o.form.orig_goods_location_id=0,o.form.orig_goods_warehouse="",o.form.orig_goods_location_name="",o.form.spu_code="",o.form.spu_name="",o.form.sku_code="",o.form.sku_name="",o.curAvailableQty=0},clearLocation:()=>{o.form.dest_googs_location_id=0,o.form.dest_googs_warehouse="",o.form.dest_googs_location_name=""},submit:async()=>{const{valid:e}=await y.value.validate(),a=n.constructFormBody();if(e){const{data:p}=await z(a);if(!p.isSuccess){w.$message({type:"error",content:p.errorMessage});return}w.$message({type:"success",content:`${l.global.t("system.page.submit")}${l.global.t("system.tips.success")}`}),h("saveSuccess")}else w.$message({type:"error",content:l.global.t("system.checkText.checkFormFail")})},constructFormBody:()=>{let e={...o.form};return e=Q(e),e}});return j(()=>f.value,e=>{e&&n.initForm()}),(e,a)=>{const p=u("v-toolbar"),i=u("v-text-field"),d=u("v-col"),_=u("v-row"),U=u("v-form"),I=u("v-card-text"),k=u("v-btn"),q=u("v-card-actions"),W=u("v-card"),x=u("v-dialog");return J(),Z(P,null,[t(x,{modelValue:v(f),"onUpdate:modelValue":a[9]||(a[9]=r=>E(f)?f.value=r:null),width:"60%",transition:"dialog-top-transition",persistent:!0},{default:s(()=>[t(W,null,{default:s(()=>[t(p,{color:"white",title:`${e.$t("router.sideBar.warehouseMove")}`},{default:s(()=>[t(B,{value:v(L)},null,8,["value"])]),_:1},8,["title"]),t(I,null,{default:s(()=>[t(U,{ref_key:"formRef",ref:y},{default:s(()=>[t(_,null,{default:s(()=>[t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.spu_code,"onUpdate:modelValue":a[0]||(a[0]=r=>o.form.spu_code=r),label:e.$t("base.commodityManagement.spu_code"),rules:o.rules.spu_code,variant:"outlined",readonly:"",clearable:"",onClick:n.openCommoditySelect,"onClick:clear":n.clearCommodity},null,8,["modelValue","label","rules","onClick","onClick:clear"])]),_:1}),t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.spu_name,"onUpdate:modelValue":a[1]||(a[1]=r=>o.form.spu_name=r),label:e.$t("base.commodityManagement.spu_name"),rules:o.rules.spu_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1}),t(_,null,{default:s(()=>[t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.sku_code,"onUpdate:modelValue":a[2]||(a[2]=r=>o.form.sku_code=r),label:e.$t("base.commodityManagement.sku_code"),rules:o.rules.sku_code,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1}),t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.series_number,"onUpdate:modelValue":a[3]||(a[3]=r=>o.form.series_number=r),label:e.$t("wms.stockLocation.series_number"),variant:"outlined",disabled:""},null,8,["modelValue","label"])]),_:1})]),_:1}),t(_,null,{default:s(()=>[t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.orig_goods_warehouse,"onUpdate:modelValue":a[4]||(a[4]=r=>o.form.orig_goods_warehouse=r),label:e.$t("wms.warehouseWorking.warehouseMove.orig_goods_warehouse"),rules:o.rules.orig_goods_warehouse,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1}),t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.orig_goods_location_name,"onUpdate:modelValue":a[5]||(a[5]=r=>o.form.orig_goods_location_name=r),label:e.$t("wms.warehouseWorking.warehouseMove.orig_goods_location_name"),rules:o.rules.orig_goods_location_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1}),t(_,null,{default:s(()=>[t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.dest_googs_warehouse,"onUpdate:modelValue":a[6]||(a[6]=r=>o.form.dest_googs_warehouse=r),label:e.$t("wms.warehouseWorking.warehouseMove.dest_googs_warehouse"),rules:o.rules.dest_googs_warehouse,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"])]),_:1}),t(d,{cols:6},{default:s(()=>[t(i,{modelValue:o.form.dest_googs_location_name,"onUpdate:modelValue":a[7]||(a[7]=r=>o.form.dest_googs_location_name=r),label:e.$t("wms.warehouseWorking.warehouseMove.dest_googs_location_name"),rules:o.rules.dest_googs_location_name,variant:"outlined",readonly:"",clearable:"",onClick:n.openLocationSelect,"onClick:clear":n.clearLocation},null,8,["modelValue","label","rules","onClick","onClick:clear"])]),_:1})]),_:1}),t(_,null,{default:s(()=>[t(d,{cols:12},{default:s(()=>[t(i,{modelValue:o.form.qty,"onUpdate:modelValue":a[8]||(a[8]=r=>o.form.qty=r),label:e.$t("wms.warehouseWorking.warehouseMove.qty"),rules:o.rules.qty,variant:"outlined"},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(q,{class:"justify-end"},{default:s(()=>[t(k,{variant:"text",onClick:n.closeDialog},{default:s(()=>[V(M(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(k,{color:"primary",variant:"text",disabled:v(T),onClick:n.submit},{default:s(()=>[V(M(e.$t("system.page.submit")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{"show-dialog":o.showCommodityDialogSelect,onClose:n.closeCommodityDialogSelect,onSureSelect:n.sureSelectCommodity},null,8,["show-dialog","onClose","onSureSelect"]),t(F,{"show-dialog":o.showLocationDialogSelect,onClose:n.closeLocationDialogSelect,onSureSelect:n.sureSelectLocation},null,8,["show-dialog","onClose","onSureSelect"])],64)}}});export{mo as _,so as a,no as c,ro as d,lo as g};
