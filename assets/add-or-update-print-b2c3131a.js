import{a as A}from"./index-cd6d6b34.js";import{a as J,u as G}from"./printSolution-f5a888b7.js";import{i as d}from"./i18n-0af8b262.js";import{r as W}from"./jquery-4c9fd5c5.js";import{d as O,r as E,c as V,a as c,x as S,v as I,s as o,q as a,y,at as x,u as h,ap as $,aZ as U,aY as R,b as j,w as Y,n as Z,m as K,b0 as Q,O as X,ac as ee,g as te}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";var ie=W();const ne=f=>(U("data-v-8879d54a"),f=f(),R(),f),ae={class:"preview_box"},oe=ne(()=>h("div",{id:"preview_content_custom",class:"preview_content"},null,-1)),le=O({__name:"preView",setup(f,{expose:N}){const u=E({formVisible:!1,waitShowPrinter:!1,width:0,hiprintTemplate:{},hiprintData:{},printData:{}}),g=E({hideModal(){u.formVisible=!1},show(){u.formVisible=!0,setTimeout(()=>{ie("#preview_content_custom").html(u.hiprintTemplate.getHtml(u.printData))},500)},print(){u.waitShowPrinter=!0,u.hiprintTemplate.print(u.printData,{},{callback:()=>{u.waitShowPrinter=!1}})}}),M=V(()=>{let v=u.width*3.78;return v+=25,`${v}px`});return N({data:u,method:g}),(v,b)=>{const P=c("v-toolbar-title"),C=c("v-spacer"),e=c("v-btn"),m=c("v-toolbar"),L=c("v-col"),D=c("v-row"),B=c("v-card"),i=c("v-dialog");return S(),I(i,{modelValue:u.formVisible,"onUpdate:modelValue":b[0]||(b[0]=t=>u.formVisible=t),width:$(M),height:"90%"},{default:o(()=>[a(B,null,{default:o(()=>[a(m,{color:"white"},{default:o(()=>[a(P,null,{default:o(()=>[y(x(v.$t("system.page.preView")),1)]),_:1}),a(C),a(e,{color:"primary",variant:"text",onClick:g.print},{default:o(()=>[y(x(v.$t("system.page.print")),1)]),_:1},8,["onClick"]),a(e,{variant:"text",onClick:g.hideModal},{default:o(()=>[y(x(v.$t("system.page.close")),1)]),_:1},8,["onClick"])]),_:1}),h("div",ae,[a(D,null,{default:o(()=>[a(L,{cols:"12"},{default:o(()=>[oe]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue","width"])}}});const re=H(le,[["__scopeId","data-v-8879d54a"]]),F=[{vue_path:"commodityManagement",i18nName:"base.commodityManagement",children:[{tab_page:"print_page_main",form:{detailList:{name:"print_data_main",columns:["sku_code","sku_name","category_name","spu_description","supplier_name","bar_code","weight","lenght","width","height","volume","cost","price"]}}},{tab_page:"print_page_detail",form:{id:0,spu_code:"",spu_name:"",category_id:0,category_name:"",spu_description:"",supplier_id:0,supplier_name:"",brand:"",origin:"",length_unit:1,volume_unit:0,weight_unit:1,detailList:{name:"print_data_detail",columns:["sku_code","sku_name","unit","weight","width","height","volume","cost","price"]}}}]},{vue_path:"customer",i18nName:"base.customer",children:[{tab_page:"print_page_main",form:{detailList:{name:"print_data_main",columns:["customer_name","city","address","manager","email","contact_tel"]}}},{tab_page:"print_page_detail",form:{id:0,customer_name:"",city:"",address:"",manager:"",email:"",contact_tel:""}}]}],z=f=>(U("data-v-dbd78fd9"),f=f(),R(),f),se={style:{padding:"15px 15px"}},pe={style:{"padding-left":"5px"}},de={style:{"padding-left":"5px"}},me={class:"center-btn-box"},ce={class:"right-top-box"},ue=z(()=>h("div",{class:"left-box"},[h("div",{id:"hiprintEpContainer",class:"rect-printElement-types hiprintEpContainer"})],-1)),_e=z(()=>h("div",{class:"center-box card-design"},[h("div",{id:"hiprint-printTemplate",style:{"margin-top":"20px"},class:"hiprint-printTemplate"})],-1)),he=z(()=>h("div",{class:"right-box"},[h("div",{id:"PrintElementOptionSetting"})],-1)),fe=O({__name:"add-or-update-print",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(f,{expose:N,emit:u}){const g=f;j();const{appContext:M}=te(),v=M.config.globalProperties,{hiprint:b}=v,P=V(()=>g.showDialog),C=j(),e=E({form:{id:0,solution_name:"",config_json:"",report_length:0,report_width:0,report_direction:"A4",tenant_id:0},table:[],i18nName:"",pageForm:{},hiprintTemplate:{},mode:"",modeList:[],pageList:[],curPaper:{type:"A4",width:210,height:296.6},paperTypes:{A3:{width:420,height:296.6},A4:{width:210,height:296.6},A5:{width:210,height:147.6},B3:{width:500,height:352.6},B4:{width:250,height:352.6},B5:{width:250,height:175.6}},scaleValue:1,scaleMax:5,scaleMin:.5,panel:{}}),m=E({provider(){const i=[new b.PrintElementTypeGroup(d.global.t("system.hiprint.routine"),[{tid:"providerModule.customText",title:d.global.t("system.hiprint.text"),customText:d.global.t("system.hiprint.text"),custom:!0,type:"text"},{tid:"providerModule.image",title:"Logo",custom:!0,type:"image"}])],t=[];for(const l in e.pageForm){const r=`${e.i18nName}.${l}`,p=d.global.t(r);p!==r&&!l.includes("detailList")&&t.push({tid:`providerModule.${l}`,title:p,data:p,type:"text",options:{field:l,testData:p,height:16,fontSize:6.75,fontWeight:"700",textAlign:"left",textContentVerticalAlign:"middle"}})}let n=1;return e.table.forEach(l=>{const r={tid:`providerModule.table${n.toString()}`,title:l.name,type:"table",options:{field:l.field,fields:[{text:"名称",field:"NAME"}]},editable:!0,columnDisplayEditable:!0,columnDisplayIndexEditable:!0,columnTitleEditable:!0,columnResizable:!0,columnAlignEditable:!0,columns:[[{title:"部门",align:"center",field:"dept",width:50}]]};r.columns[0]=[],r.options.fields=[],l.columns.forEach(p=>{const w=`${e.i18nName}.${p}`,T=d.global.t(w);w!==T&&(r.columns[0].push({title:T,align:"center",field:p,width:50}),r.options.fields.push({text:T,field:p}))}),t.push(r),n+=1}),t.length>0&&i.push(new b.PrintElementTypeGroup(d.global.t("system.hiprint.field"),t)),i.push(new b.PrintElementTypeGroup(d.global.t("system.hiprint.auxiliary"),[{tid:"providerModule.hline",title:d.global.t("system.hiprint.hline"),type:"hline"},{tid:"providerModule.vline",title:d.global.t("system.hiprint.vline"),type:"vline"},{tid:"providerModule.rect",title:d.global.t("system.hiprint.rect"),type:"rect"},{tid:"providerModule.oval",title:d.global.t("system.hiprint.oval"),type:"oval"}])),{addElementTypes:function(l){l.removePrintElementTypes("providerModule"),l.addPrintElementTypes("providerModule",i)}}},initProvier(){b.init({providers:[m.provider()]});const i=document.getElementById("hiprintEpContainer");i!==null&&(i.innerHTML=""),b.PrintElementTypeManager.build(".hiprintEpContainer","providerModule")},initTemplate(){const i=document.getElementById("hiprint-printTemplate");i!==null&&(i.innerHTML=""),e.hiprintTemplate=new b.PrintTemplate({template:e.panel,dataMode:1,history:!1,onImageChooseClick:t=>{const n=document.createElement("input");n.setAttribute("type","file"),n.click(),n.onchange=function(s){var r;const l=(r=s==null?void 0:s.target)==null?void 0:r.files[0];if(l){const p=new FileReader;p.readAsDataURL(l),p.onloadend=function(){t.refresh(p.result)}}},n.remove()},settingContainer:"#PrintElementOptionSetting",paginationContainer:".hiprint-printPagination"}),e.hiprintTemplate.design("#hiprint-printTemplate")},handleSetPaper(i,t){try{Object.keys(e.paperTypes).includes(i)?e.curPaper={type:i,width:t.width,height:t.height}:e.curPaper={type:"other",width:t.width,height:t.height},e.hiprintTemplate&&e.hiprintTemplate.setPaper(t.width,t.height)}catch{}},handleChangeScale(i){let t=e.scaleValue;i?(t+=.1,t>e.scaleMax&&(t=5)):(t-=.1,t<e.scaleMin&&(t=.5)),t=Number(t.toFixed(1)),e.hiprintTemplate&&(e.hiprintTemplate.zoom(t,!0),e.scaleValue=t)},handleChangePath(){e.form.tab_page="",m.initPageList()},initPageList(){e.pageList=[];const i=F.filter(t=>t.vue_path===e.form.vue_path);i.length>0&&(e.i18nName=i[0].i18nName,e.pageList=i[0].children.map(t=>{let n=t.tab_page;return t.tab_page===i[0].vue_path?n=d.global.t(`router.sideBar.${t.tab_page}`):n=d.global.t(`${e.i18nName}.${t.tab_page}`),{value:t.tab_page,label:n,form:t.form}}))},handleChangePage(){const i=e.pageList.filter(t=>t.value===e.form.tab_page);if(e.table=[],i.length>0){e.pageForm=i[0].form;for(const t in e.pageForm)if(t.indexOf("detailList")>-1){const n=e.pageForm[t],s=d.global.t(`${e.i18nName}.${n.name}`);e.table.push({name:s,field:t,columns:n.columns})}}m.initProvier(),m.initTemplate()},async handleSubmit(){if(e.hiprintTemplate){const i=JSON.stringify(e.hiprintTemplate.getJson()||{}),t={id:e.form.id,vue_path:e.form.vue_path,tab_page:e.form.tab_page,solution_name:e.form.solution_name,config_json:i,report_length:e.curPaper.height,report_width:e.curPaper.width,report_direction:e.curPaper.type,tenant_id:0},{data:n}=t.id===0?await J(t):await G(t);if(!n.isSuccess){A.$message({type:"error",content:n.errorMessage});return}A.$message({type:"success",content:`${d.global.t("system.page.submit")}${d.global.t("system.tips.success")}`}),u("saveSuccess")}},handleClose(){u("close")},handlePreView(){const i=C.value;i.data.width=e.curPaper.width,i.data.hiprintTemplate=e.hiprintTemplate;const t={};for(const n in e.pageForm)if(n.includes("detailList")){const s=e.pageForm[n],l={};s.columns.forEach(r=>{const p=`${e.i18nName}.${r}`,w=d.global.t(p);p!==w?l[r]=w:l[r]=r}),t[n]=[l]}else{let s=n;const l=`${e.i18nName}.${n}`,r=d.global.t(l);r!==l&&(s=r),t[n]=s}i.data.printData=t,i.method.show()}});Y(()=>P.value,i=>{i&&Z(()=>{if(g.form.id>0)e.form=g.form,e.form.config_json?e.panel=JSON.parse(e.form.config_json):e.panel={},m.initPageList(),m.handleChangePage(),Object.keys(e.paperTypes).includes(e.form.report_direction)&&(e.curPaper={type:e.form.report_direction,width:e.paperTypes[e.form.report_direction].width,height:e.paperTypes[e.form.report_direction].height},m.handleSetPaper(e.curPaper.type,e.curPaper));else{e.form={id:0,solution_name:"",config_json:"",report_length:0,report_width:0,report_direction:"st",tenant_id:0},e.curPaper={type:"A4",width:210,height:296.6},m.handleSetPaper(e.curPaper.type,e.curPaper);const t=document.getElementById("hiprintEpContainer");t!==null&&(t.innerHTML="");const n=document.getElementById("hiprint-printTemplate");n!==null&&(n.innerHTML=""),e.panel={}}})});const L=V(()=>{let i=e.scaleValue*100;return i=Number(i.toFixed(0)),i}),D=V(()=>{let i="other";const t=e.paperTypes;for(const n in t){const s=t[n],{width:l,height:r}=e.curPaper;s.width===l&&s.height===r&&(i=n)}return i}),B=V(()=>F.map(i=>({value:i.vue_path,label:d.global.t(`router.sideBar.${i.vue_path}`)})));return N({data:e}),(i,t)=>{const n=c("v-select"),s=c("v-col"),l=c("v-text-field"),r=c("v-row"),p=c("v-btn"),w=c("v-icon"),T=c("v-card"),q=c("v-dialog");return S(),I(q,{modelValue:$(P),"onUpdate:modelValue":t[9]||(t[9]=_=>ee(P)?P.value=_:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:o(()=>[a(T,null,{default:o(()=>[h("div",se,[a(r,{"no-gutters":""},{default:o(()=>[a(s,{cols:"4"},{default:o(()=>[a(r,{"no-gutters":""},{default:o(()=>[a(s,{cols:4},{default:o(()=>[a(n,{modelValue:e.form.vue_path,"onUpdate:modelValue":[t[0]||(t[0]=_=>e.form.vue_path=_),t[1]||(t[1]=_=>m.handleChangePath())],items:$(B),"item-title":"label","item-value":"value",label:i.$t("base.printSolution.vue_path"),density:"compact","hide-details":"",clearable:"",variant:"outlined",disabled:g.form.id>0},null,8,["modelValue","items","label","disabled"])]),_:1}),a(s,{cols:"4"},{default:o(()=>[h("div",pe,[a(n,{modelValue:e.form.tab_page,"onUpdate:modelValue":[t[2]||(t[2]=_=>e.form.tab_page=_),t[3]||(t[3]=_=>m.handleChangePage())],items:e.pageList,"item-title":"label","item-value":"value",label:i.$t("base.printSolution.tab_page"),density:"compact","hide-details":"",disabled:g.form.id>0,clearable:"",variant:"outlined"},null,8,["modelValue","items","label","disabled"])])]),_:1}),a(s,{cols:"4"},{default:o(()=>[h("div",de,[a(l,{modelValue:e.form.solution_name,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.solution_name=_),label:i.$t("base.printSolution.solution_name"),density:"compact","hide-details":"",clearable:"",variant:"outlined",disabled:g.form.id>0},null,8,["modelValue","label","disabled"])])]),_:1})]),_:1})]),_:1}),a(s,{cols:"7"},{default:o(()=>[h("div",me,[h("div",null,[(S(!0),K(X,null,Q(e.paperTypes,(_,k)=>(S(),I(p,{key:k,color:$(D)===k?"indigo-darken-3":"white",onClick:ge=>m.handleSetPaper(k,_)},{default:o(()=>[y(x(k),1)]),_:2},1032,["color","onClick"]))),128)),a(p,{icon:"mdi-magnify-minus-outline",style:{"font-size":"14px","margin-left":"10px"},size:"small",onClick:t[5]||(t[5]=_=>m.handleChangeScale(!1))}),a(p,{disabled:"",size:"small",style:{"margin-left":"10px",width:"70px"}},{default:o(()=>[y(x($(L))+"%",1)]),_:1}),a(p,{icon:"mdi-magnify-plus-outline",style:{"font-size":"14px","margin-left":"10px"},size:"small",onClick:t[6]||(t[6]=_=>m.handleChangeScale(!0))})]),h("div",null,[a(p,{style:{"font-size":"14px","margin-left":"10px"},onClick:t[7]||(t[7]=_=>m.handlePreView())},{default:o(()=>[y(x(i.$t("system.page.preView")),1)]),_:1}),a(p,{style:{"font-size":"14px","margin-left":"10px"},disabled:!e.form.solution_name||!e.form.tab_page,color:"primary",onClick:m.handleSubmit},{default:o(()=>[y(x(i.$t("system.page.submit")),1)]),_:1},8,["disabled","onClick"])])])]),_:1}),a(s,{cols:"1"},{default:o(()=>[h("div",ce,[a(p,{icon:"",style:{"font-size":"14px","margin-left":"10px"},size:"small",onClick:t[8]||(t[8]=_=>m.handleClose())},{default:o(()=>[a(w,null,{default:o(()=>[y("mdi-close")]),_:1})]),_:1})])]),_:1})]),_:1}),a(r,null,{default:o(()=>[a(s,{cols:"2"},{default:o(()=>[ue]),_:1}),a(s,{cols:"7"},{default:o(()=>[_e]),_:1}),a(s,{cols:"3"},{default:o(()=>[he]),_:1})]),_:1})])]),_:1}),a(re,{ref_key:"preViewDialogRef",ref:C},null,512)]),_:1},8,["modelValue"])}}});const ke=H(fe,[["__scopeId","data-v-dbd78fd9"]]);export{ke as default};
