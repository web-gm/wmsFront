import{i as l,v as I}from"./i18n-0af8b262.js";import{r as M,u as q,e as z}from"./exportTable-b0d17537.js";import{e as L}from"./freightSetting-4f9f7a61.js";import{a as y}from"./index-cd6d6b34.js";import{S as j,e as A}from"./style-b9bc59b4.js";import{_ as D}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as k}from"./formatSystem-1203ad16.js";import{d as H,b as S,c as J,r as T,w as O,a as s,x as G,v as U,s as n,q as t,u as E,t as W,ap as C,y as V,at as B,ac as Y}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";const K={class:"mb-4"},P=H({__name:"import-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(F,{emit:w}){const R=F,$=S(),m=S(),b=J(()=>R.showDialog),d=T({importData:S([]),validRules:S({})}),r=T({initForm:()=>{d.importData=[]},closeDialog:()=>{w("close")},submit:async()=>{if(!r.valid())return;const g=m.value.getTableData().fullData,{data:i}=await L(g);if(!i.isSuccess){y.$message({type:"error",content:i.errorMessage});return}y.$message({type:"success",content:`${l.global.t("system.page.submit")}${l.global.t("system.tips.success")}`}),w("saveSuccess")},valid:()=>m.value.getTableData().fullData.length<=0?(y.$message({type:"error",content:`${l.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{$.value.value="",$.value.click()},readExcel:async e=>{const a=e.target.files;if(a.length<=0)return!1;const g=a[0],i=new FileReader;i.onload=u=>{var f;const v=(f=u==null?void 0:u.target)==null?void 0:f.result;if(v){const h=M(v,{type:"binary"}),x=h.SheetNames[0];let _=q.sheet_to_json(h.Sheets[x]),o=JSON.stringify(_);o=o.replace(/（/g,"("),o=o.replace(/）/g,")"),_=JSON.parse(o),d.importData=[],_.forEach((N,c,p)=>{d.importData.push({carrier:k(p[c][l.global.t("base.freightSetting.carrier")]),departure_city:k(p[c][l.global.t("base.freightSetting.departure_city")]),arrival_city:k(p[c][l.global.t("base.freightSetting.arrival_city")]),price_per_weight:p[c][l.global.t("base.freightSetting.price_per_weight")],price_per_volume:p[c][l.global.t("base.freightSetting.price_per_volume")],min_payment:p[c][l.global.t("base.freightSetting.min_payment")]})})}},i.readAsBinaryString(g)},exportTemplate:()=>{const e=m.value;z({table:e,filename:l.global.t("router.sideBar.freightSetting"),mode:"header",columnFilterMethod({column:a}){return!["checkbox","seq"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},deleteRow:e=>{y.$dialog({content:l.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&m.value.remove(e)}})}});return O(()=>b.value,e=>{e&&r.initForm()}),(e,a)=>{const g=s("v-toolbar"),i=s("vxe-column"),u=s("vxe-table"),v=s("v-card-text"),f=s("v-btn"),h=s("v-card-actions"),x=s("v-card"),_=s("v-dialog");return G(),U(_,{modelValue:C(b),"onUpdate:modelValue":a[1]||(a[1]=o=>Y(b)?b.value=o:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:n(()=>[t(x,null,{default:n(()=>[t(g,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),t(v,null,{default:n(()=>[E("div",K,[t(D,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:r.chooseFile},null,8,["tooltip-text","onClick"]),t(D,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:r.exportTemplate},null,8,["tooltip-text","onClick"]),W(E("input",{id:"open",ref_key:"uploadExcel",ref:$,type:"file",accept:".xls, .xlsx",onChange:a[0]||(a[0]=(...o)=>r.readExcel&&r.readExcel(...o))},null,544),[[I,!1]])]),t(u,{ref_key:"xTable",ref:m,"column-config":{minWidth:"100px"},data:d.importData,height:C(j).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":d.validRules,"export-config":{},align:"center"},{default:n(()=>[t(i,{type:"seq",width:"60"}),t(i,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:n(({row:o})=>[t(D,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":C(A),onClick:N=>r.deleteRow(o)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),t(i,{field:"carrier",title:e.$t("base.freightSetting.carrier")},null,8,["title"]),t(i,{field:"departure_city",title:e.$t("base.freightSetting.departure_city")},null,8,["title"]),t(i,{field:"arrival_city",title:e.$t("base.freightSetting.arrival_city")},null,8,["title"]),t(i,{field:"price_per_weight",title:e.$t("base.freightSetting.price_per_weight")},null,8,["title"]),t(i,{field:"price_per_volume",title:e.$t("base.freightSetting.price_per_volume")},null,8,["title"]),t(i,{field:"min_payment",title:e.$t("base.freightSetting.min_payment")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),t(h,{class:"justify-end"},{default:n(()=>[t(f,{variant:"text",onClick:r.closeDialog},{default:n(()=>[V(B(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),t(f,{color:"primary",variant:"text",onClick:r.submit},{default:n(()=>[V(B(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const de=Z(P,[["__scopeId","data-v-84103d90"]]);export{de as default};
