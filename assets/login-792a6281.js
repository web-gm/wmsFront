import{i as d,w as V,e as R}from"./i18n-0af8b262.js";import{M as k,_ as x,L}from"./logo.vue_vue_type_style_index_0_lang-02850142.js";import{h as b}from"./request-e1053d5a.js";import{s as l}from"./index-f4e4efab.js";import{a as p}from"./index-cd6d6b34.js";import{r as P,e as T}from"./index-827f2091.js";import{d as y,b as U,r as f,o as I,a as g,x as $,m as C,u as a,at as h,q as n,s as v,y as M,aZ as D,aY as F}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";import"./vue-router-1283ad2d.js";const B="/assets/loginLeft-9ac0858c.png",J=r=>b({url:"/login",method:"post",data:r}),O=r=>b({url:"/rolemenu/authority",method:"get",params:{userrole_id:r}}),q={class:"loginForm"},A={class:"titleText"},E={class:"formContainer"},K=y({__name:"login-form",setup(r){const u=U(),e=f({showDialog:!1,valid:!0,showPassword:!1,userName:"",password:"",remember:!1,dialogForm:{id:0,user_num:"",user_name:"",auth_string:"",email:"",is_valid:!0},userNameVaildRules:[s=>!!s||`${d.global.t("system.checkText.mustInput")}${d.global.t("login.userName")}!`],passwordVaildRules:[s=>!!s||`${d.global.t("system.checkText.mustInput")}${d.global.t("login.password")}!`]}),i=f({handleShowPassword:()=>{e.showPassword=!e.showPassword},login:async()=>{const{valid:s}=await u.value.validate();if(!s)return;const{data:o}=await J({user_name:e.userName,password:k.hashStr(e.password)});if(o.isSuccess){const c=new Date().getTime()+o.data.expire*60*1e3;l.commit("user/setToken",o.data.access_token),l.commit("user/setRefreshToken",o.data.refresh_token),l.commit("user/setExpirationTime",c),l.commit("user/setEffectiveMinutes",o.data.expire),l.commit("user/setUserInfo",o.data);const{data:m}=await O(o.data.userrole_id);if(!m.isSuccess){p.$message({type:"error",content:m.errorMessage});return}if(m.data.length<=0){p.$message({type:"error",content:d.global.t("login.notAuthority")});return}const _=m.data;if(l.commit("user/setUserMenuList",_),p.$message({type:"success",content:d.global.t("login.loginSuccess")}),e.remember){const w=JSON.stringify({userName:window.btoa(encodeURIComponent(e.userName)),password:window.btoa(encodeURIComponent(e.password))});localStorage.setItem("userLoginInfo",w)}else localStorage.setItem("userLoginInfo","");l.commit("system/setCurrentRouterPath","homepage"),P.push("home")}else p.$message({type:"error",content:o.errorMessage})},openRegisterDialog:()=>{e.dialogForm={id:0,user_num:"",user_name:"",auth_string:"",email:"",is_valid:!0},e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{i.closeDialog()}});return I(()=>{const s=localStorage.getItem("userLoginInfo");if(s){const o=JSON.parse(s);try{e.userName=decodeURIComponent(window.atob(o.userName)),e.password=decodeURIComponent(window.atob(o.password))}catch{e.userName=window.atob(o.userName),e.password=window.atob(o.password)}e.remember=!0}}),(s,o)=>{const c=g("v-text-field"),m=g("v-checkbox"),_=g("v-btn"),w=g("v-form");return $(),C("div",q,[a("div",A,[a("h5",null,h(s.$t("login.welcomeTitle")),1)]),a("div",E,[n(w,{ref_key:"VFormRef",ref:u,modelValue:e.valid,"onUpdate:modelValue":o[5]||(o[5]=t=>e.valid=t),"lazy-validation":"",onKeydown:o[6]||(o[6]=V(R(t=>i.login(),["prevent"]),["enter"]))},{default:v(()=>[n(c,{modelValue:e.userName,"onUpdate:modelValue":o[0]||(o[0]=t=>e.userName=t),required:"",rules:e.userNameVaildRules,label:s.$t("login.userName"),variant:"solo"},null,8,["modelValue","rules","label"]),n(c,{modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=t=>e.password=t),required:"",rules:e.passwordVaildRules,autocomplete:!1,"append-inner-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password",label:s.$t("login.password"),variant:"solo","onClick:appendInner":o[2]||(o[2]=t=>i.handleShowPassword())},null,8,["modelValue","rules","append-inner-icon","type","label"]),n(m,{modelValue:e.remember,"onUpdate:modelValue":o[3]||(o[3]=t=>e.remember=t),label:s.$t("login.rememberTips")},null,8,["modelValue","label"]),n(_,{color:"purple",class:"loginBtn",onClick:o[4]||(o[4]=t=>i.login())},{default:v(()=>[M(h(s.$t("login.mainButtonLabel")),1)]),_:1})]),_:1},8,["modelValue"])])])}}});const j=N(K,[["__scopeId","data-v-9af5a320"]]),S=r=>(D("data-v-ea8887ca"),r=r(),F(),r),z={class:"loginContainer"},W=S(()=>a("div",{class:"loginLeft"},[a("img",{src:B,style:{width:"80%"}})],-1)),Y={class:"loginRight"},Z={class:"LanguagesSwitchContainer"},G=S(()=>a("div",{class:"copyRight"},[a("a",{href:"https://modernwms.ikeyly.com",target:"_blank"},"CopyRight © 2023 ModernWMS All Rights Reserve")],-1)),H=y({__name:"login",setup(r){const u=f({toICP:()=>{window.open("https://beian.miit.gov.cn/","_blank")}});return I(()=>{T.emit("closeLoading")}),(e,i)=>($(),C("div",z,[n(x),W,a("div",Y,[a("div",Z,[n(L)]),n(j)]),G,a("div",{class:"ICP",onClick:i[0]||(i[0]=(...s)=>u.toICP&&u.toICP(...s))}," 闽ICP备2021008548号 ")]))}});const ie=N(H,[["__scopeId","data-v-ea8887ca"]]);export{ie as default};
