import{a as S,b as T,e as C}from"./style-b9bc59b4.js";import{D as A,a as k,c as F,P as H,b as L}from"./system-93ae242b.js";import{_}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as m}from"./index-cd6d6b34.js";import{g as M,s as B}from"./common-938b41ea.js";import{i as r}from"./i18n-0af8b262.js";import{d as E,b as z}from"./supplier-8eff24fc.js";import{e as I}from"./exportTable-b0d17537.js";import{B as R}from"./btnGroup-26ff2079.js";import{d as O,b as p,r as b,o as N,c as y,w as G,a as n,x as j,m as U,u,q as a,s as l,as as V,ap as c,y as q,at as J}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./index-ae8f073f.js";import"./vue-router-1283ad2d.js";import"./request-e1053d5a.js";import"./index-827f2091.js";const W={class:"container"},Y={class:"operateArea"},K=O({__name:"tabAllocation",setup(Q){const g=p(),e=b({searchForm:{},tableData:[],showDialog:!1,showDialogImport:!1,dialogForm:{id:0,dateFrom:"",dateTo:"",allocationRule:"",startAllocation:"",is_valid:!0},tablePage:{total:0,pageIndex:1,pageSize:A,searchObjects:p([])},timer:p(null),btnList:[],authorityList:M()}),o=b({sureSearch:()=>{e.tablePage.searchObjects=B(e.searchForm),o.getData()},add:()=>{e.dialogForm={id:0,dateFrom:"",dateTo:"",allocationRule:"",startAllocation:"",is_valid:!0},e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{o.refresh(),o.closeDialog()},refresh:()=>{o.getData()},editRow(t){e.dialogForm=JSON.parse(JSON.stringify(t)),e.showDialog=!0},deleteRow(t){m.$dialog({content:r.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.id){const{data:s}=await E(t.id);if(!s.isSuccess){m.$message({type:"error",content:s.errorMessage});return}m.$message({type:"success",content:`${r.global.t("system.page.delete")}${r.global.t("system.tips.success")}`}),o.refresh()}}})},handlePageChange:p(({currentPage:t,pageSize:s})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=s,o.getData()}),exportTable:()=>{const t=g.value;I({table:t,filename:r.global.t("router.sideBar.supplier"),columnFilterMethod({column:s}){return!["checkbox"].includes(s==null?void 0:s.type)&&!["operate"].includes(s==null?void 0:s.field)}})},getData:async()=>{const{data:t}=await z(e.tablePage);if(!t.isSuccess){m.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals}});N(()=>{e.btnList=[{name:r.global.t("system.page.add"),icon:"mdi-plus",code:"save",click:o.add},{name:r.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:r.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:o.exportTable}],o.getData()});const v=y(()=>S({hasTab:!1})),D=y(()=>T({hasTab:!1}));return G(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,o.sureSearch()},k)},{deep:!0}),(t,s)=>{const d=n("v-col"),f=n("v-row"),i=n("vxe-column"),w=n("vxe-table"),x=n("v-card-text"),$=n("v-card");return j(),U("div",W,[u("div",null,[a($,{class:"mt-5"},{default:l(()=>[a(x,null,{default:l(()=>[u("div",Y,[a(f,{"no-gutters":""},{default:l(()=>[a(d,{cols:"12",sm:"4",class:"col"},{default:l(()=>[a(R,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(d,{cols:"12",sm:"8"},{default:l(()=>[a(f,{"no-gutters":""},{default:l(()=>[a(d,{cols:"12",sm:"4"}),a(d,{cols:"12",sm:"4"}),a(d,{cols:"12",sm:"4"})]),_:1})]),_:1})]),_:1})]),u("div",{class:"mt-5",style:V({height:c(v)})},[a(w,{ref_key:"xTable",ref:g,"column-config":{minWidth:"100px"},data:e.tableData,height:c(D),align:"center"},{empty:l(()=>[q(J(c(r).global.t("system.page.noData")),1)]),default:l(()=>[a(i,{type:"seq",width:"60"}),a(i,{field:"dateFrom",formatter:["formatDate","HH:mm:ss"],title:t.$t("wms.deliveryBatchAllocation.dateFrom")},null,8,["title"]),a(i,{field:"dateTo",formatter:["formatDate","HH:mm:ss"],title:t.$t("wms.deliveryBatchAllocation.dateTo")},null,8,["title"]),a(i,{field:"allocationRule",title:t.$t("wms.deliveryBatchAllocation.allocationRule")},null,8,["title"]),a(i,{field:"creator",title:t.$t("base.supplier.creator")},null,8,["title"]),a(i,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:t.$t("base.supplier.create_time")},null,8,["title"]),a(i,{field:"last_update_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:t.$t("base.supplier.last_update_time")},null,8,["title"]),a(i,{field:"operate",title:t.$t("system.page.operate"),width:"160",resizable:!1,"show-overflow":""},{default:l(({row:h})=>[a(_,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":t.$t("system.page.edit"),disabled:!e.authorityList.includes("save"),onClick:P=>o.editRow(h)},null,8,["tooltip-text","disabled","onClick"]),a(_,{flat:!0,icon:"mdi-delete-outline","tooltip-text":t.$t("system.page.delete"),"icon-color":e.authorityList.includes("delete")?c(C):"",disabled:!e.authorityList.includes("delete"),onClick:P=>o.deleteRow(h)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),a(F,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":c(H),layouts:c(L),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1})])])}}});const fe=Z(K,[["__scopeId","data-v-5a4d466e"]]);export{fe as default};
