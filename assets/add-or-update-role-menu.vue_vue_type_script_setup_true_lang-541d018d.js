import{i}from"./i18n-0af8b262.js";import{a as p}from"./index-cd6d6b34.js";import{h as f}from"./request-e1053d5a.js";import{g as D}from"./userRoleSetting-2c2fc537.js";import{a as V}from"./actionList-473e0ea7.js";import{r as A}from"./common-938b41ea.js";import{d as B,b as d,c as F,r as C,w as I,a as n,x as E,v as N,s as m,q as s,y as S,at as w,ap as U,ac as j}from"./runtime-core.esm-bundler-1bbee395.js";const W=()=>f({url:"/rolemenu/all",method:"get"}),q=()=>f({url:"/rolemenu/menus",method:"get"}),X=r=>f({url:"/rolemenu",method:"get",params:{userrole_id:r}}),H=r=>f({url:"/rolemenu",method:"post",data:r}),K=r=>f({url:"/rolemenu",method:"put",data:r}),Y=r=>f({url:"/rolemenu",method:"delete",params:{userrole_id:r}}),ee=B({__name:"add-or-update-role-menu",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(r,{emit:x}){const _=r,y=d(),g=F(()=>_.showDialog),k=d(),e=C({dialogTitle:"",form:d({userrole_id:0,role_name:"",detailList:[]}),menusSelectedList:d([]),removeDetailList:d([]),combobox:d({role_name:[],menu_name:[]}),rules:{role_name:[t=>!!t||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.roleMenu.role_name")}!`],menu_name:[t=>!!t||`${i.global.t("system.checkText.mustInput")}${i.global.t("base.roleMenu.menu_name")}!`]}}),c=C({getDialogType:()=>{_.form.detailList.length>0?e.dialogTitle="update":e.dialogTitle="add"},getCombobox:async()=>{e.combobox.role_name=[];const{data:t}=await D();if(!t.isSuccess)return;const o=t.data;for(const l of o)e.combobox.role_name.push({label:l.role_name,value:l.id});const{data:a}=await q();if(!a.isSuccess)return;const u=a.data;e.combobox.menu_name=u.map(l=>({label:i.global.t(`router.sideBar.${l.menu_name}`),value:l.id,menu_name:l.menu_name}))},closeDialog:()=>{x("close")},beforeSubmit:()=>{let t=!0;for(const o of e.menusSelectedList)e.form.detailList.findIndex(a=>a.menu_id===o)<0&&e.form.detailList.push({id:0,menu_id:o,menu_actions_authority:[]});if(e.dialogTitle==="update")for(const o of e.form.detailList)e.menusSelectedList.includes(o.menu_id)||(o.id=-o.id);return e.form.detailList.length===0&&(p.$message({type:"error",content:i.global.t("system.tips.detailLengthIsZero")}),t=!1),t},submit:async()=>{if(!c.beforeSubmit())return;const{valid:o}=await y.value.validate();if(o){let a={...e.form};a.detailList=a.detailList.map(l=>{if(!l.id||l.id===0){const b=e.combobox.menu_name.findIndex(v=>v.value===l.menu_id);l.menu_actions_authority=b>-1?V[e.combobox.menu_name[b].menu_name]:[]}return l}),a=A(a);const{data:u}=e.dialogTitle==="add"?await H(a):await K({...a,detailList:[...a.detailList,...e.removeDetailList]});if(!u.isSuccess){p.$message({type:"error",content:u.errorMessage});return}p.$message({type:"success",content:`${i.global.t("system.page.submit")}${i.global.t("system.tips.success")}`}),x("saveSuccess")}else p.$message({type:"error",content:i.global.t("system.checkText.checkFormFail")})},selectAllEvent:({checked:t})=>{t?e.menusSelectedList=e.combobox.menu_name.map(o=>o.value):e.menusSelectedList=[]},selectChangeEvent:()=>{const t=k.value.getCheckboxRecords();e.menusSelectedList=t.map(o=>o.value)}});return I(()=>_.showDialog,t=>{t&&(c.getDialogType(),c.getCombobox(),e.form=_.form,e.menusSelectedList=e.form.detailList.map(o=>o.menu_id))}),(t,o)=>{const a=n("v-toolbar"),u=n("v-select"),l=n("v-form"),b=n("vxe-column"),v=n("vxe-table"),$=n("v-card-text"),L=n("v-btn"),T=n("v-card-actions"),M=n("v-card"),R=n("v-dialog");return E(),N(R,{modelValue:U(g),"onUpdate:modelValue":o[1]||(o[1]=h=>j(g)?g.value=h:null),persistent:!0,width:"30%",transition:"dialog-top-transition"},{default:m(()=>[s(M,{class:"formCard"},{default:m(()=>[s(a,{title:`${t.$t("router.sideBar.roleMenu")}`,color:"white"},null,8,["title"]),s($,null,{default:m(()=>[s(l,{ref_key:"formRef",ref:y},{default:m(()=>[s(u,{modelValue:e.form.userrole_id,"onUpdate:modelValue":o[0]||(o[0]=h=>e.form.userrole_id=h),disabled:e.dialogTitle==="update",items:e.combobox.role_name,label:t.$t("base.roleMenu.role_name"),rules:e.rules.role_name,clearable:"","item-title":"label","item-value":"value",variant:"outlined"},null,8,["modelValue","disabled","items","label","rules"])]),_:1},512),s(v,{ref_key:"xTable",ref:k,"checkbox-config":{checkRowKeys:e.menusSelectedList},data:e.combobox.menu_name,"radio-config":{labelField:"value"},"row-config":{isHover:!0,keyField:"value"},align:"center","max-height":"500","row-id":"value",onCheckboxAll:c.selectAllEvent,onCheckboxChange:c.selectChangeEvent},{default:m(()=>[s(b,{type:"checkbox",width:"60"}),s(b,{title:t.$t("base.roleMenu.menu_name"),field:"label"},null,8,["title"])]),_:1},8,["checkbox-config","data","onCheckboxAll","onCheckboxChange"])]),_:1}),s(T,{class:"justify-end"},{default:m(()=>[s(L,{variant:"text",onClick:c.closeDialog},{default:m(()=>[S(w(t.$t("system.page.close")),1)]),_:1},8,["onClick"]),s(L,{color:"primary",variant:"text",onClick:c.submit},{default:m(()=>[S(w(t.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{ee as _,X as a,Y as d,W as g,K as u};
