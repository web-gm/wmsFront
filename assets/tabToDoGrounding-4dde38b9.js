import{i as n,w as C}from"./i18n-0af8b262.js";import{a as L,b as T}from"./style-b9bc59b4.js";import{D as P,a as x,c as F,P as G,b as O}from"./system-93ae242b.js";import{a as r}from"./index-cd6d6b34.js";import{g as M,s as q}from"./common-938b41ea.js";import{t as z,v as E,w as R,g as V}from"./stockAsn-18b92b84.js";import{_ as B}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import N from"./update-grounding-ebf14d6e.js";import U from"./sku-info-138df2f3.js";import{e as H}from"./exportTable-b0d17537.js";import{B as j}from"./btnGroup-26ff2079.js";import J from"./confirm-grouding-a3a17b74.js";import{h as k}from"./httpCodeJudge-e416f8ca.js";import{d as K,b as u,r as h,o as Z,c as y,w as W,a as d,x as Y,m as Q,u as _,q as o,s as c,y as X,at as S,ap as g,aq as ee,as as te,O as oe}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./index-ae8f073f.js";import"./vue-router-1283ad2d.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./location-select-a2f98b65.js";import"./warehouseSetting-835f9e1c.js";import"./formatSystem-1203ad16.js";import"./formatWarehouse-aebb7b18.js";import"./Warehouse-56a6b193.js";import"./tableRule-6aa0c57f.js";const ae={class:"operateArea"},le=["onClick"],ne=K({__name:"tabToDoGrounding",setup(ie,{expose:v}){const f=u(),p=u(),t=h({showDialog:!1,showDialogShowInfo:!1,searchForm:{supplier_name:"",sku_name:""},activeTab:null,dialogForm:u({id:0,asn_no:"",asn_batch:"",estimated_arrival_time:"",detailList:[]}),tableData:u([]),tablePage:h({total:0,sqlTitle:"asn_status:3",pageIndex:1,pageSize:P,searchObjects:u([])}),timer:u(null),btnList:[],authorityList:M()}),s=h({confirmGroudingSure:async e=>{const{data:a}=await z(e);if(!a.isSuccess){if(k(a.errorMessage)){s.refresh(),p.value.closeDialog();return}r.$message({type:"error",content:a.errorMessage});return}r.$message({type:"success",content:`${n.global.t("system.page.submit")}${n.global.t("system.tips.success")}`}),p.value.closeDialog(),s.refresh()},handleRevoke:()=>{const e=f.value.getCheckboxRecords();if(e.length>0){const a=e.map(i=>i.id);r.$dialog({content:n.global.t("system.tips.beforeOperation"),handleConfirm:async()=>{const{data:i}=await E(a);if(!i.isSuccess){if(k(i.errorMessage)){s.refresh();return}r.$message({type:"error",content:i.errorMessage});return}r.$message({type:"success",content:`${n.global.t("system.page.delete")}${n.global.t("system.tips.success")}`}),s.refresh()}})}else r.$message({type:"error",content:n.global.t("wms.stockAsnInfo.selectOne")})},closeDialogShowInfo:()=>{t.showDialogShowInfo=!1},showSkuInfo(e){t.dialogForm=JSON.parse(JSON.stringify(e)),t.showDialogShowInfo=!0},closeDialog:()=>{t.showDialog=!1},saveSuccess:()=>{s.refresh(),s.closeDialog()},editRow(e){p.value.openDialog(e.id)},deleteRow(e){r.$dialog({content:n.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:a}=await R(e.id);if(!a.isSuccess){r.$message({type:"error",content:a.errorMessage});return}r.$message({type:"success",content:`${n.global.t("system.page.revoke")}${n.global.t("system.tips.success")}`}),s.refresh()}}})},refresh:()=>{s.getStockAsnList()},getStockAsnList:async()=>{const{data:e}=await V(t.tablePage);if(!e.isSuccess){r.$message({type:"error",content:e.errorMessage});return}t.tableData=e.data.rows,t.tablePage.total=e.data.totals},handlePageChange:u(({currentPage:e,pageSize:a})=>{t.tablePage.pageIndex=e,t.tablePage.pageSize=a,s.getStockAsnList()}),exportTable:()=>{const e=f.value;H({table:e,filename:n.global.t("wms.stockAsn.tabToDoGrounding"),columnFilterMethod({column:a}){return!["checkbox"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},sureSearch:()=>{t.tablePage.searchObjects=q(t.searchForm),s.getStockAsnList()}});Z(()=>{t.btnList=[{name:n.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:s.refresh},{name:n.global.t("system.page.export"),icon:"mdi-export-variant",code:"putOnTheShelf-export",click:s.exportTable},{name:n.global.t("wms.stockAsnInfo.revoke"),icon:"mdi-arrow-left-top",code:"putOnTheShelf-delete",click:s.handleRevoke}]});const $=y(()=>L({})),I=y(()=>T({}));return v({getStockAsnList:s.getStockAsnList}),W(()=>t.searchForm,()=>{t.timer&&clearTimeout(t.timer),t.timer=setTimeout(()=>{t.timer=null,s.sureSearch()},x)},{deep:!0}),(e,a)=>{const i=d("v-col"),b=d("v-text-field"),w=d("v-row"),l=d("vxe-column"),A=d("vxe-table");return Y(),Q(oe,null,[_("div",ae,[o(w,{"no-gutters":""},{default:c(()=>[o(i,{cols:"3",class:"col"},{default:c(()=>[o(j,{"authority-list":t.authorityList,"btn-list":t.btnList},null,8,["authority-list","btn-list"])]),_:1}),o(i,{cols:"9"},{default:c(()=>[o(w,{"no-gutters":"",onKeyup:C(s.sureSearch,["enter"])},{default:c(()=>[o(i,{cols:"4"}),o(i,{cols:"4"},{default:c(()=>[o(b,{modelValue:t.searchForm.supplier_name,"onUpdate:modelValue":a[0]||(a[0]=m=>t.searchForm.supplier_name=m),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.supplier_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),o(i,{cols:"4"},{default:c(()=>[o(b,{modelValue:t.searchForm.sku_name,"onUpdate:modelValue":a[1]||(a[1]=m=>t.searchForm.sku_name=m),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.sku_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),_("div",{class:"mt-5",style:te({height:g($)})},[o(A,{ref_key:"xTableStockLocation",ref:f,"column-config":{minWidth:"100px"},data:t.tableData,height:g(I),align:"center"},{empty:c(()=>[X(S(g(n).global.t("system.page.noData")),1)]),default:c(()=>[o(l,{type:"seq",width:"60"}),o(l,{type:"checkbox",width:"50"}),o(l,{field:"asn_no",title:e.$t("wms.stockAsnInfo.asn_no")},null,8,["title"]),o(l,{field:"spu_code",title:e.$t("wms.stockAsnInfo.spu_code")},null,8,["title"]),o(l,{field:"spu_name",title:e.$t("wms.stockAsnInfo.spu_name")},null,8,["title"]),o(l,{field:"sku_code",title:e.$t("wms.stockAsnInfo.sku_code")},{default:c(({row:m})=>[_("div",{class:ee("text-decoration-none"),onClick:D=>s.showSkuInfo(m)},S(m.sku_code),9,le)]),_:1},8,["title"]),o(l,{field:"sku_name",title:e.$t("wms.stockAsnInfo.sku_name")},null,8,["title"]),o(l,{field:"goods_owner_name",title:e.$t("wms.stockAsnInfo.goods_owner_name")},null,8,["title"]),o(l,{field:"supplier_name",title:e.$t("wms.stockAsnInfo.supplier_name")},null,8,["title"]),o(l,{field:"asn_qty",title:e.$t("wms.stockAsnInfo.asn_qty")},null,8,["title"]),o(l,{field:"weight",title:e.$t("wms.stockAsnInfo.weight")},null,8,["title"]),o(l,{field:"volume",title:e.$t("wms.stockAsnInfo.volume")},null,8,["title"]),o(l,{field:"sorted_qty",title:e.$t("wms.stockAsnInfo.sorted_qty")},null,8,["title"]),o(l,{field:"actual_qty",title:e.$t("wms.stockAsnInfo.actual_qty")},null,8,["title"]),o(l,{field:"operate",title:e.$t("system.page.operate"),width:"160",resizable:!1,"show-overflow":""},{default:c(({row:m})=>[o(B,{flat:!0,icon:"mdi-package-up","tooltip-text":e.$t("wms.stockAsnInfo.grounding"),disabled:!t.authorityList.includes("putOnTheShelf-editArrival"),onClick:D=>s.editRow(m)},null,8,["tooltip-text","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),o(F,{"current-page":t.tablePage.pageIndex,"page-size":t.tablePage.pageSize,perfect:"",total:t.tablePage.total,"page-sizes":g(G),layouts:g(O),onPageChange:s.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4),o(N,{"show-dialog":t.showDialog,form:t.dialogForm,onClose:s.closeDialog,onSaveSuccess:s.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),o(J,{ref_key:"confirmGroudingDialogRef",ref:p,onSure:s.confirmGroudingSure},null,8,["onSure"]),o(U,{"show-dialog":t.showDialogShowInfo,form:t.dialogForm,onClose:s.closeDialogShowInfo},null,8,["show-dialog","form","onClose"])],64)}}});const Ge=se(ne,[["__scopeId","data-v-0a0177ef"]]);export{Ge as default};
