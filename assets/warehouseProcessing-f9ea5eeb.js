import{i,w as W}from"./i18n-0af8b262.js";import{a as B,b as L,e as M}from"./style-b9bc59b4.js";import{D as O,a as E,c as F,P as I,b as V}from"./system-93ae242b.js";import{a as n}from"./index-cd6d6b34.js";import{g as z,a as H,d as R,c as U,b as N,e as G}from"./add-or-update-process-f245e57a.js";import{P as _,b as J}from"./warehouseWorking-497fd91f.js";import{g as K,s as q}from"./common-938b41ea.js";import{f as Z}from"./formatSystem-1203ad16.js";import{c as Y}from"./formatWarehouseWorking-dc5b5102.js";import{_ as h}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{e as Q}from"./exportTable-b0d17537.js";import{B as X}from"./btnGroup-26ff2079.js";import{d as ee,b as p,r as b,n as v,k as te,o as se,c as k,w as oe,a as d,x as ae,m as re,u as f,q as s,s as l,as as ie,ap as m,y as le,at as w}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./commodity-select-5da8c47a.js";import"./stockManagement-a6372198.js";import"./location-select-a2f98b65.js";import"./warehouseSetting-835f9e1c.js";import"./formatWarehouse-aebb7b18.js";import"./Warehouse-56a6b193.js";import"./sku-select-e1d3e93a.js";import"./custom-qrcode-7ab7b0a5.js";import"./tableRule-6aa0c57f.js";import"./index-ae8f073f.js";import"./WarehouseMove-eb0037f6.js";import"./WarehouseAdjust-937657c2.js";const ce={class:"container"},de={class:"operateArea"},me=ee({__name:"warehouseProcessing",setup(ue){const y=p(),t=b({showDialog:!1,processType:_,timer:p(null),activeTab:null,searchForm:{job_code:""},tableData:p([]),dialogForm:{id:0,job_code:"",job_type:_,process_status:!1,processor:"",process_time:"",source_detail_list:p([]),target_detail_list:p([]),creator:"",create_time:"",adjust_status:!1},tablePage:b({total:0,pageIndex:1,pageSize:O,searchObjects:p([])}),btnList:[],authorityList:K()}),o=b({add:e=>{t.processType=e,t.dialogForm={id:0,job_code:"",job_type:e,process_status:!1,processor:"",process_time:"",source_detail_list:[],target_detail_list:[],creator:"",create_time:"",adjust_status:!1},v(()=>{t.showDialog=!0})},saveSuccess:()=>{o.refresh(),o.closeDialog()},refresh:()=>{o.getStockProcessList()},closeDialog:()=>{t.showDialog=!1},getStockProcessList:async()=>{const{data:e}=await z(t.tablePage);if(!e.isSuccess){n.$message({type:"error",content:e.errorMessage});return}t.tableData=e.data.rows,t.tablePage.total=e.data.totals},viewRow:async e=>{await o.getOne(e.id),v(()=>{t.showDialog=!0})},getOne:async e=>{const{data:a}=await H(e);if(!a.isSuccess){n.$message({type:"error",content:a.errorMessage});return}t.dialogForm=a.data,t.processType=a.data.job_type},deleteRow(e){n.$dialog({content:i.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:a}=await R(e.id);if(!a.isSuccess){n.$message({type:"error",content:a.errorMessage});return}n.$message({type:"success",content:`${i.global.t("system.page.delete")}${i.global.t("system.tips.success")}`}),o.refresh()}}})},handlePageChange:p(({currentPage:e,pageSize:a})=>{t.tablePage.pageIndex=e,t.tablePage.pageSize=a,o.refresh()}),exportTable:()=>{const e=y.value;Q({table:e,filename:i.global.t("router.sideBar.warehouseProcessing"),columnFilterMethod({column:a}){return!["checkbox"].includes(a==null?void 0:a.type)&&!["operate"].includes(a==null?void 0:a.field)}})},sureSearch:()=>{t.tablePage.searchObjects=q(t.searchForm),o.refresh()},confirmProcessBtnDisabled:e=>!!e.process_status,confirmAdjustBtnDisabled:e=>!e.process_status||!!e.adjust_status,confirmProcess:async e=>{n.$dialog({content:i.global.t("wms.warehouseWorking.warehouseProcessing.beforeConfirmProcess"),handleConfirm:async()=>{if(e.id){const{data:a}=await U(e.id);if(!a.isSuccess){n.$message({type:"error",content:a.errorMessage});return}n.$message({type:"success",content:`${i.global.t("wms.warehouseWorking.warehouseProcessing.confirmProcess")}${i.global.t("system.tips.success")}`}),o.refresh()}}})},confirmAdjust:async e=>{n.$dialog({content:i.global.t("wms.warehouseWorking.warehouseProcessing.beforeConfirmAdjust"),handleConfirm:async()=>{if(e.id){const{data:a}=await N(e.id);if(!a.isSuccess){n.$message({type:"error",content:a.errorMessage});return}n.$message({type:"success",content:`${i.global.t("wms.warehouseWorking.warehouseProcessing.confirmAdjust")}${i.global.t("system.tips.success")}`}),o.refresh()}}})}});te(()=>{o.refresh()}),se(()=>{t.btnList=[{name:i.global.t("wms.warehouseWorking.warehouseProcessing.process_split"),icon:"mdi-arrow-split-vertical",code:"split",click:()=>{o.add(J)}},{name:i.global.t("wms.warehouseWorking.warehouseProcessing.process_combine"),icon:"mdi-group",code:"group",click:()=>{o.add(_)}},{name:i.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:i.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:o.exportTable}]});const $=k(()=>B({hasTab:!1})),S=k(()=>L({hasTab:!1}));return oe(()=>t.searchForm,()=>{t.timer&&clearTimeout(t.timer),t.timer=setTimeout(()=>{t.timer=null,o.sureSearch()},E)},{deep:!0}),(e,a)=>{const g=d("v-col"),j=d("v-text-field"),P=d("v-row"),c=d("vxe-column"),C=d("vxe-table"),x=d("v-window-item"),D=d("v-window"),T=d("v-card-text"),A=d("v-card");return ae(),re("div",ce,[f("div",null,[s(A,{class:"mt-5"},{default:l(()=>[s(T,null,{default:l(()=>[s(D,{modelValue:t.activeTab,"onUpdate:modelValue":a[1]||(a[1]=r=>t.activeTab=r)},{default:l(()=>[s(x,null,{default:l(()=>[f("div",de,[s(P,{"no-gutters":""},{default:l(()=>[s(g,{cols:"3",class:"col"},{default:l(()=>[s(X,{"authority-list":t.authorityList,"btn-list":t.btnList},null,8,["authority-list","btn-list"])]),_:1}),s(g,{cols:"9"},{default:l(()=>[s(P,{"no-gutters":"",onKeyup:W(o.sureSearch,["enter"])},{default:l(()=>[s(g,{cols:"4"}),s(g,{cols:"4"}),s(g,{cols:"4"},{default:l(()=>[s(j,{modelValue:t.searchForm.job_code,"onUpdate:modelValue":a[0]||(a[0]=r=>t.searchForm.job_code=r),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.warehouseWorking.warehouseProcessing.job_code"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),f("div",{class:"mt-5",style:ie({height:m($)})},[s(C,{ref_key:"xTable",ref:y,"column-config":{minWidth:"100px"},data:t.tableData,height:m(S),align:"center"},{empty:l(()=>[le(w(m(i).global.t("system.page.noData")),1)]),default:l(()=>[s(c,{type:"seq",width:"60"}),s(c,{type:"checkbox",width:"50"}),s(c,{field:"job_code",width:"150px",title:e.$t("wms.warehouseWorking.warehouseProcessing.job_code")},null,8,["title"]),s(c,{field:"job_type",title:e.$t("wms.warehouseWorking.warehouseProcessing.job_type")},{default:l(({row:r,column:u})=>[f("span",null,w(m(Y)(r[u.property])),1)]),_:1},8,["title"]),s(c,{field:"adjust_status",title:e.$t("wms.warehouseWorking.warehouseProcessing.adjust_status")},{default:l(({row:r,column:u})=>[f("span",null,w(m(Z)(r[u.property])),1)]),_:1},8,["title"]),s(c,{field:"processor",title:e.$t("wms.warehouseWorking.warehouseProcessing.processor")},null,8,["title"]),s(c,{field:"process_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.warehouseWorking.warehouseProcessing.process_time")},null,8,["title"]),s(c,{field:"creator",title:e.$t("wms.warehouseWorking.warehouseProcessing.creator")},null,8,["title"]),s(c,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.warehouseWorking.warehouseProcessing.create_time")},null,8,["title"]),s(c,{field:"operate",title:e.$t("system.page.operate"),width:"250",resizable:!1,"show-overflow":""},{default:l(({row:r})=>[s(h,{flat:!0,icon:"mdi-eye-outline","tooltip-text":e.$t("system.page.view"),onClick:u=>o.viewRow(r)},null,8,["tooltip-text","onClick"]),s(h,{flat:!0,icon:"mdi-book-check-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseProcessing.confirmProcess"),disabled:!t.authorityList.includes("confirmOpeartion")||o.confirmProcessBtnDisabled(r),onClick:u=>o.confirmProcess(r)},null,8,["tooltip-text","disabled","onClick"]),s(h,{flat:!0,icon:"mdi-book-open-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseProcessing.confirmAdjust"),disabled:!t.authorityList.includes("confirmAdjust")||o.confirmAdjustBtnDisabled(r),onClick:u=>o.confirmAdjust(r)},null,8,["tooltip-text","disabled","onClick"]),s(h,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":!t.authorityList.includes("delete")||o.confirmProcessBtnDisabled(r)?"":m(M),disabled:!t.authorityList.includes("delete")||o.confirmProcessBtnDisabled(r),onClick:u=>o.deleteRow(r)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),s(F,{"current-page":t.tablePage.pageIndex,"page-size":t.tablePage.pageSize,perfect:"",total:t.tablePage.total,"page-sizes":m(I),layouts:m(V),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(G,{"show-dialog":t.showDialog,form:t.dialogForm,"process-type":t.processType,onClose:o.closeDialog,onSaveSuccess:o.saveSuccess},null,8,["show-dialog","form","process-type","onClose","onSaveSuccess"])])])}}});const Re=ne(me,[["__scopeId","data-v-7d03dc3f"]]);export{Re as default};
