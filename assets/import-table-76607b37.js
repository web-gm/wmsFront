import{i as s,v as N}from"./i18n-0af8b262.js";import{r as I,u as M,e as q}from"./exportTable-b0d17537.js";import{e as z}from"./ownerOfCargo-a67b46ea.js";import{a as w}from"./index-cd6d6b34.js";import{S as L,e as j}from"./style-b9bc59b4.js";import{_ as k}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as b}from"./formatSystem-1203ad16.js";import{d as A,b as C,c as H,r as E,w as J,a as n,x as G,v as U,s as i,q as a,u as V,t as W,ap as $,y as S,at as T,ac as Y}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";const K={class:"mb-4"},P=A({__name:"import-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(B,{emit:O}){const F=B,x=C(),c=C(),v=H(()=>F.showDialog),p=E({importData:C([]),validRules:C({})}),r=E({initForm:()=>{p.importData=[]},closeDialog:()=>{O("close")},submit:async()=>{if(!r.valid())return;const m=c.value.getTableData().fullData,{data:o}=await z(m);if(!o.isSuccess){w.$message({type:"error",content:o.errorMessage});return}w.$message({type:"success",content:`${s.global.t("system.page.submit")}${s.global.t("system.tips.success")}`}),O("saveSuccess")},valid:()=>c.value.getTableData().fullData.length<=0?(w.$message({type:"error",content:`${s.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{x.value.value="",x.value.click()},readExcel:async e=>{const t=e.target.files;if(t.length<=0)return!1;const m=t[0],o=new FileReader;o.onload=d=>{var f;const y=(f=d==null?void 0:d.target)==null?void 0:f.result;if(y){const h=I(y,{type:"binary"}),D=h.SheetNames[0];let g=M.sheet_to_json(h.Sheets[D]),l=JSON.stringify(g);l=l.replace(/（/g,"("),l=l.replace(/）/g,")"),g=JSON.parse(l),p.importData=[],g.forEach((R,u,_)=>{p.importData.push({goods_owner_name:b(_[u][s.global.t("base.ownerOfCargo.goods_owner_name")]),city:b(_[u][s.global.t("base.ownerOfCargo.city")]),address:b(_[u][s.global.t("base.ownerOfCargo.address")]),manager:b(_[u][s.global.t("base.ownerOfCargo.manager")]),contact_tel:b(_[u][s.global.t("base.ownerOfCargo.contact_tel")])})})}},o.readAsBinaryString(m)},exportTemplate:()=>{const e=c.value;q({table:e,filename:s.global.t("router.sideBar.ownerOfCargo"),mode:"header",columnFilterMethod({column:t}){return!["checkbox","seq"].includes(t==null?void 0:t.type)&&!["operate"].includes(t==null?void 0:t.field)}})},deleteRow:e=>{w.$dialog({content:s.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&c.value.remove(e)}})}});return J(()=>v.value,e=>{e&&r.initForm()}),(e,t)=>{const m=n("v-toolbar"),o=n("vxe-column"),d=n("vxe-table"),y=n("v-card-text"),f=n("v-btn"),h=n("v-card-actions"),D=n("v-card"),g=n("v-dialog");return G(),U(g,{modelValue:$(v),"onUpdate:modelValue":t[1]||(t[1]=l=>Y(v)?v.value=l:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:i(()=>[a(D,null,{default:i(()=>[a(m,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),a(y,null,{default:i(()=>[V("div",K,[a(k,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:r.chooseFile},null,8,["tooltip-text","onClick"]),a(k,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:r.exportTemplate},null,8,["tooltip-text","onClick"]),W(V("input",{id:"open",ref_key:"uploadExcel",ref:x,type:"file",accept:".xls, .xlsx",onChange:t[0]||(t[0]=(...l)=>r.readExcel&&r.readExcel(...l))},null,544),[[N,!1]])]),a(d,{ref_key:"xTable",ref:c,"column-config":{minWidth:"100px"},data:p.importData,height:$(L).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":p.validRules,"export-config":{},align:"center"},{empty:i(()=>[S(T($(s).global.t("system.page.noData")),1)]),default:i(()=>[a(o,{type:"seq",width:"60"}),a(o,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:i(({row:l})=>[a(k,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":$(j),onClick:R=>r.deleteRow(l)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),a(o,{field:"goods_owner_name",title:e.$t("base.ownerOfCargo.goods_owner_name")},null,8,["title"]),a(o,{field:"city",title:e.$t("base.ownerOfCargo.city")},null,8,["title"]),a(o,{field:"address",title:e.$t("base.ownerOfCargo.address")},null,8,["title"]),a(o,{field:"manager",title:e.$t("base.ownerOfCargo.manager")},null,8,["title"]),a(o,{field:"contact_tel",title:e.$t("base.ownerOfCargo.contact_tel")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),a(h,{class:"justify-end"},{default:i(()=>[a(f,{variant:"text",onClick:r.closeDialog},{default:i(()=>[S(T(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(f,{color:"primary",variant:"text",onClick:r.submit},{default:i(()=>[S(T(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const de=Z(P,[["__scopeId","data-v-c0ffa276"]]);export{de as default};
