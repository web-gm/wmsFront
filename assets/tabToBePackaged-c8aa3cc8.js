import{i as p,w as M}from"./i18n-0af8b262.js";import{a as T,b as C}from"./style-b9bc59b4.js";import{D as q,a as B,c as S,P as x,b as I}from"./system-93ae242b.js";import{a as h}from"./index-cd6d6b34.js";import{n as L,y as F}from"./deliveryManagement-7eebd823.js";import{_ as V}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{_ as E}from"./package-confirm.vue_vue_type_script_setup_true_lang-44235a07.js";import{G as b}from"./commodityManagement-a1debff9.js";import{g as z,s as A}from"./common-938b41ea.js";import{_ as U}from"./search-delivered-detail.vue_vue_type_script_setup_true_lang-20446111.js";import{e as G}from"./exportTable-b0d17537.js";import{B as O}from"./btnGroup-26ff2079.js";import{d as N,b as c,r as v,o as j,c as w,w as H,a as g,x as R,m as K,u,q as a,s as d,y as Q,at as f,ap as m,as as W,O as Z}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./formRule-3feb276f.js";import"./index-ae8f073f.js";const J={class:"operateArea"},X={style:{width:"100%",display:"flex","justify-content":"center"}},ee=N({__name:"tabToBePackaged",setup(te,{expose:k}){const _=c(),e=v({showDeliveredDetailID:0,showDeliveredDetail:!1,showDialog:!1,confirmList:c([]),dialogMaxQty:0,packageRow:c(),dialogForm:{id:0},searchForm:{dispatch_no:"",customer_name:"",spu_name:""},timer:c(null),activeTab:null,tableData:c([]),tablePage:c({total:0,pageIndex:1,pageSize:q,searchObjects:[]}),btnList:[],authorityList:z()}),i=v({closeDeliveredDetail:()=>{e.showDeliveredDetail=!1},viewRow:t=>{e.showDeliveredDetailID=t.id,e.showDeliveredDetail=!0},dialogClose:()=>{e.showDialog=!1},dialogSubmit:async t=>{const l=t.map(s=>({id:s.id,dispatch_no:s.dispatch_no,dispatch_status:s.dispatch_status,package_qty:s.qty,picked_qty:s.picked_qty})),{data:r}=await L(l);if(!r.isSuccess){h.$message({type:"error",content:r.errorMessage});return}h.$message({type:"success",content:r.data}),i.dialogClose(),i.refresh()},handlePackage:async()=>{const l=_.value.getCheckboxRecords(),r=[];if(l.length>0){for(const s of l)r.push({id:s.id,spu_name:s.spu_name,spu_code:s.spu_code,sku_code:s.sku_code,maxQty:s.unpackage_qty,qty:s.unpackage_qty,dispatch_no:s.dispatch_no,dispatch_status:s.dispatch_status,picked_qty:s.picked_qty});e.confirmList=r,e.showDialog=!0}else h.$message({type:"error",content:`${p.global.t("base.userManagement.checkboxIsNull")}`})},refresh:()=>{i.getToBePackaged()},getToBePackaged:async()=>{const{data:t}=await F(e.tablePage);if(!t.isSuccess){h.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},handlePageChange:c(({currentPage:t,pageSize:l})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=l,i.getToBePackaged()}),exportTable:()=>{const t=_.value;G({table:t,filename:p.global.t("wms.deliveryManagement.toBePackaged"),columnFilterMethod({column:l}){return!["checkbox"].includes(l==null?void 0:l.type)&&!["operate"].includes(l==null?void 0:l.field)}})},sureSearch:()=>{e.tablePage.searchObjects=A(e.searchForm),i.getToBePackaged()}});j(()=>{e.btnList=[{name:p.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:i.refresh},{name:p.global.t("system.page.export"),icon:"mdi-export-variant",code:"packaged-export",click:i.exportTable},{name:p.global.t("wms.deliveryManagement.package"),icon:"mdi-package-down",code:"packaged-package",click:i.handlePackage}]});const $=w(()=>T({})),D=w(()=>C({}));return H(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,i.sureSearch()},B)},{deep:!0}),k({getToBePackaged:i.getToBePackaged}),(t,l)=>{const r=g("v-col"),s=g("v-text-field"),y=g("v-row"),o=g("vxe-column"),P=g("vxe-table");return R(),K(Z,null,[u("div",J,[a(y,{"no-gutters":""},{default:d(()=>[a(r,{cols:"3",class:"col"},{default:d(()=>[a(O,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(r,{cols:"9"},{default:d(()=>[a(y,{"no-gutters":"",onKeyup:M(i.sureSearch,["enter"])},{default:d(()=>[a(r,{cols:"4"},{default:d(()=>[a(s,{modelValue:e.searchForm.dispatch_no,"onUpdate:modelValue":l[0]||(l[0]=n=>e.searchForm.dispatch_no=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.dispatch_no"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(r,{cols:"4"},{default:d(()=>[a(s,{modelValue:e.searchForm.customer_name,"onUpdate:modelValue":l[1]||(l[1]=n=>e.searchForm.customer_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(r,{cols:"4"},{default:d(()=>[a(s,{modelValue:e.searchForm.spu_name,"onUpdate:modelValue":l[2]||(l[2]=n=>e.searchForm.spu_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.spu_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),u("div",{class:"mt-5",style:W({height:m($)})},[a(P,{ref_key:"xTable",ref:_,"column-config":{minWidth:"100px"},data:e.tableData,height:m(D),align:"center"},{empty:d(()=>[Q(f(m(p).global.t("system.page.noData")),1)]),default:d(()=>[a(o,{type:"seq",width:"60"}),a(o,{type:"checkbox",width:"50"}),a(o,{field:"dispatch_no",title:t.$t("wms.deliveryManagement.dispatch_no")},null,8,["title"]),a(o,{field:"spu_code",title:t.$t("wms.deliveryManagement.spu_code")},null,8,["title"]),a(o,{field:"spu_description",width:"200px",title:t.$t("wms.deliveryManagement.spu_description")},null,8,["title"]),a(o,{field:"spu_name",title:t.$t("wms.deliveryManagement.spu_name")},null,8,["title"]),a(o,{field:"sku_code",title:t.$t("wms.deliveryManagement.sku_code")},null,8,["title"]),a(o,{field:"bar_code",title:t.$t("wms.deliveryManagement.bar_code")},null,8,["title"]),a(o,{field:"qty",title:t.$t("wms.deliveryManagement.order_qty")},null,8,["title"]),a(o,{field:"unpackage_qty",title:t.$t("wms.deliveryManagement.unpackage_qty")},null,8,["title"]),a(o,{field:"package_qty",title:t.$t("wms.deliveryManagement.package_qty")},null,8,["title"]),a(o,{field:"weight",title:t.$t("wms.deliveryManagement.detailWeight")},{default:d(({row:n})=>[u("span",null,f(`${n.weight} ${m(b)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),a(o,{field:"volume",title:t.$t("wms.deliveryManagement.detailVolume")},{default:d(({row:n})=>[u("span",null,f(`${n.volume} ${m(b)("volume",n.volume_unit)}`),1)]),_:1},8,["title"]),a(o,{field:"customer_name",title:t.$t("wms.deliveryManagement.customer_name")},null,8,["title"]),a(o,{field:"creator",title:t.$t("wms.deliveryManagement.creator")},null,8,["title"]),a(o,{field:"create_time",width:"170px",title:t.$t("wms.deliveryManagement.create_time")},null,8,["title"]),a(o,{field:"operate",title:t.$t("system.page.operate"),width:"140",resizable:!1,"show-overflow":""},{default:d(({row:n})=>[u("div",X,[a(V,{flat:!0,icon:"mdi-eye-outline","tooltip-text":t.$t("system.page.view"),onClick:ae=>i.viewRow(n)},null,8,["tooltip-text","onClick"])])]),_:1},8,["title"])]),_:1},8,["data","height"]),a(S,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":m(x),layouts:m(I),onPageChange:i.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"]),a(U,{id:e.showDeliveredDetailID,"show-dialog":e.showDeliveredDetail,onClose:i.closeDeliveredDetail},null,8,["id","show-dialog","onClose"]),a(E,{"dialog-title":t.$t("wms.deliveryManagement.package"),"show-dialog":e.showDialog,"is-weight":!1,"data-list":e.confirmList,onClose:i.dialogClose,onSubmit:i.dialogSubmit},null,8,["dialog-title","show-dialog","data-list","onClose","onSubmit"])],4)],64)}}});const $e=Y(ee,[["__scopeId","data-v-f86d312a"]]);export{$e as default};
