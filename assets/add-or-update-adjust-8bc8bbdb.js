import{i as a}from"./i18n-0af8b262.js";import{a as w}from"./index-cd6d6b34.js";import{h as p}from"./request-e1053d5a.js";import{A as b}from"./WarehouseAdjust-937657c2.js";import{r as W}from"./common-938b41ea.js";import{c as q}from"./commodity-select-5da8c47a.js";import{I as S}from"./formRule-3feb276f.js";import{d as J,b as k,c as f,r as C,w as B,a as u,x as F,m as E,q as s,s as d,ap as g,y as $,at as V,ac as N,O as P}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";const ae=m=>p({url:"/stockadjust/list",method:"post",data:m}),se=m=>p({url:"/stockadjust",method:"get",params:{id:m}}),Z=m=>p({url:"/stockadjust",method:"post",data:m}),le=m=>p({url:"/stockadjust",method:"delete",params:{id:m}}),me=m=>p({url:"/stockadjust/confirm",method:"put",params:{id:m}}),z=J({__name:"add-or-update-adjust",props:{showDialog:{type:Boolean},form:null,associatedJobType:null},emits:["close","saveSuccess"],setup(m,{emit:h}){const n=m,v=k(),T=f(()=>n.form.id&&n.form.id>0),A=f(()=>!!T.value),_=f(()=>n.showDialog),y=f(()=>!!(n.associatedJobType&&n.associatedJobType>0)),o=C({showCommodityDialogSelect:!1,showLocationDialogSelect:!1,form:k({id:0,job_code:"",sku_id:0,goods_owner_id:0,goods_location_id:0,qty:0,is_update_stock:!1,source_table_id:0,spu_code:"",spu_name:"",sku_code:"",warehouse_name:"",location_name:"",creator:"",create_time:""}),rules:{job_type:[],qty:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("wms.warehouseWorking.warehouseAdjust.qty")}!`,e=>S(e,"greaterThanZero")===""||S(e,"greaterThanZero")],warehouse_name:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("wms.warehouseWorking.warehouseAdjust.warehouse")}!`],location_name:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("wms.warehouseWorking.warehouseAdjust.location_name")}!`],spu_code:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("base.commodityManagement.spu_code")}!`],spu_name:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("base.commodityManagement.spu_name")}!`],sku_code:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("base.commodityManagement.sku_code")}!`],sku_name:[e=>!!e||`${a.global.t("system.checkText.mustInput")}${a.global.t("base.commodityManagement.sku_name")}!`]},combobox:k({job_type:[{label:a.global.t("wms.warehouseWorking.warehouseAdjust.warehouseTake"),value:b.TAKE},{label:a.global.t("wms.warehouseWorking.warehouseAdjust.processCombine"),value:b.PROCESS_COMBINE},{label:a.global.t("wms.warehouseWorking.warehouseAdjust.processSplit"),value:b.PROCESS_SPLIT},{label:a.global.t("wms.warehouseWorking.warehouseAdjust.warehouseMove"),value:b.MOVE}]})}),r=C({closeDialog:()=>{h("close")},initForm:()=>{o.form=n.form,y.value&&(o.form.job_type=n.associatedJobType)},changeJobType:e=>{const t=o.combobox.job_type.find(i=>i.value===e);t&&(o.form.job_type=t.value)},openCommoditySelect:()=>{setTimeout(()=>{o.showCommodityDialogSelect=!0},100)},closeCommodityDialogSelect:()=>{o.showCommodityDialogSelect=!1},sureSelectCommodity:e=>{try{o.form.sku_id=e[0].sku_id,o.form.goods_owner_id=e[0].goods_owner_id,o.form.goods_location_id=e[0].goods_location_id,o.form.warehouse_name=e[0].warehouse,o.form.location_name=e[0].location_name,o.form.spu_code=e[0].spu_code,o.form.spu_name=e[0].spu_name,o.form.sku_code=e[0].sku_code}catch{}},clearCommodity:()=>{o.form.sku_id=0,o.form.goods_location_id=0,o.form.warehouse_name="",o.form.location_name="",o.form.spu_code="",o.form.spu_name="",o.form.sku_code=""},submit:async()=>{const{valid:e}=await v.value.validate(),t=r.constructFormBody();if(e){const{data:i}=await Z(t);if(!i.isSuccess){w.$message({type:"error",content:i.errorMessage});return}w.$message({type:"success",content:`${a.global.t("system.page.submit")}${a.global.t("system.tips.success")}`}),h("saveSuccess")}else w.$message({type:"error",content:a.global.t("system.checkText.checkFormFail")})},constructFormBody:()=>{let e={...o.form};return e=W(e),e}});return B(()=>_.value,e=>{e&&r.initForm()}),(e,t)=>{const i=u("v-toolbar"),x=u("v-select"),c=u("v-text-field"),D=u("v-form"),I=u("v-card-text"),j=u("v-btn"),U=u("v-card-actions"),M=u("v-card"),O=u("v-dialog");return F(),E(P,null,[s(O,{modelValue:g(_),"onUpdate:modelValue":t[7]||(t[7]=l=>N(_)?_.value=l:null),width:"30%",transition:"dialog-top-transition",persistent:!0},{default:d(()=>[s(M,null,{default:d(()=>[s(i,{class:"",color:"white",title:`${e.$t("router.sideBar.warehouseAdjust")}`},null,8,["title"]),s(I,null,{default:d(()=>[s(D,{ref_key:"formRef",ref:v},{default:d(()=>[s(x,{modelValue:o.form.job_type,"onUpdate:modelValue":[t[0]||(t[0]=l=>o.form.job_type=l),r.changeJobType],items:o.combobox.job_type,"item-title":"label","item-value":"value",rules:o.rules.job_type,label:e.$t("wms.warehouseWorking.warehouseAdjust.job_type"),variant:"outlined",clearable:"",disabled:g(y)},null,8,["modelValue","items","rules","label","disabled","onUpdate:modelValue"]),s(c,{modelValue:o.form.spu_code,"onUpdate:modelValue":t[1]||(t[1]=l=>o.form.spu_code=l),label:e.$t("base.commodityManagement.spu_code"),rules:o.rules.spu_code,variant:"outlined",readonly:"",clearable:"",disabled:g(y),onClick:r.openCommoditySelect,"onClick:clear":r.clearCommodity},null,8,["modelValue","label","rules","disabled","onClick","onClick:clear"]),s(c,{modelValue:o.form.spu_name,"onUpdate:modelValue":t[2]||(t[2]=l=>o.form.spu_name=l),label:e.$t("base.commodityManagement.spu_name"),rules:o.rules.spu_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),s(c,{modelValue:o.form.sku_code,"onUpdate:modelValue":t[3]||(t[3]=l=>o.form.sku_code=l),label:e.$t("base.commodityManagement.sku_code"),rules:o.rules.sku_code,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),s(c,{modelValue:o.form.warehouse_name,"onUpdate:modelValue":t[4]||(t[4]=l=>o.form.warehouse_name=l),label:e.$t("wms.warehouseWorking.warehouseAdjust.warehouse"),rules:o.rules.warehouse_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),s(c,{modelValue:o.form.location_name,"onUpdate:modelValue":t[5]||(t[5]=l=>o.form.location_name=l),label:e.$t("wms.warehouseWorking.warehouseAdjust.location_name"),rules:o.rules.location_name,variant:"outlined",disabled:""},null,8,["modelValue","label","rules"]),s(c,{modelValue:o.form.qty,"onUpdate:modelValue":t[6]||(t[6]=l=>o.form.qty=l),label:e.$t("wms.warehouseWorking.warehouseAdjust.qty"),rules:o.rules.qty,variant:"outlined"},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1}),s(U,{class:"justify-end"},{default:d(()=>[s(j,{variant:"text",onClick:r.closeDialog},{default:d(()=>[$(V(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),s(j,{color:"primary",variant:"text",disabled:g(A),onClick:r.submit},{default:d(()=>[$(V(e.$t("system.page.submit")),1)]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(q,{"show-dialog":o.showCommodityDialogSelect,onClose:r.closeCommodityDialogSelect,onSureSelect:r.sureSelectCommodity},null,8,["show-dialog","onClose","onSureSelect"])],64)}}});const K=L(z,[["__scopeId","data-v-b57cb552"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{se as a,K as b,me as c,le as d,re as e,ae as g};
