import{i as r,w as C}from"./i18n-0af8b262.js";import{a as I,b as k,e as L}from"./style-b9bc59b4.js";import{_ as y}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{b as F,d as T,r as U}from"./userManagement-c79709d8.js";import{a as c}from"./index-cd6d6b34.js";import V from"./add-or-update-user-e80914ff.js";import{D as E,a as z,c as N,P as O,b as R}from"./system-93ae242b.js";import{g as A,s as B}from"./common-938b41ea.js";import G from"./import-table-bd8870d4.js";import{e as H}from"./exportTable-b0d17537.js";import{B as K}from"./btnGroup-26ff2079.js";import{d as j,b as v,r as w,o as q,c as $,w as J,a as d,x as Z,m as Y,u as p,q as a,s as l,as as Q,ap as u,y as W,at as h}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./formRule-3feb276f.js";import"./index-ae8f073f.js";import"./formatSystem-1203ad16.js";const ee={class:"container"},te={class:"operateArea"},ae=j({__name:"userManagement",setup(se){const b=v(),e=w({showDialogImport:!1,searchForm:{user_num:"",user_name:"",user_role:""},timer:null,tableData:[],tablePage:{total:0,pageIndex:1,pageSize:E},showDialog:!1,dialogForm:{id:0,user_num:"",user_name:"",contact_tel:"",auth_string:"",is_valid:!0},btnList:[],authorityList:A()}),s=w({openDialogImport:()=>{e.showDialogImport=!0},closeDialogImport:()=>{e.showDialogImport=!1},saveSuccessImport:()=>{s.refresh(),s.closeDialogImport()},sureSearch:()=>{e.tablePage.searchObjects=B(e.searchForm),s.getUserList()},getUserList:async()=>{const{data:t}=await F(e.tablePage);if(!t.isSuccess){c.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},add:()=>{e.dialogForm={id:0,user_num:"",user_name:"",contact_tel:"",auth_string:"",is_valid:!0},e.showDialog=!0},closeDialog:()=>{e.showDialog=!1},saveSuccess:()=>{s.refresh(),s.closeDialog()},refresh:()=>{s.getUserList()},editRow(t){e.dialogForm=JSON.parse(JSON.stringify(t)),e.showDialog=!0},deleteRow(t){c.$dialog({content:r.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.id){const{data:o}=await T(t.id);if(!o.isSuccess){c.$message({type:"error",content:o.errorMessage});return}c.$message({type:"success",content:`${r.global.t("system.page.delete")}${r.global.t("system.tips.success")}`}),s.refresh()}}})},handlePageChange:v(({currentPage:t,pageSize:o})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=o,s.refresh()}),exportTable:()=>{const t=b.value;H({table:t,filename:r.global.t("router.sideBar.userManagement"),columnFilterMethod({column:o}){return!["checkbox"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},restPwd:async()=>{const t=b.value.getCheckboxRecords(!0);t.length>0?c.$dialog({content:r.global.t("base.userManagement.beforeResetPwd"),handleConfirm:async()=>{const o=t.map(g=>g.id),{data:n}=await U(o);if(!n.isSuccess){c.$message({type:"error",content:n.errorMessage});return}c.$dialog({content:`${r.global.t("base.userManagement.afterResetPwd")} ${n.data}`})}}):c.$message({type:"error",content:r.global.t("base.userManagement.checkboxIsNull")})}});q(async()=>{await s.getUserList(),e.btnList=[{name:r.global.t("system.page.add"),icon:"mdi-plus",code:"save",click:s.add},{name:r.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:s.refresh},{name:r.global.t("system.page.import"),icon:"mdi-database-import-outline",code:"import",click:s.openDialogImport},{name:r.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:s.exportTable},{name:r.global.t("base.userManagement.restPwd"),icon:"mdi-lock-reset",code:"resetPwd",click:s.restPwd}]});const D=$(()=>I({hasTab:!1})),S=$(()=>k({hasTab:!1}));return J(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,s.sureSearch()},z)},{deep:!0}),(t,o)=>{const n=d("v-col"),g=d("v-text-field"),_=d("v-row"),m=d("vxe-column"),x=d("vxe-table"),M=d("v-card-text"),P=d("v-card");return Z(),Y("div",ee,[p("div",null,[a(P,{class:"mt-5"},{default:l(()=>[a(M,null,{default:l(()=>[p("div",te,[a(_,{"no-gutters":""},{default:l(()=>[a(n,{cols:"12",sm:"4",class:"col"},{default:l(()=>[a(K,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(n,{cols:"12",sm:"8"},{default:l(()=>[a(_,{"no-gutters":"",onKeyup:C(s.sureSearch,["enter"])},{default:l(()=>[a(n,{cols:"4"},{default:l(()=>[a(g,{modelValue:e.searchForm.user_num,"onUpdate:modelValue":o[0]||(o[0]=i=>e.searchForm.user_num=i),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("base.userManagement.user_num"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(n,{cols:"4"},{default:l(()=>[a(g,{modelValue:e.searchForm.user_name,"onUpdate:modelValue":o[1]||(o[1]=i=>e.searchForm.user_name=i),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("base.userManagement.user_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(n,{cols:"4"},{default:l(()=>[a(g,{modelValue:e.searchForm.user_role,"onUpdate:modelValue":o[2]||(o[2]=i=>e.searchForm.user_role=i),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("base.userManagement.user_role"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),p("div",{class:"mt-5",style:Q({height:u(D)})},[a(x,{ref_key:"xTable",ref:b,data:e.tableData,height:u(S),align:"center"},{empty:l(()=>[W(h(u(r).global.t("system.page.noData")),1)]),default:l(()=>[a(m,{type:"seq",width:"60"}),a(m,{type:"checkbox",width:"50"}),a(m,{field:"user_num",title:t.$t("base.userManagement.user_num")},null,8,["title"]),a(m,{field:"user_name",title:t.$t("base.userManagement.user_name")},null,8,["title"]),a(m,{field:"user_role",title:t.$t("base.userManagement.user_role")},null,8,["title"]),a(m,{field:"sex",title:t.$t("base.userManagement.sex")},{default:l(({row:i})=>[p("span",null,h(t.$t(`system.combobox.sex.${i.sex}`)),1)]),_:1},8,["title"]),a(m,{field:"contact_tel",title:t.$t("base.userManagement.contact_tel")},null,8,["title"]),a(m,{field:"is_valid",title:t.$t("base.userManagement.is_valid")},{default:l(({row:i,column:f})=>[p("span",null,h(i[f.property]?t.$t("system.combobox.yesOrNo.yes"):t.$t("system.combobox.yesOrNo.no")),1)]),_:1},8,["title"]),a(m,{field:"operate",title:t.$t("system.page.operate"),width:"160",resizable:!1,"show-overflow":""},{default:l(({row:i})=>[a(y,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":t.$t("system.page.edit"),disabled:!e.authorityList.includes("save"),onClick:f=>s.editRow(i)},null,8,["tooltip-text","disabled","onClick"]),a(y,{flat:!0,icon:"mdi-delete-outline","tooltip-text":t.$t("system.page.delete"),"icon-color":e.authorityList.includes("delete")?u(L):"",disabled:!e.authorityList.includes("delete"),onClick:f=>s.deleteRow(i)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),a(N,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":u(O),layouts:u(R),onPageChange:s.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1})]),a(V,{"show-dialog":e.showDialog,form:e.dialogForm,onClose:s.closeDialog,onSaveSuccess:s.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),a(G,{"show-dialog":e.showDialogImport,onClose:s.closeDialogImport,onSaveSuccess:s.saveSuccessImport},null,8,["show-dialog","onClose","onSaveSuccess"])])}}});const Se=X(ae,[["__scopeId","data-v-b5fc20e6"]]);export{Se as default};
