import{i as l,v as R}from"./i18n-0af8b262.js";import{r as I,u as J,e as O}from"./exportTable-b0d17537.js";import{e as q}from"./userManagement-c79709d8.js";import{a as h}from"./index-cd6d6b34.js";import{S as z,e as L}from"./style-b9bc59b4.js";import{_ as C}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{a as v}from"./formatSystem-1203ad16.js";import{d as j,b as $,c as A,r as E,w as H,a as m,x as G,v as U,s as n,q as a,u as F,t as W,ap as D,y as M,at as w,ac as Y}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";const K={class:"mb-4"},P=j({__name:"import-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(N,{emit:T}){const V=N,k=$(),u=$(),y=A(()=>V.showDialog),d=E({importData:$([]),validRules:$({})}),i=E({initForm:()=>{d.importData=[]},closeDialog:()=>{T("close")},submit:async()=>{if(!i.valid())return;const t=u.value,p=JSON.parse(JSON.stringify(t.getTableData().fullData));for(const r of p){let c="male";if(["男","女","Male","Female"].includes(r.sex))switch(r.sex){case"男":case"Male":c="male";break;case"女":case"Female":c="female";break}r.sex=c}const{data:o}=await q(p);if(!o.isSuccess){h.$message({type:"error",content:o.errorMessage});return}h.$message({type:"success",content:`${l.global.t("system.page.submit")}${l.global.t("system.tips.success")}`}),T("saveSuccess")},valid:()=>u.value.getTableData().fullData.length<=0?(h.$message({type:"error",content:`${l.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{k.value.value="",k.value.click()},readExcel:async e=>{const t=e.target.files;if(t.length<=0)return!1;const p=t[0],o=new FileReader;o.onload=r=>{var f;const c=(f=r==null?void 0:r.target)==null?void 0:f.result;if(c){const x=I(c,{type:"binary"}),S=x.SheetNames[0];let g=J.sheet_to_json(x.Sheets[S]),s=JSON.stringify(g);s=s.replace(/（/g,"("),s=s.replace(/）/g,")"),g=JSON.parse(s),d.importData=[],g.forEach((B,_,b)=>{d.importData.push({user_num:v(b[_][l.global.t("base.userManagement.user_num")]),user_name:v(b[_][l.global.t("base.userManagement.user_name")]),contact_tel:v(b[_][l.global.t("base.userManagement.contact_tel")]),user_role:v(b[_][l.global.t("base.userManagement.user_role")]),sex:v(b[_][l.global.t("base.userManagement.sex")]),is_valid:!0})})}},o.readAsBinaryString(p)},exportTemplate:()=>{const e=u.value;O({table:e,filename:l.global.t("router.sideBar.userManagement"),mode:"header",columnFilterMethod({column:t}){return!["checkbox","seq"].includes(t==null?void 0:t.type)&&!["operate"].includes(t==null?void 0:t.field)}})},deleteRow:e=>{h.$dialog({content:l.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&u.value.remove(e)}})}});return H(()=>y.value,e=>{e&&i.initForm()}),(e,t)=>{const p=m("v-toolbar"),o=m("vxe-column"),r=m("vxe-table"),c=m("v-card-text"),f=m("v-btn"),x=m("v-card-actions"),S=m("v-card"),g=m("v-dialog");return G(),U(g,{modelValue:D(y),"onUpdate:modelValue":t[1]||(t[1]=s=>Y(y)?y.value=s:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:n(()=>[a(S,null,{default:n(()=>[a(p,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),a(c,null,{default:n(()=>[F("div",K,[a(C,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:i.chooseFile},null,8,["tooltip-text","onClick"]),a(C,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:i.exportTemplate},null,8,["tooltip-text","onClick"]),W(F("input",{id:"open",ref_key:"uploadExcel",ref:k,type:"file",accept:".xls, .xlsx",onChange:t[0]||(t[0]=(...s)=>i.readExcel&&i.readExcel(...s))},null,544),[[R,!1]])]),a(r,{ref_key:"xTable",ref:u,"column-config":{minWidth:"100px"},data:d.importData,height:D(z).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":d.validRules,"export-config":{},align:"center"},{empty:n(()=>[M(w(D(l).global.t("system.page.noData")),1)]),default:n(()=>[a(o,{type:"seq",width:"60"}),a(o,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:n(({row:s})=>[a(C,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":D(L),onClick:B=>i.deleteRow(s)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),a(o,{field:"user_num",title:e.$t("base.userManagement.user_num")},null,8,["title"]),a(o,{field:"user_name",title:e.$t("base.userManagement.user_name")},null,8,["title"]),a(o,{field:"contact_tel",title:e.$t("base.userManagement.contact_tel")},null,8,["title"]),a(o,{field:"user_role",title:e.$t("base.userManagement.user_role")},null,8,["title"]),a(o,{field:"sex",title:e.$t("base.userManagement.sex")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),a(x,{class:"justify-end"},{default:n(()=>[a(f,{variant:"text",onClick:i.closeDialog},{default:n(()=>[M(w(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(f,{color:"primary",variant:"text",onClick:i.submit},{default:n(()=>[M(w(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const ue=Z(P,[["__scopeId","data-v-0da1f16e"]]);export{ue as default};
