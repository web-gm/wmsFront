import{i as l,w as x}from"./i18n-0af8b262.js";import{a as P,b as T}from"./style-b9bc59b4.js";import{D as M,a as F,c as R,P as E,b as z}from"./system-93ae242b.js";import{a as n}from"./index-cd6d6b34.js";import{g as O,s as q}from"./common-938b41ea.js";import{o as V,r as B,p as N,q as U,s as G,g as H}from"./stockAsn-18b92b84.js";import{_ as y}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import j from"./add-sorting-46ebf253.js";import J from"./sku-info-138df2f3.js";import{e as K}from"./exportTable-b0d17537.js";import{B as Z}from"./btnGroup-26ff2079.js";import{_ as W}from"./update-sorting.vue_vue_type_script_setup_true_lang-dae28dec.js";import{h}from"./httpCodeJudge-e416f8ca.js";import{d as Y,b as m,r as k,o as Q,c as v,w as X,a as u,x as ee,m as te,u as S,q as t,s as d,y as se,at as I,ap as g,aq as oe,as as ae,O as le}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./index-ae8f073f.js";import"./vue-router-1283ad2d.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./formRule-3feb276f.js";import"./tableRule-6aa0c57f.js";const re={class:"operateArea"},ie=["onClick"],ce=Y({__name:"tabToDoSorting",setup(de,{expose:A}){const b=m(),p=m(),f=m(),s=k({showDialogShowInfo:!1,searchForm:{supplier_name:"",sku_name:""},activeTab:null,dialogForm:m({id:0,asn_no:"",asn_batch:"",estimated_arrival_time:"",detailList:[]}),tableData:m([]),tablePage:k({total:0,sqlTitle:"asn_status:2",pageIndex:1,pageSize:M,searchObjects:m([])}),timer:m(null),btnList:[],authorityList:O()}),a=k({updateSortingSure:async e=>{const{data:o}=await V(e);if(!o.isSuccess){if(h(o.errorMessage)){a.refresh(),f.value.closeDialog();return}n.$message({type:"error",content:o.errorMessage});return}n.$message({type:"success",content:`${l.global.t("system.page.submit")}${l.global.t("system.tips.success")}`}),f.value.closeDialog(),a.refresh()},handleRevoke:()=>{const e=b.value.getCheckboxRecords();if(e.length>0){const o=e.map(i=>i.id);n.$dialog({content:l.global.t("system.tips.beforeOperation"),handleConfirm:async()=>{const{data:i}=await B(o);if(!i.isSuccess){if(h(i.errorMessage)){a.refresh();return}n.$message({type:"error",content:i.errorMessage});return}n.$message({type:"success",content:`${l.global.t("system.page.revoke")}${l.global.t("system.tips.success")}`}),a.refresh()}})}else n.$message({type:"error",content:l.global.t("wms.stockAsnInfo.selectOne")})},addSortingSure:async e=>{const{data:o}=await N(e);if(!o.isSuccess){if(h(o.errorMessage)){a.refresh(),p.value.closeDialog();return}n.$message({type:"error",content:o.errorMessage});return}n.$message({type:"success",content:`${l.global.t("system.page.submit")}${l.global.t("system.tips.success")}`}),p.value.closeDialog(),a.refresh()},closeDialogShowInfo:()=>{s.showDialogShowInfo=!1},showSkuInfo(e){s.dialogForm=JSON.parse(JSON.stringify(e)),s.showDialogShowInfo=!0},addSorting:e=>{p.value.openDialog(e.id)},editRowEdit(e){f.value.openDialog(e.id)},editRow(e){n.$dialog({content:l.global.t("system.tips.beforeAsnSorted"),handleConfirm:async()=>{if(e.id){const{data:o}=await U(e.id);if(!o.isSuccess){if(h(o.errorMessage)){a.refresh();return}n.$message({type:"error",content:o.errorMessage});return}n.$message({type:"success",content:`${l.global.t("system.page.confirm")}${l.global.t("system.tips.success")}`}),a.refresh()}}})},deleteRow(e){n.$dialog({content:l.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:o}=await G(e.id);if(!o.isSuccess){n.$message({type:"error",content:o.errorMessage});return}n.$message({type:"success",content:`${l.global.t("system.page.delete")}${l.global.t("system.tips.success")}`}),a.refresh()}}})},refresh:()=>{a.getStockAsnList()},getStockAsnList:async()=>{const{data:e}=await H(s.tablePage);if(!e.isSuccess){n.$message({type:"error",content:e.errorMessage});return}s.tableData=e.data.rows,s.tablePage.total=e.data.totals},handlePageChange:m(({currentPage:e,pageSize:o})=>{s.tablePage.pageIndex=e,s.tablePage.pageSize=o,a.getStockAsnList()}),exportTable:()=>{const e=b.value;K({table:e,filename:l.global.t("wms.stockAsn.tabToDoSorting"),columnFilterMethod({column:o}){return!["checkbox"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},sureSearch:()=>{s.tablePage.searchObjects=q(s.searchForm),a.getStockAsnList()}});Q(()=>{s.btnList=[{name:l.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:a.refresh},{name:l.global.t("system.page.export"),icon:"mdi-export-variant",code:"sorted-export",click:a.exportTable},{name:l.global.t("wms.stockAsnInfo.revoke"),icon:"mdi-arrow-left-top",code:"sorted-delete",click:a.handleRevoke}]});const C=v(()=>P({})),D=v(()=>T({}));return A({getStockAsnList:a.getStockAsnList}),X(()=>s.searchForm,()=>{s.timer&&clearTimeout(s.timer),s.timer=setTimeout(()=>{s.timer=null,a.sureSearch()},F)},{deep:!0}),(e,o)=>{const i=u("v-col"),w=u("v-text-field"),$=u("v-row"),r=u("vxe-column"),L=u("vxe-table");return ee(),te(le,null,[S("div",re,[t($,{"no-gutters":""},{default:d(()=>[t(i,{cols:"3",class:"col"},{default:d(()=>[t(Z,{"authority-list":s.authorityList,"btn-list":s.btnList},null,8,["authority-list","btn-list"])]),_:1}),t(i,{cols:"9"},{default:d(()=>[t($,{"no-gutters":"",onKeyup:x(a.sureSearch,["enter"])},{default:d(()=>[t(i,{cols:"4"}),t(i,{cols:"4"},{default:d(()=>[t(w,{modelValue:s.searchForm.supplier_name,"onUpdate:modelValue":o[0]||(o[0]=c=>s.searchForm.supplier_name=c),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.supplier_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),t(i,{cols:"4"},{default:d(()=>[t(w,{modelValue:s.searchForm.sku_name,"onUpdate:modelValue":o[1]||(o[1]=c=>s.searchForm.sku_name=c),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.stockAsnInfo.sku_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),S("div",{class:"mt-5",style:ae({height:g(C)})},[t(L,{ref_key:"xTableStockLocation",ref:b,"column-config":{minWidth:"100px"},data:s.tableData,height:g(D),align:"center"},{empty:d(()=>[se(I(g(l).global.t("system.page.noData")),1)]),default:d(()=>[t(r,{type:"seq",width:"60"}),t(r,{type:"checkbox",width:"50"}),t(r,{field:"asn_no",title:e.$t("wms.stockAsnInfo.asn_no")},null,8,["title"]),t(r,{field:"spu_code",title:e.$t("wms.stockAsnInfo.spu_code")},null,8,["title"]),t(r,{field:"spu_name",title:e.$t("wms.stockAsnInfo.spu_name")},null,8,["title"]),t(r,{field:"sku_code",title:e.$t("wms.stockAsnInfo.sku_code")},{default:d(({row:c})=>[S("div",{class:oe("text-decoration-none"),onClick:_=>a.showSkuInfo(c)},I(c.sku_code),9,ie)]),_:1},8,["title"]),t(r,{field:"sku_name",title:e.$t("wms.stockAsnInfo.sku_name")},null,8,["title"]),t(r,{field:"goods_owner_name",title:e.$t("wms.stockAsnInfo.goods_owner_name")},null,8,["title"]),t(r,{field:"supplier_name",title:e.$t("wms.stockAsnInfo.supplier_name")},null,8,["title"]),t(r,{field:"asn_qty",title:e.$t("wms.stockAsnInfo.asn_qty")},null,8,["title"]),t(r,{field:"weight",title:e.$t("wms.stockAsnInfo.weight")},null,8,["title"]),t(r,{field:"volume",title:e.$t("wms.stockAsnInfo.volume")},null,8,["title"]),t(r,{field:"sorted_qty",title:e.$t("wms.stockAsnInfo.sorted_qty")},null,8,["title"]),t(r,{field:"operate",title:e.$t("system.page.operate"),width:"180",resizable:!1,"show-overflow":""},{default:d(({row:c})=>[t(y,{flat:!0,icon:"mdi-plus","tooltip-text":e.$t("wms.stockAsnInfo.addSorting"),disabled:!s.authorityList.includes("sorted-editCount"),onClick:_=>a.addSorting(c)},null,8,["tooltip-text","disabled","onClick"]),t(y,{flat:!0,icon:"mdi-pencil-outline","tooltip-text":e.$t("wms.stockAsnInfo.editSorting"),disabled:!s.authorityList.includes("sorted-editCount"),onClick:_=>a.editRowEdit(c)},null,8,["tooltip-text","disabled","onClick"]),t(y,{flat:!0,icon:"mdi-check","tooltip-text":e.$t("system.page.confirm"),disabled:!s.authorityList.includes("sorted-confirm"),onClick:_=>a.editRow(c)},null,8,["tooltip-text","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),t(R,{"current-page":s.tablePage.pageIndex,"page-size":s.tablePage.pageSize,perfect:"",total:s.tablePage.total,"page-sizes":g(E),layouts:g(z),onPageChange:a.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4),t(j,{ref_key:"addSortingRef",ref:p,onSure:a.addSortingSure},null,8,["onSure"]),t(W,{ref_key:"updateSortingDialogRef",ref:f,onSure:a.updateSortingSure},null,8,["onSure"]),t(J,{"show-dialog":s.showDialogShowInfo,form:s.dialogForm,onClose:a.closeDialogShowInfo},null,8,["show-dialog","form","onClose"])],64)}}});const Me=ne(ce,[["__scopeId","data-v-acc9055c"]]);export{Me as default};
