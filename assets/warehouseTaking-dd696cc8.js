import{i as n,w as A}from"./i18n-0af8b262.js";import{a as N,b as W,e as L}from"./style-b9bc59b4.js";import{D as M,a as F,c as q,P as O,b as B}from"./system-93ae242b.js";import{a as u}from"./index-cd6d6b34.js";import{T as _,c as E}from"./warehouseWorking-497fd91f.js";import{g as H,b as z,d as V,e as U}from"./warehouseTaking-2c283aca.js";import{g as G,s as K}from"./common-938b41ea.js";import{d as R}from"./formatWarehouseWorking-dc5b5102.js";import{_ as h}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import J from"./add-or-update-taking-d3fe3edc.js";import Z from"./number-input-9854d08d.js";import{e as Y}from"./exportTable-b0d17537.js";import{B as Q}from"./btnGroup-26ff2079.js";import{d as X,b as m,r as w,n as b,k as ee,o as te,c as v,w as oe,a as d,x as ae,m as se,u as f,q as o,s as l,as as ie,ap as c,y as re,at as T}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";import"./WarehouseMove-eb0037f6.js";import"./WarehouseAdjust-937657c2.js";import"./commodity-select-5da8c47a.js";import"./stockManagement-a6372198.js";import"./location-select-a2f98b65.js";import"./warehouseSetting-835f9e1c.js";import"./formatSystem-1203ad16.js";import"./formatWarehouse-aebb7b18.js";import"./Warehouse-56a6b193.js";import"./sku-select-e1d3e93a.js";import"./custom-qrcode-7ab7b0a5.js";import"./formRule-3feb276f.js";const ne={class:"container"},de={class:"operateArea"},ue=X({__name:"warehouseTaking",setup(ce){const k=m(),t=w({showDialog:!1,showDialogNumberInput:!1,timer:m(null),activeTab:null,tableData:m([]),dialogForm:m({id:0,job_code:"",job_status:_,sku_id:0,goods_owner_id:0,goods_location_id:0,book_qty:0,counted_qty:0,difference_qty:0,spu_code:"",spu_name:"",sku_code:"",series_number:"",warehouse_name:"",location_name:"",handler:"",handle_time:"",adjust_status:!1,creator:"",create_time:""}),searchForm:{job_code:""},tablePage:w({total:0,pageIndex:1,pageSize:M,searchObjects:m([])}),btnList:[],authorityList:G()}),a=w({add:()=>{t.dialogForm={id:0,job_code:"",job_status:_,sku_id:0,goods_owner_id:0,goods_location_id:0,book_qty:0,counted_qty:0,difference_qty:0,spu_code:"",spu_name:"",sku_code:"",series_number:"",warehouse_name:"",location_name:"",handler:"",handle_time:"",adjust_status:!1,creator:"",create_time:""},b(()=>{t.showDialog=!0})},saveSuccess:()=>{a.refresh(),a.closeDialog()},saveSuccessNumberInput:()=>{a.refresh(),a.closeDialogNumberInput()},refresh:()=>{a.getStockProcessList()},closeDialog:()=>{t.showDialog=!1},closeDialogNumberInput:()=>{t.showDialogNumberInput=!1},getStockProcessList:async()=>{const{data:e}=await H(t.tablePage);if(!e.isSuccess){u.$message({type:"error",content:e.errorMessage});return}t.tableData=e.data.rows,t.tablePage.total=e.data.totals},viewRow:async e=>{await a.getOne(e.id),b(()=>{t.showDialog=!0})},getOne:async e=>{const{data:s}=await z(e);if(!s.isSuccess){u.$message({type:"error",content:s.errorMessage});return}t.dialogForm=s.data},deleteRow(e){u.$dialog({content:n.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(e.id){const{data:s}=await V(e.id);if(!s.isSuccess){u.$message({type:"error",content:s.errorMessage});return}u.$message({type:"success",content:`${n.global.t("system.page.delete")}${n.global.t("system.tips.success")}`}),a.refresh()}}})},handlePageChange:m(({currentPage:e,pageSize:s})=>{t.tablePage.pageIndex=e,t.tablePage.pageSize=s,a.refresh()}),exportTable:()=>{const e=k.value;Y({table:e,filename:n.global.t("router.sideBar.warehouseTaking"),columnFilterMethod({column:s}){return!["checkbox"].includes(s==null?void 0:s.type)&&!["operate"].includes(s==null?void 0:s.field)}})},sureSearch:()=>{t.tablePage.searchObjects=K(t.searchForm),a.refresh()},confirmAdjustBtnDisabled:e=>e.job_status===E||!!e.adjust_status,isConfirmTaking:e=>e.job_status===_,confirmTaking:async e=>{t.dialogForm=e,b(()=>{t.showDialogNumberInput=!0})},confirmAdjust:async e=>{u.$dialog({content:n.global.t("wms.warehouseWorking.warehouseTaking.beforeConfirmAdjust"),handleConfirm:async()=>{if(e.id){const{data:s}=await U(e.id);if(!s.isSuccess){u.$message({type:"error",content:s.errorMessage});return}u.$message({type:"success",content:`${n.global.t("wms.warehouseWorking.warehouseTaking.confirmAdjust")}${n.global.t("system.tips.success")}`}),a.refresh()}}})}});ee(()=>{a.refresh()}),te(()=>{t.btnList=[{name:n.global.t("system.page.add"),icon:"mdi-plus",code:"save",click:a.add},{name:n.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:a.refresh},{name:n.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:a.exportTable}]});const $=v(()=>N({hasTab:!1})),S=v(()=>W({hasTab:!1}));return oe(()=>t.searchForm,()=>{t.timer&&clearTimeout(t.timer),t.timer=setTimeout(()=>{t.timer=null,a.sureSearch()},F)},{deep:!0}),(e,s)=>{const g=d("v-col"),x=d("v-text-field"),y=d("v-row"),i=d("vxe-column"),C=d("vxe-table"),D=d("v-window-item"),j=d("v-window"),I=d("v-card-text"),P=d("v-card");return ae(),se("div",ne,[f("div",null,[o(P,{class:"mt-5"},{default:l(()=>[o(I,null,{default:l(()=>[o(j,{modelValue:t.activeTab,"onUpdate:modelValue":s[1]||(s[1]=r=>t.activeTab=r)},{default:l(()=>[o(D,null,{default:l(()=>[f("div",de,[o(y,{"no-gutters":""},{default:l(()=>[o(g,{cols:"3",class:"col"},{default:l(()=>[o(Q,{"authority-list":t.authorityList,"btn-list":t.btnList},null,8,["authority-list","btn-list"])]),_:1}),o(g,{cols:"9"},{default:l(()=>[o(y,{"no-gutters":"",onKeyup:A(a.sureSearch,["enter"])},{default:l(()=>[o(g,{cols:"4"}),o(g,{cols:"4"}),o(g,{cols:"4"},{default:l(()=>[o(x,{modelValue:t.searchForm.job_code,"onUpdate:modelValue":s[0]||(s[0]=r=>t.searchForm.job_code=r),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:e.$t("wms.warehouseWorking.warehouseTaking.job_code"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),f("div",{class:"mt-5",style:ie({height:c($)})},[o(C,{ref_key:"xTable",ref:k,"column-config":{minWidth:"100px"},data:t.tableData,height:c(S),align:"center"},{empty:l(()=>[re(T(c(n).global.t("system.page.noData")),1)]),default:l(()=>[o(i,{type:"seq",width:"60"}),o(i,{type:"checkbox",width:"50"}),o(i,{field:"job_code",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.job_code")},null,8,["title"]),o(i,{field:"job_status",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.job_status")},{default:l(({row:r,column:p})=>[f("span",null,T(c(R)(r[p.property])),1)]),_:1},8,["title"]),o(i,{field:"spu_code",width:"150px",title:e.$t("base.commodityManagement.spu_code")},null,8,["title"]),o(i,{field:"spu_name",width:"150px",title:e.$t("base.commodityManagement.spu_name")},null,8,["title"]),o(i,{field:"sku_code",width:"150px",title:e.$t("base.commodityManagement.sku_code")},null,8,["title"]),o(i,{field:"series_number",width:"150px",title:e.$t("wms.stockLocation.series_number")},null,8,["title"]),o(i,{field:"warehouse_name",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.warehouse")},null,8,["title"]),o(i,{field:"location_name",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.location_name")},null,8,["title"]),o(i,{field:"book_qty",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.book_qty")},null,8,["title"]),o(i,{field:"counted_qty",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.counted_qty")},null,8,["title"]),o(i,{field:"difference_qty",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.difference_qty")},null,8,["title"]),o(i,{field:"handler",width:"150px",title:e.$t("wms.warehouseWorking.warehouseTaking.handler")},null,8,["title"]),o(i,{field:"handle_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.warehouseWorking.warehouseTaking.handle_time")},null,8,["title"]),o(i,{field:"creator",title:e.$t("wms.warehouseWorking.warehouseTaking.creator")},null,8,["title"]),o(i,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:e.$t("wms.warehouseWorking.warehouseTaking.create_time")},null,8,["title"]),o(i,{field:"operate",title:e.$t("system.page.operate"),width:"250",resizable:!1,"show-overflow":""},{default:l(({row:r})=>[o(h,{flat:!0,icon:"mdi-eye-outline","tooltip-text":e.$t("system.page.view"),onClick:p=>a.viewRow(r)},null,8,["tooltip-text","onClick"]),o(h,{flat:!0,icon:"mdi-book-check-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseTaking.confirmTaking"),disabled:!t.authorityList.includes("confirmOpeartion")||a.isConfirmTaking(r),onClick:p=>a.confirmTaking(r)},null,8,["tooltip-text","disabled","onClick"]),o(h,{flat:!0,icon:"mdi-book-open-outline","tooltip-text":e.$t("wms.warehouseWorking.warehouseProcessing.confirmAdjust"),disabled:!t.authorityList.includes("confirmAdjust")||a.confirmAdjustBtnDisabled(r),onClick:p=>a.confirmAdjust(r)},null,8,["tooltip-text","disabled","onClick"]),o(h,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":!t.authorityList.includes("delete")||a.isConfirmTaking(r)?"":c(L),disabled:!t.authorityList.includes("delete")||a.isConfirmTaking(r),onClick:p=>a.deleteRow(r)},null,8,["tooltip-text","icon-color","disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["data","height"]),o(q,{"current-page":t.tablePage.pageIndex,"page-size":t.tablePage.pageSize,perfect:"",total:t.tablePage.total,"page-sizes":c(O),layouts:c(B),onPageChange:a.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(J,{"show-dialog":t.showDialog,form:t.dialogForm,onClose:a.closeDialog,onSaveSuccess:a.saveSuccess},null,8,["show-dialog","form","onClose","onSaveSuccess"]),o(Z,{"show-dialog":t.showDialogNumberInput,form:t.dialogForm,onClose:a.closeDialogNumberInput,onSaveSuccess:a.saveSuccessNumberInput},null,8,["show-dialog","form","onClose","onSaveSuccess"])])])}}});const Ve=le(ue,[["__scopeId","data-v-bf4f5337"]]);export{Ve as default};
