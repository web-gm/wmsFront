import{i as t,v as R}from"./i18n-0af8b262.js";import{r as N,u as I,e as q}from"./exportTable-b0d17537.js";import{e as z}from"./customer-7e6fccb3.js";import{a as h}from"./index-cd6d6b34.js";import{S as L,e as j}from"./style-b9bc59b4.js";import{_ as x}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{d as A,b as $,c as H,r as E,w as J,a as u,x as O,v as G,s as p,q as a,u as V,t as U,ap as D,y as S,at as T,ac as W}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e1053d5a.js";import"./index-f4e4efab.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";const Y={class:"mb-4"},Z=A({__name:"import-customer-table",props:{showDialog:{type:Boolean}},emits:["close","saveSuccess"],setup(w,{emit:M}){const B=w,k=$(),d=$(),_=H(()=>B.showDialog),n=E({importData:$([]),validRules:$({}),eMsg:""}),c=E({initForm:()=>{n.importData=[]},closeDialog:()=>{M("close")},submit:async()=>{if(!c.valid())return;const g=d.value.getTableData().fullData,{data:l}=await z(g);if(!l.isSuccess){if(n.eMsg="",l.data.length>0)for(const m of l.data)m.errorMsg&&(n.eMsg=n.eMsg?n.eMsg+","+m.errorMsg:m.errorMsg);h.$message({type:"error",content:n.eMsg});return}h.$message({type:"success",content:`${t.global.t("system.page.submit")}${t.global.t("system.tips.success")}`}),M("saveSuccess")},valid:()=>d.value.getTableData().fullData.length<=0?(h.$message({type:"error",content:`${t.global.t("system.tips.detailLengthIsZero")}`}),!1):!0,chooseFile:async()=>{k.value.value="",k.value.click()},readExcel:async e=>{const o=e.target.files;if(o.length<=0)return!1;const g=o[0],l=new FileReader;l.onload=m=>{var f;const v=(f=m==null?void 0:m.target)==null?void 0:f.result;if(v){const y=N(v,{type:"binary"}),C=y.SheetNames[0];let b=I.sheet_to_json(y.Sheets[C]),i=JSON.stringify(b);i=i.replace(/（/g,"("),i=i.replace(/）/g,")"),b=JSON.parse(i),n.importData=[],b.forEach((F,s,r)=>{n.importData.push({customer_name:r[s][t.global.t("base.customer.customer_name")]?r[s][t.global.t("base.customer.customer_name")]+"":"",city:r[s][t.global.t("base.customer.city")]?r[s][t.global.t("base.customer.city")]+"":"",address:r[s][t.global.t("base.customer.address")]?r[s][t.global.t("base.customer.address")]+"":"",manager:r[s][t.global.t("base.customer.manager")]?r[s][t.global.t("base.customer.manager")]+"":"",email:r[s][t.global.t("base.customer.email")]?r[s][t.global.t("base.customer.email")]+"":"",contact_tel:r[s][t.global.t("base.customer.contact_tel")]?r[s][t.global.t("base.customer.contact_tel")]+"":"",_XID:"",errorMsg:""})})}},l.readAsBinaryString(g)},exportTemplate:()=>{const e=d.value;q({table:e,filename:t.global.t("router.sideBar.customer"),mode:"header",columnFilterMethod({column:o}){return!["checkbox","seq"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},deleteRow:e=>{h.$dialog({content:t.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{e&&d.value.remove(e)}})}});return J(()=>_.value,e=>{e&&c.initForm()}),(e,o)=>{const g=u("v-toolbar"),l=u("vxe-column"),m=u("vxe-table"),v=u("v-card-text"),f=u("v-btn"),y=u("v-card-actions"),C=u("v-card"),b=u("v-dialog");return O(),G(b,{modelValue:D(_),"onUpdate:modelValue":o[1]||(o[1]=i=>W(_)?_.value=i:null),width:"70%",transition:"dialog-top-transition",persistent:!0},{default:p(()=>[a(C,null,{default:p(()=>[a(g,{color:"white",title:`${e.$t("system.page.import")}`},null,8,["title"]),a(v,null,{default:p(()=>[V("div",Y,[a(x,{icon:"mdi-plus","tooltip-text":e.$t("system.page.chooseFile"),size:"x-small",onClick:c.chooseFile},null,8,["tooltip-text","onClick"]),a(x,{icon:"mdi-export-variant","tooltip-text":e.$t("system.page.exportTemplate"),size:"x-small",onClick:c.exportTemplate},null,8,["tooltip-text","onClick"]),U(V("input",{id:"open",ref_key:"uploadExcel",ref:k,type:"file",accept:".xls, .xlsx",onChange:o[0]||(o[0]=(...i)=>c.readExcel&&c.readExcel(...i))},null,544),[[R,!1]])]),a(m,{ref_key:"xTable",ref:d,"column-config":{minWidth:"100px"},data:n.importData,height:D(L).SELECT_TABLE,"edit-config":{trigger:"click",mode:"cell"},"edit-rules":n.validRules,"export-config":{},align:"center"},{empty:p(()=>[S(T(D(t).global.t("system.page.noData")),1)]),default:p(()=>[a(l,{type:"seq",width:"60"}),a(l,{field:"operate",width:"60",title:e.$t("system.page.operate"),resizable:!1},{default:p(({row:i})=>[a(x,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":D(j),onClick:F=>c.deleteRow(i)},null,8,["tooltip-text","icon-color","onClick"])]),_:1},8,["title"]),a(l,{field:"customer_name",title:e.$t("base.customer.customer_name")},null,8,["title"]),a(l,{field:"city",title:e.$t("base.customer.city")},null,8,["title"]),a(l,{field:"address",title:e.$t("base.customer.address")},null,8,["title"]),a(l,{field:"manager",title:e.$t("base.customer.manager")},null,8,["title"]),a(l,{field:"email",title:e.$t("base.customer.email")},null,8,["title"]),a(l,{field:"contact_tel",title:e.$t("base.customer.contact_tel")},null,8,["title"])]),_:1},8,["data","height","edit-rules"])]),_:1}),a(y,{class:"justify-end"},{default:p(()=>[a(f,{variant:"text",onClick:c.closeDialog},{default:p(()=>[S(T(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),a(f,{color:"primary",variant:"text",onClick:c.submit},{default:p(()=>[S(T(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const ce=X(Z,[["__scopeId","data-v-30851959"]]);export{ce as default};
