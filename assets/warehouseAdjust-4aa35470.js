import{i as l,w as T}from"./i18n-0af8b262.js";import{a as C,b as M}from"./style-b9bc59b4.js";import{D as E,a as O,c as F,P as L,b as W}from"./system-93ae242b.js";import{a as d}from"./index-cd6d6b34.js";import{g as B,a as I,d as V,c as z,b as q}from"./add-or-update-adjust-8bc8bbdb.js";import{P as H}from"./warehouseWorking-497fd91f.js";import{g as U,s as N}from"./common-938b41ea.js";import{f as G}from"./formatWarehouseWorking-dc5b5102.js";import{e as K}from"./exportTable-b0d17537.js";import{B as R}from"./btnGroup-26ff2079.js";import{d as J,b as p,r as _,n as w,k as Z,o as Y,c as b,w as Q,a as n,x as X,m as ee,u as g,q as a,s as i,as as te,ap as c,y as ae,at as y}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./WarehouseAdjust-937657c2.js";import"./commodity-select-5da8c47a.js";import"./stockManagement-a6372198.js";import"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import"./formRule-3feb276f.js";import"./index-ae8f073f.js";import"./WarehouseMove-eb0037f6.js";const se={class:"container"},re={class:"operateArea"},ie=J({__name:"warehouseAdjust",setup(le){const h=p(),e=_({showDialog:!1,processType:H,timer:p(null),activeTab:null,searchForm:{job_code:""},tableData:p([]),dialogForm:{id:0,job_code:"",sku_id:0,goods_owner_id:0,goods_location_id:0,qty:0,is_update_stock:!1,source_table_id:0,spu_code:"",spu_name:"",sku_code:"",warehouse_name:"",location_name:""},tablePage:_({total:0,pageIndex:1,pageSize:E,searchObjects:p([])}),btnList:[],authorityList:U()}),s=_({add:()=>{e.dialogForm={id:0,job_code:"",sku_id:0,goods_owner_id:0,goods_location_id:0,qty:0,is_update_stock:!1,source_table_id:0,spu_code:"",spu_name:"",sku_code:"",warehouse_name:"",location_name:""},w(()=>{e.showDialog=!0})},saveSuccess:()=>{s.refresh(),s.closeDialog()},refresh:()=>{s.getStockProcessList()},closeDialog:()=>{e.showDialog=!1},getStockProcessList:async()=>{const{data:t}=await B(e.tablePage);if(!t.isSuccess){d.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},viewRow:async t=>{await s.getOne(t.id),w(()=>{e.showDialog=!0})},getOne:async t=>{const{data:o}=await I(t);if(!o.isSuccess){d.$message({type:"error",content:o.errorMessage});return}e.dialogForm=o.data},deleteRow(t){d.$dialog({content:l.global.t("system.tips.beforeDeleteMessage"),handleConfirm:async()=>{if(t.id){const{data:o}=await V(t.id);if(!o.isSuccess){d.$message({type:"error",content:o.errorMessage});return}d.$message({type:"success",content:`${l.global.t("system.page.delete")}${l.global.t("system.tips.success")}`}),s.refresh()}}})},handlePageChange:p(({currentPage:t,pageSize:o})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=o,s.refresh()}),exportTable:()=>{const t=h.value;K({table:t,filename:l.global.t("router.sideBar.warehouseAdjust"),columnFilterMethod({column:o}){return!["checkbox"].includes(o==null?void 0:o.type)&&!["operate"].includes(o==null?void 0:o.field)}})},sureSearch:()=>{e.tablePage.searchObjects=N(e.searchForm),s.refresh()},confirmAdjust:async t=>{d.$dialog({content:l.global.t("wms.warehouseWorking.warehouseAdjust.beforeConfirmAdjust"),handleConfirm:async()=>{if(t.id){const{data:o}=await z(t.id);if(!o.isSuccess){d.$message({type:"error",content:o.errorMessage});return}d.$message({type:"success",content:`${l.global.t("wms.warehouseWorking.warehouseAdjust.confirmAdjust")}${l.global.t("system.tips.success")}`}),s.refresh()}}})}});Z(()=>{s.refresh()}),Y(()=>{e.btnList=[{name:l.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:s.refresh},{name:l.global.t("system.page.export"),icon:"mdi-export-variant",code:"export",click:s.exportTable}]});const v=b(()=>C({hasTab:!1})),j=b(()=>M({hasTab:!1}));return Q(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,s.sureSearch()},O)},{deep:!0}),(t,o)=>{const u=n("v-col"),k=n("v-text-field"),f=n("v-row"),r=n("vxe-column"),A=n("vxe-table"),S=n("v-window-item"),x=n("v-window"),$=n("v-card-text"),P=n("v-card");return X(),ee("div",se,[g("div",null,[a(P,{class:"mt-5"},{default:i(()=>[a($,null,{default:i(()=>[a(x,{modelValue:e.activeTab,"onUpdate:modelValue":o[1]||(o[1]=m=>e.activeTab=m)},{default:i(()=>[a(S,null,{default:i(()=>[g("div",re,[a(f,{"no-gutters":""},{default:i(()=>[a(u,{cols:"3",class:"col"},{default:i(()=>[a(R,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(u,{cols:"9"},{default:i(()=>[a(f,{"no-gutters":"",onKeyup:T(s.sureSearch,["enter"])},{default:i(()=>[a(u,{cols:"4"}),a(u,{cols:"4"}),a(u,{cols:"4"},{default:i(()=>[a(k,{modelValue:e.searchForm.job_code,"onUpdate:modelValue":o[0]||(o[0]=m=>e.searchForm.job_code=m),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.warehouseWorking.warehouseAdjust.job_code"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),g("div",{class:"mt-5",style:te({height:c(v)})},[a(A,{ref_key:"xTable",ref:h,"column-config":{minWidth:"100px"},data:e.tableData,height:c(j),align:"center"},{empty:i(()=>[ae(y(c(l).global.t("system.page.noData")),1)]),default:i(()=>[a(r,{type:"seq",width:"60"}),a(r,{type:"checkbox",width:"50"}),a(r,{field:"job_code",width:"150px",title:t.$t("wms.warehouseWorking.warehouseAdjust.job_code")},null,8,["title"]),a(r,{field:"job_type",width:"150px",title:t.$t("wms.warehouseWorking.warehouseAdjust.job_type")},{default:i(({row:m,column:D})=>[g("span",null,y(c(G)(m[D.property])),1)]),_:1},8,["title"]),a(r,{field:"spu_code",width:"150px",title:t.$t("base.commodityManagement.spu_code")},null,8,["title"]),a(r,{field:"spu_name",width:"150px",title:t.$t("base.commodityManagement.spu_name")},null,8,["title"]),a(r,{field:"sku_code",width:"150px",title:t.$t("base.commodityManagement.sku_code")},null,8,["title"]),a(r,{field:"qty",width:"150px",title:t.$t("wms.warehouseWorking.warehouseAdjust.qty")},null,8,["title"]),a(r,{field:"warehouse_name",width:"150px",title:t.$t("wms.warehouseWorking.warehouseAdjust.warehouse")},null,8,["title"]),a(r,{field:"location_name",width:"150px",title:t.$t("wms.warehouseWorking.warehouseAdjust.location_name")},null,8,["title"]),a(r,{field:"creator",title:t.$t("wms.warehouseWorking.warehouseAdjust.creator")},null,8,["title"]),a(r,{field:"create_time",width:"170px",formatter:["formatDate","yyyy-MM-dd HH:mm"],title:t.$t("wms.warehouseWorking.warehouseAdjust.create_time")},null,8,["title"])]),_:1},8,["data","height"]),a(F,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":c(L),layouts:c(W),onPageChange:s.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"])],4)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(q,{"show-dialog":e.showDialog,form:e.dialogForm,"process-type":e.processType,onClose:s.closeDialog,onSaveSuccess:s.saveSuccess},null,8,["show-dialog","form","process-type","onClose","onSaveSuccess"])])])}}});const Ce=oe(ie,[["__scopeId","data-v-3805d888"]]);export{Ce as default};
