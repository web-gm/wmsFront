import{i as n}from"./i18n-0af8b262.js";import{e as F}from"./style-b9bc59b4.js";import{a as d}from"./index-cd6d6b34.js";import{a as N}from"./deliveryManagement-7eebd823.js";import{b as H}from"./customer-7e6fccb3.js";import{_ as O}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{c as Z,_ as j}from"./custom-filter-select.vue_vue_type_script_setup_true_lang-d6331575.js";import{s as A}from"./sku-select-e1d3e93a.js";import{I as x}from"./formRule-3feb276f.js";import{r as Q}from"./common-938b41ea.js";import{d as z,b as g,c as V,r as C,n as E,w as G,a as i,x as v,v as D,s,q as l,m as W,b0 as J,O as K,y as k,at as T,ap as h,ac as P,u as X}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./stockManagement-a6372198.js";import"./system-93ae242b.js";import"./index-ae8f073f.js";const ee={class:"detailBtnContainer"},te=z({__name:"add-or-update-shipment",props:{showDialog:{type:Boolean},form:null},emits:["close","saveSuccess"],setup(L,{emit:S}){const b=L,w=g(),f=V(()=>b.showDialog),I=V(()=>t.form.detailList.length===0?"30%":"70%"),t=C({curSelectType:"",showSkuDialogSelect:!1,dialogTitle:"",form:g({id:0,detailList:[]}),removeDetailList:g([]),combobox:g({customer_name:[]}),rules:{customer_name:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("wms.deliveryManagement.customer_name")}!`],spu_code:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("wms.deliveryManagement.sku_code")}!`],qty:[e=>!!e||`${n.global.t("system.checkText.mustInput")}${n.global.t("wms.deliveryManagement.detailQty")}!`,e=>x(e,"greaterThanZero")===""||x(e,"greaterThanZero")]}}),m=C({openSelect:e=>{t.curSelectType=e,e==="target"&&(t.showSkuDialogSelect=!0)},sureSelect:e=>{if(t.curSelectType==="target")for(const o of e)t.form.detailList.findIndex(r=>r.sku_id===o.sku_id)===-1&&t.form.detailList.push({id:0,sku_id:o.sku_id,spu_code:o.spu_code,spu_name:o.spu_name,sku_name:o.sku_name,sku_code:o.sku_code,qty:0})},closeDialogSelect:e=>{e==="target"&&(t.showSkuDialogSelect=!1)},clearCommodity:e=>{e.sku_id=0,e.sku_code="",e.spu_code="",e.spu_name=""},customerNameChange:e=>{e?t.form.customer_id=t.combobox.customer_name.filter(o=>o.label===e)[0].value:t.form.customer_id=0},AddDetail:()=>{t.form.detailList.push({id:0,qty:0});const e=document.querySelector(".formCard");e&&e.scrollHeight>e.clientHeight&&E(()=>{e.scrollTop=e.scrollHeight})},getDialogType:()=>{b.form.detailList.length>0?t.dialogTitle="update":t.dialogTitle="add"},getCombobox:async()=>{t.combobox.customer_name=[];const{data:e}=await H();if(!!e.isSuccess)for(const o of e.data)o.is_valid&&t.combobox.customer_name.push({label:o.customer_name,value:o.id})},closeDialog:()=>{S("close")},beforeSubmit:()=>{let e=!0;return t.form.detailList.length===0?(d.$message({type:"error",content:n.global.t("system.tips.detailLengthIsZero")}),e=!1):Z(t.form.detailList,["sku_id"])&&(d.$message({type:"error",content:n.global.t("system.tips.detailHasItemRepeat")}),e=!1),e},submit:async()=>{if(!m.beforeSubmit())return;const{valid:o}=await w.value.validate();if(o){const p=[],r=Q(t.form);for(const _ of r.detailList)p.push({customer_id:r.customer_id?r.customer_id:0,customer_name:r.customer_name?r.customer_name:"",qty:_.qty,sku_id:_.sku_id?_.sku_id:0});const{data:u}=await N(p);if(!u.isSuccess){d.$message({type:"error",content:u.errorMessage});return}d.$message({type:"success",content:`${n.global.t("system.page.submit")}${n.global.t("system.tips.success")}`}),S("saveSuccess")}else d.$message({type:"error",content:n.global.t("system.checkText.checkFormFail")})},removeItem:(e,o)=>{d.$dialog({content:n.global.t("system.tips.beforeDeleteDetailMessage"),handleConfirm:async()=>{o.id>0&&(o.id=-o.id,t.removeDetailList.push(o)),t.form.detailList.splice(e,1)}})}});return G(()=>f.value,e=>{e&&(m.getDialogType(),m.getCombobox(),t.form=b.form)}),(e,o)=>{const p=i("v-toolbar"),r=i("v-text-field"),u=i("v-col"),_=i("v-row"),y=i("v-btn"),U=i("v-form"),q=i("v-card-text"),M=i("v-card-actions"),B=i("v-card"),R=i("v-dialog");return v(),D(R,{modelValue:h(f),"onUpdate:modelValue":o[3]||(o[3]=a=>P(f)?f.value=a:null),transition:"dialog-top-transition",persistent:!0},{default:s(()=>[l(B,{class:"formCard",width:h(I)},{default:s(()=>[l(p,{color:"white",title:`${e.$t("router.sideBar.deliveryManagement")}`},null,8,["title"]),l(q,null,{default:s(()=>[l(U,{ref_key:"formRef",ref:w},{default:s(()=>[l(j,{modelValue:t.form,"onUpdate:modelValue":o[0]||(o[0]=a=>t.form=a),items:t.combobox.customer_name,"item-title":"label",rules:t.rules.customer_name,label:e.$t("wms.deliveryManagement.customer_name"),mapping:[{in:"customer_name",out:"label"},{in:"customer_id",out:"value"}]},null,8,["modelValue","items","rules","label"]),(v(!0),W(K,null,J(t.form.detailList,(a,$)=>(v(),D(_,{key:$,style:{"margin-top":"5px"}},{default:s(()=>[l(u,{cols:3},{default:s(()=>[l(r,{modelValue:a.spu_name,"onUpdate:modelValue":c=>a.spu_name=c,label:e.$t("wms.deliveryManagement.spu_name"),variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),l(u,{cols:3},{default:s(()=>[l(r,{modelValue:a.spu_code,"onUpdate:modelValue":c=>a.spu_code=c,label:e.$t("wms.deliveryManagement.spu_code"),rules:t.rules.spu_code,variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),_:2},1024),l(u,{cols:3},{default:s(()=>[l(r,{modelValue:a.sku_code,"onUpdate:modelValue":c=>a.sku_code=c,label:e.$t("wms.deliveryManagement.sku_code"),variant:"outlined",readonly:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),l(u,{cols:2},{default:s(()=>[l(r,{modelValue:a.qty,"onUpdate:modelValue":c=>a.qty=c,rules:t.rules.qty,label:e.$t("wms.deliveryManagement.detailQty"),variant:"outlined",clearable:""},null,8,["modelValue","onUpdate:modelValue","rules","label"])]),_:2},1024),l(u,{cols:1},{default:s(()=>[X("div",ee,[l(O,{flat:!0,icon:"mdi-delete-outline","tooltip-text":e.$t("system.page.delete"),"icon-color":h(F),onClick:c=>m.removeItem($,a)},null,8,["tooltip-text","icon-color","onClick"])])]),_:2},1024)]),_:2},1024))),128)),l(y,{style:{"font-size":"20px","margin-bottom":"15px","margin-top":"10px",float:"right"},color:"primary",width:40,onClick:o[1]||(o[1]=a=>m.openSelect("target"))},{default:s(()=>[k(" + ")]),_:1})]),_:1},512)]),_:1}),l(M,{class:"justify-end"},{default:s(()=>[l(y,{variant:"text",onClick:m.closeDialog},{default:s(()=>[k(T(e.$t("system.page.close")),1)]),_:1},8,["onClick"]),l(y,{color:"primary",variant:"text",onClick:m.submit},{default:s(()=>[k(T(e.$t("system.page.submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["width"]),l(A,{"show-dialog":t.showSkuDialogSelect,onClose:o[2]||(o[2]=a=>m.closeDialogSelect("target")),onSureSelect:m.sureSelect},null,8,["show-dialog","onSureSelect"])]),_:1},8,["modelValue"])}}});const he=Y(te,[["__scopeId","data-v-278cfc5e"]]);export{he as default};
