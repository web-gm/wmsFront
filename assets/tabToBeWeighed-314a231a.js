import{i as g,w as T}from"./i18n-0af8b262.js";import{a as C,b as P}from"./style-b9bc59b4.js";import{D as W,a as B,c as S,P as x,b as I}from"./system-93ae242b.js";import{a as h}from"./index-cd6d6b34.js";import{p as L,z as q}from"./deliveryManagement-7eebd823.js";import{_ as V}from"./tooltip-btn.vue_vue_type_script_setup_true_lang-fc6ce76f.js";import{G as f}from"./commodityManagement-a1debff9.js";import{g as F,s as z}from"./common-938b41ea.js";import{_ as E}from"./search-delivered-detail.vue_vue_type_script_setup_true_lang-20446111.js";import{e as U}from"./exportTable-b0d17537.js";import{_ as A}from"./package-confirm.vue_vue_type_script_setup_true_lang-44235a07.js";import{B as G}from"./btnGroup-26ff2079.js";import{d as O,b as m,r as b,o as N,c as v,w as j,a as u,x as H,m as R,u as p,q as a,s as d,y as K,at as w,ap as c,as as Q,O as Z}from"./runtime-core.esm-bundler-1bbee395.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f4e4efab.js";import"./request-e1053d5a.js";import"./index-827f2091.js";import"./vue-router-1283ad2d.js";import"./index-ae8f073f.js";import"./formRule-3feb276f.js";const J={class:"operateArea"},X={style:{width:"100%",display:"flex","justify-content":"center"}},ee=O({__name:"tabToBeWeighed",setup(te,{expose:$}){const _=m(),e=b({showDeliveredDetailID:0,showDeliveredDetail:!1,showDialog:!1,confirmList:m([]),dialogMaxQty:0,dialogWeightUnit:"",defaultWeight:0,weighedRow:m(),searchForm:{dispatch_no:"",customer_name:"",spu_name:""},timer:m(null),activeTab:null,tableData:m([]),tablePage:m({total:0,pageIndex:1,pageSize:W,searchObjects:[]}),btnList:[],authorityList:F()}),o=b({closeDeliveredDetail:()=>{e.showDeliveredDetail=!1},viewRow:t=>{e.showDeliveredDetailID=t.id,e.showDeliveredDetail=!0},dialogClose:()=>{e.showDialog=!1},dialogSubmit:async t=>{const i=t.map(l=>({id:l.id,dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,weighing_qty:l.qty,weighing_weight:l.weight,picked_qty:l.picked_qty})),{data:r}=await L(i);if(!r.isSuccess){h.$message({type:"error",content:r.errorMessage});return}h.$message({type:"success",content:r.data}),o.dialogClose(),o.refresh()},handleWeigh:async()=>{const i=_.value.getCheckboxRecords(),r=[];if(i.length>0){for(const l of i)r.push({id:l.id,spu_name:l.spu_name,spu_code:l.spu_code,sku_code:l.sku_code,maxQty:l.unweighing_qty,qty:l.unweighing_qty,weight:l.weight,weight_unit:f("weight",l.weight_unit),dispatch_no:l.dispatch_no,dispatch_status:l.dispatch_status,picked_qty:l.picked_qty});e.confirmList=r,e.showDialog=!0}else h.$message({type:"error",content:`${g.global.t("base.userManagement.checkboxIsNull")}`})},refresh:()=>{o.getToBeWeighed()},getToBeWeighed:async()=>{const{data:t}=await q(e.tablePage);if(!t.isSuccess){h.$message({type:"error",content:t.errorMessage});return}e.tableData=t.data.rows,e.tablePage.total=t.data.totals},handlePageChange:m(({currentPage:t,pageSize:i})=>{e.tablePage.pageIndex=t,e.tablePage.pageSize=i,o.getToBeWeighed()}),exportTable:()=>{const t=_.value;U({table:t,filename:g.global.t("wms.deliveryManagement.toBeWeighed"),columnFilterMethod({column:i}){return!["checkbox"].includes(i==null?void 0:i.type)&&!["operate"].includes(i==null?void 0:i.field)}})},sureSearch:()=>{e.tablePage.searchObjects=z(e.searchForm),o.getToBeWeighed()}});N(()=>{e.btnList=[{name:g.global.t("system.page.refresh"),icon:"mdi-refresh",code:"",click:o.refresh},{name:g.global.t("system.page.export"),icon:"mdi-export-variant",code:"weighed-export",click:o.exportTable},{name:g.global.t("wms.deliveryManagement.weigh"),icon:"mdi-weight",code:"weighed-weigh",click:o.handleWeigh}]});const D=v(()=>C({})),M=v(()=>P({}));return j(()=>e.searchForm,()=>{e.timer&&clearTimeout(e.timer),e.timer=setTimeout(()=>{e.timer=null,o.sureSearch()},B)},{deep:!0}),$({getToBeWeighed:o.getToBeWeighed}),(t,i)=>{const r=u("v-col"),l=u("v-text-field"),y=u("v-row"),s=u("vxe-column"),k=u("vxe-table");return H(),R(Z,null,[p("div",J,[a(y,{"no-gutters":""},{default:d(()=>[a(r,{cols:"3",class:"col"},{default:d(()=>[a(G,{"authority-list":e.authorityList,"btn-list":e.btnList},null,8,["authority-list","btn-list"])]),_:1}),a(r,{cols:"9"},{default:d(()=>[a(y,{"no-gutters":"",onKeyup:T(o.sureSearch,["enter"])},{default:d(()=>[a(r,{cols:"4"},{default:d(()=>[a(l,{modelValue:e.searchForm.dispatch_no,"onUpdate:modelValue":i[0]||(i[0]=n=>e.searchForm.dispatch_no=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.dispatch_no"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(r,{cols:"4"},{default:d(()=>[a(l,{modelValue:e.searchForm.customer_name,"onUpdate:modelValue":i[1]||(i[1]=n=>e.searchForm.customer_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.customer_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1}),a(r,{cols:"4"},{default:d(()=>[a(l,{modelValue:e.searchForm.spu_name,"onUpdate:modelValue":i[2]||(i[2]=n=>e.searchForm.spu_name=n),clearable:"","hide-details":"",density:"comfortable",class:"searchInput ml-5 mt-1",label:t.$t("wms.deliveryManagement.spu_name"),variant:"solo"},null,8,["modelValue","label"])]),_:1})]),_:1},8,["onKeyup"])]),_:1})]),_:1})]),p("div",{class:"mt-5",style:Q({height:c(D)})},[a(k,{ref_key:"xTable",ref:_,"column-config":{minWidth:"100px"},data:e.tableData,height:c(M),align:"center"},{empty:d(()=>[K(w(c(g).global.t("system.page.noData")),1)]),default:d(()=>[a(s,{type:"seq",width:"60"}),a(s,{type:"checkbox",width:"50"}),a(s,{field:"dispatch_no",title:t.$t("wms.deliveryManagement.dispatch_no")},null,8,["title"]),a(s,{field:"spu_code",title:t.$t("wms.deliveryManagement.spu_code")},null,8,["title"]),a(s,{field:"spu_description",width:"200px",title:t.$t("wms.deliveryManagement.spu_description")},null,8,["title"]),a(s,{field:"spu_name",title:t.$t("wms.deliveryManagement.spu_name")},null,8,["title"]),a(s,{field:"sku_code",title:t.$t("wms.deliveryManagement.sku_code")},null,8,["title"]),a(s,{field:"bar_code",title:t.$t("wms.deliveryManagement.bar_code")},null,8,["title"]),a(s,{field:"qty",title:t.$t("wms.deliveryManagement.order_qty")},null,8,["title"]),a(s,{field:"weight",title:t.$t("wms.deliveryManagement.detailWeight")},{default:d(({row:n})=>[p("span",null,w(`${n.weight} ${c(f)("weight",n.weight_unit)}`),1)]),_:1},8,["title"]),a(s,{field:"volume",title:t.$t("wms.deliveryManagement.detailVolume")},{default:d(({row:n})=>[p("span",null,w(`${n.volume} ${c(f)("volume",n.volume_unit)}`),1)]),_:1},8,["title"]),a(s,{field:"package_person",title:t.$t("wms.deliveryManagement.package_person")},null,8,["title"]),a(s,{field:"package_no",title:t.$t("wms.deliveryManagement.package_no")},null,8,["title"]),a(s,{field:"customer_name",title:t.$t("wms.deliveryManagement.customer_name")},null,8,["title"]),a(s,{field:"creator",title:t.$t("wms.deliveryManagement.creator")},null,8,["title"]),a(s,{field:"create_time",width:"170px",title:t.$t("wms.deliveryManagement.create_time")},null,8,["title"]),a(s,{field:"operate",title:t.$t("system.page.operate"),width:"140",resizable:!1,"show-overflow":""},{default:d(({row:n})=>[p("div",X,[a(V,{flat:!0,icon:"mdi-eye-outline","tooltip-text":t.$t("system.page.view"),onClick:ae=>o.viewRow(n)},null,8,["tooltip-text","onClick"])])]),_:1},8,["title"])]),_:1},8,["data","height"]),a(S,{"current-page":e.tablePage.pageIndex,"page-size":e.tablePage.pageSize,perfect:"",total:e.tablePage.total,"page-sizes":c(x),layouts:c(I),onPageChange:o.handlePageChange},null,8,["current-page","page-size","total","page-sizes","layouts","onPageChange"]),a(E,{id:e.showDeliveredDetailID,"show-dialog":e.showDeliveredDetail,onClose:o.closeDeliveredDetail},null,8,["id","show-dialog","onClose"]),a(A,{"show-dialog":e.showDialog,"dialog-title":t.$t("wms.deliveryManagement.weigh"),"is-weight":!0,"data-list":e.confirmList,onClose:o.dialogClose,onSubmit:o.dialogSubmit},null,8,["show-dialog","dialog-title","data-list","onClose","onSubmit"])],4)],64)}}});const De=Y(ee,[["__scopeId","data-v-f3c1939c"]]);export{De as default};
